{"ast":null,"code":"export default {\n  name: 'DataFlow',\n  props: {\n    instanceKey: {\n      defaul: ''\n    },\n    action: {\n      defaul: 'view'\n    },\n    width: {\n      type: [String, Number],\n      default: 800\n    },\n    height: {\n      type: [String, Number],\n      default: 250\n    },\n    gridSize: {\n      type: Number,\n      default: 1\n    },\n    drawGrid: {\n      type: [Object, Boolean],\n      default: false\n    },\n    background: {\n      type: [Object, Boolean],\n      default: false\n    },\n    readonly: {\n      type: Boolean,\n      default: false\n    },\n    highLightLinks: {\n      type: Array,\n\n      default() {\n        return [];\n      }\n\n    },\n    nodes: {\n      type: [Object, Boolean],\n      default: false\n    },\n    links: {\n      type: [Object, Boolean],\n      default: false\n    }\n  },\n\n  data() {\n    return {\n      stencilShapes: [],\n      selectionNode: null,\n      selectedElement: null,\n      selectedLink: null,\n      //check ctrl shift\n      ctrlDown: false,\n      shiftDown: false,\n      color: \"rgb(255 136 0)\",\n      arr: ['filter', 'formula', 'join', 'load', 'pivot', 'sample', 'script', 'select', 'sort', 'summarize', 'transposeTable', 'union', 'weightAvg']\n    };\n  },\n\n  created() {\n    this.graph = new joint.dia.Graph();\n  },\n\n  mounted() {\n    this.initPaper();\n  },\n\n  methods: {\n    initPaper() {\n      let graph = this.graph;\n      this.commandManager = new joint.dia.CommandManager({\n        graph: graph,\n        cmdBeforeAdd: (cmdName, cell, graph, options = {}) => {\n          return !options.ignoreCommandManager;\n        }\n      });\n      this.paper = new joint.dia.Paper({\n        width: 1000,\n        height: 800,\n        model: this.graph,\n        async: true,\n        sorting: joint.dia.Paper.sorting.APPROX,\n        gridSize: 10,\n        drawGrid: true,\n        restrictTranslate: true,\n        stopDelegation: false,\n        interactive: {\n          vertexAdd: false\n        },\n        // background: { color: '#F3F7F6' },\n        // defaultConnectionPoint: { name: 'boundary' },\n        // defaultConnector: {\n        //     name: \"rounded\"\n        //   },\n        //   defaultRouter: {\n        //     name: \"manhattan\",\n        //     args: {\n        //       step: 10,\n        //       endDirections: [\"bottom\"],\n        //       startDirections: [\"top\"],\n        //       padding: { bottom: 20 }\n        //     }\n        //   },\n        snapLinks: {\n          radius: 75\n        },\n        linkPinning: false,\n        multiLinks: false,\n        defaultRouter: {\n          name: 'manhattan',\n          args: {\n            padding: 10\n          }\n        },\n        defaultConnector: {\n          name: 'rounded'\n        },\n        validateConnection: function (cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\n          // Prevent linking from input ports.\n          if (magnetS && magnetS.getAttribute('port-group') === 'in') return false; // Prevent linking from output ports to input ports within one element.\n\n          if (cellViewS === cellViewT) return false; // Prevent linking to input ports.\n\n          return magnetT && magnetT.getAttribute('port-group') === 'in' || cellViewS.model.get('type') === 'qad.Question' && cellViewT.model.get('type') === 'qad.Answer';\n        },\n        // validateConnection: function (view1, _magnet1, view2, _magnet2) {\n        //     // Do not allow loop links (Element to Link, Element A to Element B is valid).\n        //     return view1 !== view2;\n        // },\n        interactive: {\n          linkMove: true,\n          labelMove: true,\n          arrowheadMove: true,\n          vertexMove: false,\n          vertexAdd: false,\n          vertexRemove: false,\n          useLinkTools: false\n        },\n        defaultLink: function () {\n          return new joint.shapes.standard.Link({\n            attrs: {\n              z: 1,\n              line: {\n                connection: true,\n                stroke: '#707070',\n                strokeLinejoin: 'round'\n              },\n              wrapper: {\n                connection: true,\n                strokeWidth: 10,\n                strokeLinejoin: 'round'\n              }\n            },\n            markup: [{\n              tagName: 'path',\n              selector: 'wrapper',\n              attributes: {\n                'fill': 'none',\n                'stroke': 'transparent'\n              }\n            }, {\n              tagName: 'path',\n              selector: 'line',\n              attributes: {\n                'fill': 'none'\n              }\n            }]\n          });\n        }\n      });\n      this.paperScroller = new joint.ui.PaperScroller({\n        paper: this.paper,\n        autoResizePaper: true,\n        scrollWhileDragging: true,\n        cursor: 'grab'\n      });\n      this.selection = new joint.ui.Selection({\n        theme: 'material',\n        paper: this.paper,\n        useModelGeometry: true,\n        allowTranslate: true\n      });\n      this.snaplines = new joint.ui.Snaplines({\n        paper: this.paper\n      });\n      this.snaplines.startListening(); //render paper\n\n      document.getElementById('paper').appendChild(this.paperScroller.render().el); //render paperScroller\n\n      this.paperScroller.$el.css({\n        width: 900,\n        height: 600\n      }).appendTo('#paper');\n      this.paperScroller.center();\n      this.addStencil();\n      this.handlePaperEvents();\n      this.selection.collection.reset(graph.getElements());\n    },\n\n    jsUcfirst(string) {\n      return string.charAt(0).toUpperCase() + string.slice(1);\n    },\n\n    stencilRenderHandler(positionX, positionY, arr, elNoInPorts = \"\", spaceBetweenElToX = 0, spaceBetweenElToY = 0) {\n      var customEl = joint.dia.Element.define('standard.Rectangle', {\n        z: 1,\n        size: {\n          width: 44,\n          height: 35\n        },\n        removable: false,\n        attrs: {\n          image: {\n            x: 5,\n            y: 5,\n            width: 'calc(w-10)',\n            height: 'calc(h-10 )'\n          },\n          root: {\n            magnet: false\n          },\n          body: {\n            fill: '#FFFFFF',\n            stroke: '#A0A0A0',\n            width: 'calc(w)',\n            height: 'calc(h)',\n            strokeWidth: 2,\n            rx: 5,\n            ry: 5\n          }\n        },\n        ports: {\n          items: [{\n            id: 'out-port',\n            group: 'out'\n          }, {\n            id: 'in-port',\n            group: 'in'\n          }],\n          groups: {\n            out: {\n              markup: [{\n                tagName: 'circle',\n                selector: 'portBody'\n              }],\n              position: {\n                name: 'right'\n              },\n              attrs: {\n                portBody: {\n                  r: 5,\n                  magnet: 'active',\n                  fill: '#187BD3',\n                  stroke: '#187BD3'\n                }\n              }\n            },\n            in: {\n              markup: [{\n                tagName: 'circle',\n                selector: 'portBody'\n              }],\n              position: {\n                name: 'left'\n              },\n              attrs: {\n                portBody: {\n                  r: 5,\n                  magnet: 'passive',\n                  fill: '#FFFFFF',\n                  stroke: '#187BD3'\n                }\n              }\n            }\n          }\n        },\n        markup: [{\n          tagName: 'rect',\n          selector: 'body'\n        }, {\n          tagName: 'image',\n          selector: 'image'\n        }, {\n          tagName: 'ports',\n          selector: 'ports'\n        }]\n      });\n      var customElNoInPorts = joint.dia.Element.define('standard.Rectangle', {\n        z: 1,\n        theme: 'material',\n        size: {\n          width: 44,\n          height: 35\n        },\n        removable: false,\n        attrs: {\n          image: {\n            x: 5,\n            y: 5,\n            width: 'calc(w-10)',\n            height: 'calc(h-10 )'\n          },\n          root: {\n            magnet: false\n          },\n          body: {\n            fill: '#FFFFFF',\n            stroke: '#A0A0A0',\n            width: 'calc(w)',\n            height: 'calc(h)',\n            strokeWidth: 2\n          },\n          line: {\n            connection: true,\n            stroke: '#333333',\n            strokeWidth: 2,\n            strokeLinejoin: 'round',\n            targetMarker: {\n              'type': 'path',\n              'd': 'M 10 -5 0 0 10 5 z'\n            }\n          }\n        },\n        ports: {\n          items: [{\n            id: 'out-port',\n            group: 'out'\n          }],\n          groups: {\n            out: {\n              markup: [{\n                tagName: 'circle',\n                selector: 'portBody'\n              }],\n              position: {\n                name: 'right'\n              },\n              attrs: {\n                portBody: {\n                  r: 5,\n                  magnet: 'active',\n                  fill: '#187BD3',\n                  stroke: '#187BD3'\n                }\n              }\n            }\n          }\n        },\n        markup: [{\n          tagName: 'rect',\n          selector: 'body'\n        }, {\n          tagName: 'image',\n          selector: 'image'\n        }, {\n          tagName: 'ports',\n          selector: 'ports'\n        }]\n      });\n      this.arr.forEach(element => {\n        //chuyển thành hoa chữ đầu cho đúng định dạng file ảnh lưu\n        let elementName = this.jsUcfirst(element);\n\n        if (elementName === this.jsUcfirst(elNoInPorts)) {\n          element = new customElNoInPorts();\n        } else {\n          element = new customEl();\n        }\n\n        element.prop('attrs/image/xlinkHref', require(`../assets/${elementName}.svg`));\n        this.stencilShapes.push(element.position(positionX, positionY));\n\n        if (spaceBetweenElToX > 0) {\n          positionX += element.attributes.size.width + spaceBetweenElToX;\n        }\n\n        if (spaceBetweenElToY > 0) {\n          positionY += element.attributes.size.height + spaceBetweenElToY;\n        }\n      });\n    },\n\n    addStencil() {\n      let graph = this.graph;\n      let paper = this.paper;\n      var stencil = new joint.ui.Stencil({\n        paper: this.paperScroller,\n        width: 900,\n        height: 60,\n        dropAnimation: {\n          duration: 200,\n          easing: 'swing'\n        }\n      });\n      this.stencilRenderHandler(20, 20, this.arr, \"load\", 16);\n      document.getElementById('stencil').appendChild(stencil.render().el);\n      stencil.load(this.stencilShapes);\n    },\n\n    addHalo(cellView) {\n      var halo = new joint.ui.Halo({\n        cellView: cellView,\n        type: 'toolbar',\n        boxContent: false // bang phia duoi cell cho biet tọa độ height width và angle\n\n      });\n      halo.removeHandle('resize');\n      halo.removeHandle('rotate');\n      halo.removeHandle('direction');\n      halo.render();\n    },\n\n    handlePaperEvents() {\n      let self = this;\n      let paper = self.paper;\n      let graph = self.graph; //nếu bấm thì =true\n\n      document.addEventListener('keydown', function (evt) {\n        if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\n          self.ctrlDown = true;\n        }\n\n        if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\n          self.shiftDown = true;\n        }\n      }); //nếu thả nút thì =false\n\n      document.addEventListener('keyup', function (evt) {\n        if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\n          self.shiftDown = false;\n        }\n\n        if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\n          self.ctrlDown = false;\n        }\n      });\n      paper.on('cell:pointerup', function (cellView) {\n        self.addHalo(cellView);\n\n        if (cellView.model.attributes['type'] === 'standard.Link') {\n          self.$emit('select-link', {\n            id: cellView.model.id\n          });\n        } else {\n          self.$emit('select-cell', {\n            id: cellView.model.id\n          });\n        }\n\n        self.selectedElement = cellView.model;\n        self.selectedElement.toFront({\n          ignoreCommandManager: true\n        }); // cellView.$el[0].parentElement.appendChild(cellView.$el[0])\n        // console.log(graph.getLinks())\n      });\n      paper.on({\n        //xử lý khi các sự kiện \n        \"cell:mouseenter\": cellView => {\n          cellView.model.toFront({\n            ignoreCommandManager: true\n          });\n        },\n        \"cell:mouseleave\": cellView => {\n          cellView.model.toBack({\n            ignoreCommandManager: true\n          });\n\n          if (self.selectionNode) {\n            getElementPredecessorLinks(self.selectionNode).forEach(link => {\n              link.toFront({\n                ignoreCommandManager: true\n              });\n            });\n          }\n        },\n        \"element:pointerclick\": cellView => {\n          //chỉ đổi màu khi ko bấm ctrl\n          if (self.ctrlDown === false) {// selectElement(cellView.model)\n          }\n        },\n        \"link:pointerclick\": cellView => {// selectElement(cellView.model)\n          //chon vao link thi mo cho phep doi node\n          // cellView.addTools(toolsView);\n        },\n        //chuyển lại màu cũ khi bấm ra ngoài\n        \"blank:pointerclick\": () => {\n          // selectElement(null)\n          paper.removeTools({\n            ignoreCommandManager: true\n          });\n        },\n        'element:pointerup': function (cellView, evt) {\n          console.log(evt);\n\n          if (evt.ctrlKey || evt.metaKey) {\n            console.log(self.selection);\n            self.selection.collection.add(cellView.model); //loop to all the element in selection and set it to front\n\n            self.selection.collection.models.forEach(element => {\n              element.toFront({\n                ignoreCommandManager: true\n              });\n            });\n          }\n        },\n        //chuyển màu khi bấm vào link và cho nó lên trc\n        'link:pointerup': function (cellView) {\n          self.selectedLink = cellView.model;\n          self.selectedLink.toFront({\n            ignoreCommandManager: true\n          });\n        },\n        // lắng nghe sự kiện bấm ở ngoài khoange trống check shift để active select\n        'blank:pointerdown': function (evt, x, y) {\n          if (self.shiftDown === true) {\n            // selectElement(null)\n            self.paperScroller.setCursor('crosshair');\n            self.selection.startSelecting(evt);\n          } else {\n            console.log(self.getAllNodes());\n            console.log(self.getAllLinks());\n            self.selection.collection.reset([]);\n            self.paperScroller.startPanning(evt, x, y);\n            paper.removeTools();\n            self.paperScroller.setCursor('grab');\n          }\n        }\n      }); //xóa el nếu chọn lại lần 2 khi bấm ctrl\n\n      self.selection.on('selection-box:pointerdown', function (cellView, evt) {\n        if (evt.ctrlKey || evt.metaKey) {\n          self.selection.collection.remove(cellView.model);\n        }\n      }); //kết hợp bấm ctrl để check các tổ hợp phím ctrl + C,V,Z,Y,A...\n\n      document.addEventListener('keydown', function (evt) {\n        self.clipboard = new joint.ui.Clipboard();\n\n        if (evt.code === \"NumpadAdd\" && self.shiftDown === true) {\n          // console.log(evt.code)\n          self.paperScroller.zoom(0.2, {\n            max: 4\n          });\n        }\n\n        if (evt.code === \"NumpadSubtract\" && shiftDown === true) {\n          self.paperScroller.zoom(-0.2, {\n            min: 0.2\n          }); // console.log(evt.code)\n        } //check+ A\n\n\n        if (evt.code === \"KeyA\" && self.ctrlDown === true) {\n          self.selection.collection.reset(graph.getElements());\n          evt.preventDefault();\n        } //check ctrl + Z\n\n\n        if (evt.code === \"KeyZ\" && self.ctrlDown === true) {\n          self.commandManager.undo(); // console.log(selectionNode)\n\n          unhighlightCell(self.selectionNode);\n          graph.getLinks().forEach(link => unhighlightCell(link)); // console.log(selectionNode)\n\n          self.selectionNode = null;\n        } //check ctrl + Y\n\n\n        if (evt.code === \"KeyY\" && self.ctrlDown === true) {\n          self.commandManager.redo(); // selectElement(null)\n        } //check ctrl + V ,ctrl + C, ctrl+X\n\n\n        if (evt.code === \"KeyX\" && self.ctrlDown === true) {\n          self.clipboard.cutElements(self.selection.collection, paper.model);\n        }\n\n        if (evt.code === \"KeyC\" && self.ctrlDown === true) {\n          self.clipboard.copyElements(self.selection.collection, graph);\n        }\n\n        if (evt.code === \"KeyV\" && self.ctrlDown === true) {\n          var pastedCells = self.clipboard.pasteCells(graph, {\n            translate: {\n              dx: 40,\n              dy: 40\n            },\n            useLocalStorage: true\n          });\n\n          var elements = _.filter(pastedCells, function (cell) {\n            return cell.isElement();\n          }); // Make sure pasted elements get selected immediately. This makes the UX better as\n          // the user can immediately manipulate the pasted elements.\n\n\n          self.selection.collection.reset(elements);\n        }\n      });\n    },\n\n    getAllLinks() {\n      return this.graph.getLinks();\n    },\n\n    getAllNodes() {\n      return this.graph.getCells();\n    },\n\n    clearAll() {\n      return this.graph.clear();\n    },\n\n    getNodeAttr(id) {\n      let node = this.graph.getCell(id);\n\n      if (node) {\n        return node.attributes;\n      } else {\n        return {};\n      }\n    },\n\n    render() {\n      let nodeInfo = this.nodes;\n      let linkInfo = this.links;\n      let nodeType = nodeInfo.nodeType; //checknode\n\n      if (nodeType) {\n        let cell = new joint.shapes.nodeType({\n          position: nodeInfo.position,\n          id: nodeInfo.id\n        });\n        this.graph.addCell(cell);\n      } else {\n        console.error(\"Node type '\" + nodeType + \"' is not defined\");\n      }\n\n      if (linkInfo) {\n        let link = new joint.shapes.standard.Link();\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["name","props","instanceKey","defaul","action","width","type","String","Number","default","height","gridSize","drawGrid","Object","Boolean","background","readonly","highLightLinks","Array","nodes","links","data","stencilShapes","selectionNode","selectedElement","selectedLink","ctrlDown","shiftDown","color","arr","created","graph","joint","dia","Graph","mounted","initPaper","methods","commandManager","CommandManager","cmdBeforeAdd","cmdName","cell","options","ignoreCommandManager","paper","Paper","model","async","sorting","APPROX","restrictTranslate","stopDelegation","interactive","vertexAdd","snapLinks","radius","linkPinning","multiLinks","defaultRouter","args","padding","defaultConnector","validateConnection","cellViewS","magnetS","cellViewT","magnetT","end","linkView","getAttribute","get","linkMove","labelMove","arrowheadMove","vertexMove","vertexRemove","useLinkTools","defaultLink","shapes","standard","Link","attrs","z","line","connection","stroke","strokeLinejoin","wrapper","strokeWidth","markup","tagName","selector","attributes","paperScroller","ui","PaperScroller","autoResizePaper","scrollWhileDragging","cursor","selection","Selection","theme","useModelGeometry","allowTranslate","snaplines","Snaplines","startListening","document","getElementById","appendChild","render","el","$el","css","appendTo","center","addStencil","handlePaperEvents","collection","reset","getElements","jsUcfirst","string","charAt","toUpperCase","slice","stencilRenderHandler","positionX","positionY","elNoInPorts","spaceBetweenElToX","spaceBetweenElToY","customEl","Element","define","size","removable","image","x","y","root","magnet","body","fill","rx","ry","ports","items","id","group","groups","out","position","portBody","r","in","customElNoInPorts","targetMarker","forEach","element","elementName","prop","require","push","stencil","Stencil","dropAnimation","duration","easing","load","addHalo","cellView","halo","Halo","boxContent","removeHandle","self","addEventListener","evt","code","on","$emit","toFront","toBack","getElementPredecessorLinks","link","removeTools","console","log","ctrlKey","metaKey","add","models","setCursor","startSelecting","getAllNodes","getAllLinks","startPanning","remove","clipboard","Clipboard","zoom","max","min","preventDefault","undo","unhighlightCell","getLinks","redo","cutElements","copyElements","pastedCells","pasteCells","translate","dx","dy","useLocalStorage","elements","_","filter","isElement","getCells","clearAll","clear","getNodeAttr","node","getCell","nodeInfo","linkInfo","nodeType","addCell","error"],"sourceRoot":"","sources":["C:\\Users\\Admin\\dataflow-test\\src\\components\\dataflow.vue"],"sourcesContent":["<template>\r\n  <div id=\"main\" >\r\n    <div class=\"btn_contain\">\r\n        <button id=\"btn-zoomout\" class=\"btn\">zoom out</button>\r\n        <button id=\"btn-zoomin\" class=\"btn\">zoom in</button>\r\n        <button id=\"btn-center\" class=\"btn\">center</button>\r\n        <button id=\"btn-center-content\" class=\"btn\">center content</button>\r\n    </div>\r\n    <div ref=\"nodeStencile\" id=\"stencil\"></div>\r\n    \r\n    <div id=\"paper\" ></div>\r\n    <div id=\"navigator\"></div>\r\n    \r\n    \r\n        </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name:'DataFlow',\r\n    props: {\r\n        instanceKey: {\r\n            defaul: ''\r\n        },\r\n        action: {\r\n            defaul: 'view'\r\n        },\r\n\t\twidth: {\r\n\t\t\ttype: [String, Number],\r\n\t\t\tdefault: 800\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: [String, Number],\r\n\t\t\tdefault: 250\r\n\t\t},\r\n\t\tgridSize: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 1\r\n\t\t},\r\n\t\tdrawGrid: {\r\n\t\t\ttype: [Object, Boolean],\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tbackground: {\r\n\t\t\ttype: [Object, Boolean],\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\treadonly: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n        highLightLinks:{\r\n            type: Array,\r\n            default(){\r\n                return []\r\n            }\r\n        },\r\n        nodes:{\r\n            type: [Object, Boolean],\r\n            default: false\r\n        },\r\n        links:{\r\n            type: [Object, Boolean],\r\n            default: false\r\n        }\r\n\t},\r\n    data(){\r\n        return{\r\n            stencilShapes : [],\r\n            selectionNode : null,\r\n            selectedElement : null,\r\n            selectedLink : null,\r\n            \r\n            //check ctrl shift\r\n            ctrlDown : false,\r\n            shiftDown : false,\r\n            color : \"rgb(255 136 0)\",\r\n            arr: ['filter', 'formula', 'join', 'load', 'pivot', 'sample', 'script', 'select', 'sort', 'summarize', 'transposeTable', 'union', 'weightAvg'],\r\n        }\r\n    },\r\n    created() {\r\n        this.graph = new joint.dia.Graph;\r\n    },\r\n    mounted() {\r\n        this.initPaper()\r\n    },\r\n    methods: {\r\n        \r\n        initPaper(){\r\n            let graph = this.graph;\r\n             this.commandManager = new joint.dia.CommandManager({\r\n                graph: graph,\r\n                cmdBeforeAdd: (cmdName, cell, graph, options = {}) => {\r\n                    return !options.ignoreCommandManager;\r\n                }\r\n            });\r\n            this.paper = new joint.dia.Paper({  \r\n                \r\n                width: 1000,\r\n                height: 800,\r\n                model: this.graph,\r\n                async: true,\r\n                sorting: joint.dia.Paper.sorting.APPROX,\r\n                gridSize: 10,\r\n                drawGrid: true,\r\n                restrictTranslate: true,\r\n                stopDelegation: false,\r\n                \r\n                interactive: { vertexAdd: false } ,\r\n                // background: { color: '#F3F7F6' },\r\n                // defaultConnectionPoint: { name: 'boundary' },\r\n                // defaultConnector: {\r\n                //     name: \"rounded\"\r\n                //   },\r\n                //   defaultRouter: {\r\n                //     name: \"manhattan\",\r\n                //     args: {\r\n                //       step: 10,\r\n                //       endDirections: [\"bottom\"],\r\n                //       startDirections: [\"top\"],\r\n                //       padding: { bottom: 20 }\r\n                //     }\r\n                //   },\r\n                snapLinks: {\r\n                    radius: 75\r\n                },\r\n                linkPinning: false,\r\n                multiLinks: false,\r\n                defaultRouter: { name: 'manhattan', args: { padding: 10 }},\r\n                defaultConnector: { name: 'rounded' },\r\n                validateConnection: function(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\r\n                    // Prevent linking from input ports.\r\n                    if (magnetS && magnetS.getAttribute('port-group') === 'in') return false;\r\n                    // Prevent linking from output ports to input ports within one element.\r\n                    if (cellViewS === cellViewT) return false;\r\n                    // Prevent linking to input ports.\r\n                    return (magnetT && magnetT.getAttribute('port-group') === 'in') || (cellViewS.model.get('type') === 'qad.Question' && cellViewT.model.get('type') === 'qad.Answer');\r\n                },\r\n                // validateConnection: function (view1, _magnet1, view2, _magnet2) {\r\n                //     // Do not allow loop links (Element to Link, Element A to Element B is valid).\r\n                //     return view1 !== view2;\r\n                // },\r\n                interactive: {\r\n                    linkMove: true,\r\n                    labelMove: true,\r\n                    arrowheadMove: true,\r\n                    vertexMove: false,\r\n                    vertexAdd: false,\r\n                    vertexRemove: false,\r\n                    useLinkTools: false,\r\n                },\r\n                defaultLink: function () {\r\n                    return new joint.shapes.standard.Link({\r\n                        attrs: {\r\n                            z:1,\r\n                            line: {\r\n                                connection: true,\r\n                                stroke: '#707070',\r\n                                strokeLinejoin: 'round',\r\n                            },\r\n                            wrapper: {\r\n                                connection: true,\r\n                                strokeWidth: 10,\r\n                                strokeLinejoin: 'round'\r\n                            },\r\n                            \r\n                        },\r\n                        \r\n                        markup: [{\r\n                            tagName: 'path',\r\n                            selector: 'wrapper',\r\n                            attributes: {\r\n                                'fill': 'none',\r\n                                \r\n                                'stroke': 'transparent'\r\n                            }\r\n                        }, {\r\n                            tagName: 'path',\r\n                            selector: 'line',\r\n                            attributes: {\r\n                                'fill': 'none',\r\n                                \r\n                            }\r\n                        }]\r\n                    });\r\n                }\r\n            });\r\n            this.paperScroller = new joint.ui.PaperScroller({\r\n                paper: this.paper,\r\n                autoResizePaper: true,\r\n                scrollWhileDragging: true,\r\n                cursor: 'grab'\r\n                \r\n            });\r\n            this.selection = new joint.ui.Selection({\r\n                theme: 'material',\r\n                paper: this.paper,\r\n                useModelGeometry: true,\r\n                allowTranslate: true,\r\n            });\r\n            this.snaplines = new joint.ui.Snaplines({ paper: this.paper })\r\n            this.snaplines.startListening()\r\n            //render paper\r\n            document.getElementById('paper').appendChild(this.paperScroller.render().el);\r\n            //render paperScroller\r\n            \r\n            this.paperScroller.$el.css({ width: 900, height: 600 }).appendTo('#paper');\r\n            this.paperScroller.center();\r\n            this.addStencil()\r\n            this.handlePaperEvents();\r\n            this.selection.collection.reset(graph.getElements());\r\n        },\r\n        jsUcfirst(string){\r\n            return string.charAt(0).toUpperCase() + string.slice(1);\r\n        },\r\n        stencilRenderHandler(positionX,positionY,arr,elNoInPorts =\"\",spaceBetweenElToX=0,spaceBetweenElToY=0){\r\n            \r\n            var customEl = joint.dia.Element.define('standard.Rectangle', {\r\n                z: 1,\r\n                size: {\r\n                    width: 44,\r\n                    height: 35\r\n                },\r\n                removable: false,\r\n                attrs: {\r\n                    image: {\r\n                        x: 5,\r\n                        y: 5,\r\n                        width: 'calc(w-10)',\r\n                        height: 'calc(h-10 )'\r\n                    },\r\n                    root: {\r\n                        magnet: false\r\n                    },\r\n                    body: {\r\n                        fill: '#FFFFFF',\r\n                        stroke: '#A0A0A0',\r\n                        width: 'calc(w)',\r\n                        height: 'calc(h)',\r\n                        strokeWidth: 2,\r\n                        rx: 5,\r\n                        ry: 5,\r\n\r\n                    }\r\n                },\r\n                ports: {\r\n                    items: [{\r\n                        id: 'out-port',\r\n                        group: 'out',\r\n\r\n                    },\r\n                    {\r\n                        id: 'in-port',\r\n                        group: 'in'\r\n                    }\r\n                    ],\r\n                    groups: {\r\n                        out: {\r\n                            markup: [{\r\n                                tagName: 'circle',\r\n                                selector: 'portBody'\r\n                            }],\r\n                            position: {\r\n                                name: 'right'\r\n                            },\r\n                            attrs: {\r\n                                portBody: {\r\n                                    r: 5,\r\n                                    magnet: 'active',\r\n                                    fill: '#187BD3',\r\n                                    stroke: '#187BD3'\r\n\r\n                                }\r\n                            }\r\n                        },\r\n                        in: {\r\n                            markup: [{\r\n                                tagName: 'circle',\r\n                                selector: 'portBody'\r\n                            }],\r\n                            position: {\r\n                                name: 'left'\r\n                            },\r\n                            attrs: {\r\n                                portBody: {\r\n                                    r: 5,\r\n                                    magnet: 'passive',\r\n                                    fill: '#FFFFFF',\r\n                                    stroke: '#187BD3',\r\n\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                markup: [\r\n                    {\r\n                        tagName: 'rect',\r\n                        selector: 'body',\r\n                    },\r\n                    {\r\n                        tagName: 'image',\r\n                        selector: 'image'\r\n                    }, {\r\n                        tagName: 'ports',\r\n                        selector: 'ports'\r\n                    }]\r\n            })\r\n            var customElNoInPorts = joint.dia.Element.define('standard.Rectangle', {\r\n                z: 1,\r\n                theme: 'material',\r\n                size: {\r\n                    width: 44,\r\n                    height: 35\r\n                },\r\n                removable: false,\r\n                attrs: {\r\n                    image: {\r\n                        x: 5,\r\n                        y: 5,\r\n                        width: 'calc(w-10)',\r\n                        height: 'calc(h-10 )'\r\n                    },\r\n                    root: {\r\n                        magnet: false\r\n                    },\r\n                    body: {\r\n                        fill: '#FFFFFF',\r\n                        stroke: '#A0A0A0',\r\n                        width: 'calc(w)',\r\n                        height: 'calc(h)',\r\n                        strokeWidth: 2,\r\n                    },\r\n                    line: {\r\n                        connection: true,\r\n                        stroke: '#333333',\r\n                        strokeWidth: 2,\r\n                        strokeLinejoin: 'round',\r\n                        targetMarker: {\r\n                            'type': 'path',\r\n                            'd': 'M 10 -5 0 0 10 5 z'\r\n                        }\r\n                    },\r\n                },\r\n                ports: {\r\n                    items: [\r\n                        {\r\n                            id: 'out-port',\r\n                            group: 'out'\r\n                        }\r\n                    ],\r\n                    groups: {\r\n                        out: {\r\n                            markup: [{\r\n                                tagName: 'circle',\r\n                                selector: 'portBody'\r\n                            }],\r\n                            position: {\r\n                                name: 'right'\r\n                            },\r\n                            attrs: {\r\n                                portBody: {\r\n                                    r: 5,\r\n                                    magnet: 'active',\r\n                                    fill: '#187BD3',\r\n                                    stroke: '#187BD3'\r\n                                }\r\n                            }\r\n                        },\r\n\r\n                    }\r\n                },\r\n                markup: [\r\n                    {\r\n                        tagName: 'rect',\r\n                        selector: 'body',\r\n                    }, {\r\n                        tagName: 'image',\r\n                        selector: 'image'\r\n                    }, {\r\n                        tagName: 'ports',\r\n                        selector: 'ports'\r\n                    }]\r\n            })\r\n            this.arr.forEach(element => {\r\n                //chuyển thành hoa chữ đầu cho đúng định dạng file ảnh lưu\r\n                let elementName = this.jsUcfirst(element)\r\n                if (elementName === this.jsUcfirst(elNoInPorts)) {\r\n                    element = new customElNoInPorts();\r\n                }\r\n                else {\r\n                    element = new customEl();\r\n                }\r\n                element.prop('attrs/image/xlinkHref', require(`../assets/${elementName}.svg`))\r\n                this.stencilShapes.push(element.position(positionX, positionY))\r\n                if(spaceBetweenElToX>0){\r\n                    positionX += element.attributes.size.width+spaceBetweenElToX;\r\n                }\r\n                if(spaceBetweenElToY>0){\r\n                    positionY += element.attributes.size.height+spaceBetweenElToY;\r\n                }\r\n            });\r\n        },\r\n    \r\n        addStencil(){\r\n            let graph = this.graph;\r\n            let paper = this.paper;\r\n            var stencil = new joint.ui.Stencil({\r\n                paper: this.paperScroller,\r\n                width: 900,\r\n                height: 60,\r\n                dropAnimation: { duration: 200, easing: 'swing' },\r\n            });\r\n            \r\n            this.stencilRenderHandler(20,20,this.arr,\"load\",16)\r\n            document.getElementById('stencil').appendChild(stencil.render().el);\r\n            stencil.load(this.stencilShapes);\r\n        },\r\n        \r\n        addHalo(cellView){\r\n            var halo = new joint.ui.Halo({\r\n                cellView: cellView,\r\n                type: 'toolbar',\r\n                boxContent:false // bang phia duoi cell cho biet tọa độ height width và angle\r\n            });\r\n            halo.removeHandle('resize');\r\n            halo.removeHandle('rotate');\r\n            halo.removeHandle('direction');\r\n            halo.render();\r\n        },\r\n        handlePaperEvents(){\r\n            let self = this;\r\n            let paper = self.paper;\r\n            let graph = self.graph;\r\n            //nếu bấm thì =true\r\n            document.addEventListener('keydown', function (evt) {\r\n                if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\r\n                    self.ctrlDown = true;\r\n                }\r\n                if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\r\n                    self.shiftDown = true;\r\n                }\r\n            })\r\n            //nếu thả nút thì =false\r\n            document.addEventListener('keyup', function (evt) {\r\n                if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\r\n                    self.shiftDown = false;\r\n\r\n                }\r\n                if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\r\n                    self.ctrlDown = false;\r\n                }\r\n            })\r\n            paper.on('cell:pointerup',function (cellView) {\r\n                self.addHalo(cellView)\r\n                if(cellView.model.attributes['type']==='standard.Link'){\r\n                    self.$emit('select-link', {id: cellView.model.id});\r\n                }else{\r\n                    self.$emit('select-cell', {id: cellView.model.id});\r\n                }\r\n                \r\n                self.selectedElement = cellView.model;\r\n                self.selectedElement.toFront({ ignoreCommandManager: true })\r\n                // cellView.$el[0].parentElement.appendChild(cellView.$el[0])\r\n                // console.log(graph.getLinks())\r\n            })\r\n            paper.on({\r\n          //xử lý khi các sự kiện \r\n                \"cell:mouseenter\":(cellView)=>{\r\n                        cellView.model.toFront({ ignoreCommandManager: true })\r\n                },\r\n                \"cell:mouseleave\":(cellView)=>{\r\n                    cellView.model.toBack({ ignoreCommandManager: true })\r\n                    if(self.selectionNode){\r\n                        getElementPredecessorLinks(self.selectionNode).forEach((link) => {\r\n                        \r\n                            link.toFront({ ignoreCommandManager: true })\r\n                        });\r\n                    }\r\n                },\r\n            \r\n                \"element:pointerclick\":(cellView) =>{\r\n                    //chỉ đổi màu khi ko bấm ctrl\r\n                    if(self.ctrlDown ===false )\r\n                        { \r\n                            // selectElement(cellView.model)\r\n                        }\r\n                    },\r\n                    \"link:pointerclick\":(cellView) =>\r\n                        {\r\n                            // selectElement(cellView.model)\r\n                            //chon vao link thi mo cho phep doi node\r\n                            // cellView.addTools(toolsView);\r\n                        \r\n                        },\r\n                        \r\n                        //chuyển lại màu cũ khi bấm ra ngoài\r\n                    \"blank:pointerclick\":() => {\r\n                        // selectElement(null)\r\n                        paper.removeTools({ ignoreCommandManager: true });\r\n                        \r\n                        },\r\n                    \r\n                    'element:pointerup': function (cellView, evt) {\r\n                        console.log(evt)\r\n                        if (evt.ctrlKey || evt.metaKey) {\r\n                            console.log(self.selection)\r\n                            self.selection.collection.add(cellView.model);\r\n                            //loop to all the element in selection and set it to front\r\n                            self.selection.collection.models.forEach(element => {\r\n                                element.toFront({ ignoreCommandManager: true })\r\n                            })               \r\n                        }\r\n                    },\r\n                    //chuyển màu khi bấm vào link và cho nó lên trc\r\n                    'link:pointerup': function (cellView) {\r\n                        self.selectedLink = cellView.model;\r\n                        self.selectedLink.toFront({ ignoreCommandManager: true })\r\n                    },\r\n                    \r\n                    // lắng nghe sự kiện bấm ở ngoài khoange trống check shift để active select\r\n                    'blank:pointerdown':function(evt, x, y) {\r\n                        if (self.shiftDown===true) {\r\n                            // selectElement(null)\r\n                            self.paperScroller.setCursor('crosshair')\r\n                            self.selection.startSelecting(evt);\r\n                            \r\n                        } else {\r\n                            console.log(self.getAllNodes())\r\n                            \r\n                            console.log(self.getAllLinks())\r\n                            self.selection.collection.reset([]);\r\n                            self.paperScroller.startPanning(evt, x, y);\r\n                            paper.removeTools();\r\n                            self.paperScroller.setCursor('grab');\r\n                        }\r\n                \r\n                    },\r\n            })\r\n            //xóa el nếu chọn lại lần 2 khi bấm ctrl\r\n            self.selection.on('selection-box:pointerdown', function (cellView, evt) {\r\n                if (evt.ctrlKey || evt.metaKey) {\r\n                    self.selection.collection.remove(cellView.model);\r\n                }\r\n            });\r\n                //kết hợp bấm ctrl để check các tổ hợp phím ctrl + C,V,Z,Y,A...\r\n    document.addEventListener('keydown', function (evt) {\r\n        self.clipboard = new joint.ui.Clipboard();\r\n        \r\n        \r\n        if (evt.code === \"NumpadAdd\" && self.shiftDown === true) {\r\n            // console.log(evt.code)\r\n            self.paperScroller.zoom(0.2, { max: 4 });\r\n        }\r\n        if (evt.code === \"NumpadSubtract\" && shiftDown === true) {\r\n            self.paperScroller.zoom(-0.2, { min: 0.2 });\r\n            // console.log(evt.code)\r\n        }\r\n        //check+ A\r\n        if (evt.code === \"KeyA\" && self.ctrlDown === true) {\r\n            self.selection.collection.reset(graph.getElements())\r\n            evt.preventDefault();\r\n        }//check ctrl + Z\r\n        if (evt.code === \"KeyZ\" && self.ctrlDown === true) {\r\n            self.commandManager.undo();\r\n            // console.log(selectionNode)\r\n            \r\n            unhighlightCell(self.selectionNode);\r\n            graph.getLinks().forEach((link) => unhighlightCell(link));\r\n        \r\n            // console.log(selectionNode)\r\n            self.selectionNode=null\r\n        }\r\n        //check ctrl + Y\r\n        if (evt.code === \"KeyY\" && self.ctrlDown === true) {\r\n            self.commandManager.redo();\r\n            // selectElement(null)\r\n        }\r\n        //check ctrl + V ,ctrl + C, ctrl+X\r\n        if (evt.code === \"KeyX\" && self.ctrlDown === true) {\r\n\r\n            self.clipboard.cutElements(self.selection.collection, paper.model)\r\n        }\r\n        if (evt.code === \"KeyC\" && self.ctrlDown === true) {\r\n            self.clipboard.copyElements(self.selection.collection, graph);\r\n        }\r\n        if (evt.code === \"KeyV\" && self.ctrlDown === true) {\r\n            var pastedCells = self.clipboard.pasteCells(graph, {\r\n                translate: { dx: 40, dy: 40 },\r\n                useLocalStorage: true\r\n            });\r\n\r\n            var elements = _.filter(pastedCells, function (cell) {\r\n                return cell.isElement();\r\n            });\r\n            // Make sure pasted elements get selected immediately. This makes the UX better as\r\n            // the user can immediately manipulate the pasted elements.\r\n            self.selection.collection.reset(elements);\r\n\r\n        }\r\n    })\r\n   \r\n        },\r\n        getAllLinks(){\r\n             return this.graph.getLinks()\r\n        },\r\n        getAllNodes(){\r\n            return this.graph.getCells()\r\n        },\r\n        clearAll(){\r\n            return this.graph.clear()\r\n        },\r\n        getNodeAttr(id){\r\n            let node = this.graph.getCell(id);\r\n            if(node){\r\n                return node.attributes;\r\n            }else{\r\n                return {}\r\n            }\r\n        },\r\n        render(){\r\n            let nodeInfo=this.nodes;\r\n            let linkInfo=this.links;\r\n            let nodeType=nodeInfo.nodeType;\r\n            //checknode\r\n            if(nodeType){\r\n                let cell =new joint.shapes.nodeType({\r\n                    position: nodeInfo.position,\r\n                    id: nodeInfo.id,\r\n                })\r\n                this.graph.addCell(cell)\r\n            }\r\n            else{\r\n                console.error(\"Node type '\" + nodeType + \"' is not defined\");\r\n            }\r\n            if(linkInfo){\r\n                let link =new joint.shapes.standard.Link();\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}