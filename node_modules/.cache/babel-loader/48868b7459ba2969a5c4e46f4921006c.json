{"ast":null,"code":"export default {\n  name: 'DataFlow',\n  props: {\n    instanceKey: {\n      defaul: ''\n    },\n    action: {\n      defaul: 'view'\n    },\n    width: {\n      type: [String, Number],\n      default: 800\n    },\n    height: {\n      type: [String, Number],\n      default: 250\n    },\n    gridSize: {\n      type: Number,\n      default: 1\n    },\n    drawGrid: {\n      type: [Object, Boolean],\n      default: false\n    },\n    background: {\n      type: [Object, Boolean],\n      default: false\n    },\n    readonly: {\n      type: Boolean,\n      default: false\n    },\n    highLightLinks: {\n      type: Array,\n\n      default() {\n        return [];\n      }\n\n    }\n  },\n\n  data() {\n    return {\n      stencilShapes: [],\n      selectionNode: null,\n      selectedElement: null,\n      selectedLink: null,\n      //check ctrl shift\n      ctrlDown: false,\n      shiftDown: false,\n      color: \"rgb(255 136 0)\",\n      arr: ['filter', 'formula', 'join', 'load', 'pivot', 'sample', 'script', 'select', 'sort', 'summarize', 'transposeTable', 'union', 'weightAvg']\n    };\n  },\n\n  created() {\n    this.graph = new joint.dia.Graph();\n  },\n\n  mounted() {\n    this.initPaper();\n  },\n\n  methods: {\n    initPaper() {\n      let graph = this.graph;\n      var commandManager = new joint.dia.CommandManager({\n        graph: graph,\n        cmdBeforeAdd: (cmdName, cell, graph, options = {}) => {\n          return !options.ignoreCommandManager;\n        }\n      });\n      this.paper = new joint.dia.Paper({\n        width: 1000,\n        height: 800,\n        model: this.graph,\n        async: true,\n        sorting: joint.dia.Paper.sorting.APPROX,\n        gridSize: 10,\n        drawGrid: true,\n        restrictTranslate: true,\n        stopDelegation: false,\n        interactive: {\n          vertexAdd: false\n        },\n        // background: { color: '#F3F7F6' },\n        // defaultConnectionPoint: { name: 'boundary' },\n        // defaultConnector: {\n        //     name: \"rounded\"\n        //   },\n        //   defaultRouter: {\n        //     name: \"manhattan\",\n        //     args: {\n        //       step: 10,\n        //       endDirections: [\"bottom\"],\n        //       startDirections: [\"top\"],\n        //       padding: { bottom: 20 }\n        //     }\n        //   },\n        snapLinks: {\n          radius: 75\n        },\n        linkPinning: false,\n        multiLinks: false,\n        defaultRouter: {\n          name: 'manhattan',\n          args: {\n            padding: 10\n          }\n        },\n        defaultConnector: {\n          name: 'rounded'\n        },\n        validateConnection: function (cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\n          // Prevent linking from input ports.\n          if (magnetS && magnetS.getAttribute('port-group') === 'in') return false; // Prevent linking from output ports to input ports within one element.\n\n          if (cellViewS === cellViewT) return false; // Prevent linking to input ports.\n\n          return magnetT && magnetT.getAttribute('port-group') === 'in' || cellViewS.model.get('type') === 'qad.Question' && cellViewT.model.get('type') === 'qad.Answer';\n        },\n        // validateConnection: function (view1, _magnet1, view2, _magnet2) {\n        //     // Do not allow loop links (Element to Link, Element A to Element B is valid).\n        //     return view1 !== view2;\n        // },\n        interactive: {\n          linkMove: true,\n          labelMove: true,\n          arrowheadMove: true,\n          vertexMove: false,\n          vertexAdd: false,\n          vertexRemove: false,\n          useLinkTools: false\n        },\n        defaultLink: function () {\n          return new joint.shapes.standard.Link({\n            attrs: {\n              z: 1,\n              line: {\n                connection: true,\n                stroke: '#707070',\n                strokeLinejoin: 'round'\n              },\n              wrapper: {\n                connection: true,\n                strokeWidth: 10,\n                strokeLinejoin: 'round'\n              }\n            },\n            markup: [{\n              tagName: 'path',\n              selector: 'wrapper',\n              attributes: {\n                'fill': 'none',\n                'stroke': 'transparent'\n              }\n            }, {\n              tagName: 'path',\n              selector: 'line',\n              attributes: {\n                'fill': 'none'\n              }\n            }]\n          });\n        }\n      });\n      this.paperScroller = new joint.ui.PaperScroller({\n        paper: this.paper,\n        autoResizePaper: true,\n        scrollWhileDragging: true,\n        cursor: 'grab'\n      });\n      this.selection = new joint.ui.Selection({\n        theme: 'material',\n        paper: this.paper,\n        useModelGeometry: true,\n        allowTranslate: true\n      });\n      this.snaplines = new joint.ui.Snaplines({\n        paper: this.paper\n      });\n      this.snaplines.startListening(); //render paper\n\n      document.getElementById('paper').appendChild(this.paperScroller.render().el); //render paperScroller\n\n      this.paper.on('blank:pointerdown', this.paperScroller.startPanning);\n      this.paperScroller.$el.css({\n        width: 900,\n        height: 600\n      }).appendTo('#paper');\n      this.paperScroller.center();\n      this.addStencil();\n      this.handlePaperEvents();\n      this.selection.collection.reset(graph.getElements());\n    },\n\n    jsUcfirst(string) {\n      return string.charAt(0).toUpperCase() + string.slice(1);\n    },\n\n    stencilRenderHandler(positionX, positionY, arr, elNoInPorts = \"\", spaceBetweenElToX = 0, spaceBetweenElToY = 0) {\n      var customEl = joint.dia.Element.define('standard.Rectangle', {\n        z: 1,\n        size: {\n          width: 44,\n          height: 35\n        },\n        removable: false,\n        attrs: {\n          image: {\n            x: 5,\n            y: 5,\n            width: 'calc(w-10)',\n            height: 'calc(h-10 )'\n          },\n          root: {\n            magnet: false\n          },\n          body: {\n            fill: '#FFFFFF',\n            stroke: '#A0A0A0',\n            width: 'calc(w)',\n            height: 'calc(h)',\n            strokeWidth: 2,\n            rx: 5,\n            ry: 5\n          }\n        },\n        ports: {\n          items: [{\n            id: 'out-port',\n            group: 'out'\n          }, {\n            id: 'in-port',\n            group: 'in'\n          }],\n          groups: {\n            out: {\n              markup: [{\n                tagName: 'circle',\n                selector: 'portBody'\n              }],\n              position: {\n                name: 'right'\n              },\n              attrs: {\n                portBody: {\n                  r: 5,\n                  magnet: 'active',\n                  fill: '#187BD3',\n                  stroke: '#187BD3'\n                }\n              }\n            },\n            in: {\n              markup: [{\n                tagName: 'circle',\n                selector: 'portBody'\n              }],\n              position: {\n                name: 'left'\n              },\n              attrs: {\n                portBody: {\n                  r: 5,\n                  magnet: 'passive',\n                  fill: '#FFFFFF',\n                  stroke: '#187BD3'\n                }\n              }\n            }\n          }\n        },\n        markup: [{\n          tagName: 'rect',\n          selector: 'body'\n        }, {\n          tagName: 'image',\n          selector: 'image'\n        }, {\n          tagName: 'ports',\n          selector: 'ports'\n        }]\n      });\n      var customElNoInPorts = joint.dia.Element.define('standard.Rectangle', {\n        z: 1,\n        theme: 'material',\n        size: {\n          width: 44,\n          height: 35\n        },\n        removable: false,\n        attrs: {\n          image: {\n            x: 5,\n            y: 5,\n            width: 'calc(w-10)',\n            height: 'calc(h-10 )'\n          },\n          root: {\n            magnet: false\n          },\n          body: {\n            fill: '#FFFFFF',\n            stroke: '#A0A0A0',\n            width: 'calc(w)',\n            height: 'calc(h)',\n            strokeWidth: 2\n          },\n          line: {\n            connection: true,\n            stroke: '#333333',\n            strokeWidth: 2,\n            strokeLinejoin: 'round',\n            targetMarker: {\n              'type': 'path',\n              'd': 'M 10 -5 0 0 10 5 z'\n            }\n          }\n        },\n        ports: {\n          items: [{\n            id: 'out-port',\n            group: 'out'\n          }],\n          groups: {\n            out: {\n              markup: [{\n                tagName: 'circle',\n                selector: 'portBody'\n              }],\n              position: {\n                name: 'right'\n              },\n              attrs: {\n                portBody: {\n                  r: 5,\n                  magnet: 'active',\n                  fill: '#187BD3',\n                  stroke: '#187BD3'\n                }\n              }\n            }\n          }\n        },\n        markup: [{\n          tagName: 'rect',\n          selector: 'body'\n        }, {\n          tagName: 'image',\n          selector: 'image'\n        }, {\n          tagName: 'ports',\n          selector: 'ports'\n        }]\n      });\n      this.arr.forEach(element => {\n        //chuyển thành hoa chữ đầu cho đúng định dạng file ảnh lưu\n        let elementName = this.jsUcfirst(element);\n\n        if (elementName === this.jsUcfirst(elNoInPorts)) {\n          element = new customElNoInPorts();\n        } else {\n          element = new customEl();\n        }\n\n        element.prop('attrs/image/xlinkHref', require(`../assets/${elementName}.svg`));\n        this.stencilShapes.push(element.position(positionX, positionY));\n\n        if (spaceBetweenElToX > 0) {\n          positionX += element.attributes.size.width + spaceBetweenElToX;\n        }\n\n        if (spaceBetweenElToY > 0) {\n          positionY += element.attributes.size.height + spaceBetweenElToY;\n        }\n      });\n    },\n\n    addStencil() {\n      let graph = this.graph;\n      let paper = this.paper;\n      var stencil = new joint.ui.Stencil({\n        paper: this.paperScroller,\n        width: 900,\n        height: 60,\n        dropAnimation: {\n          duration: 200,\n          easing: 'swing'\n        }\n      });\n      this.stencilRenderHandler(20, 20, this.arr, \"load\", 16);\n      document.getElementById('stencil').appendChild(stencil.render().el);\n      stencil.load(this.stencilShapes);\n    },\n\n    getNodeAttr(id) {\n      let node = this.graph.getCell(id);\n\n      if (node) {\n        return node.attributes;\n      } else {\n        return {};\n      }\n    },\n\n    addHalo(cellView) {\n      var halo = new joint.ui.Halo({\n        cellView: cellView,\n        type: 'toolbar',\n        boxContent: false // bang phia duoi cell cho biet tọa độ height width và angle\n\n      });\n      halo.removeHandle('resize');\n      halo.removeHandle('rotate');\n      halo.removeHandle('direction');\n      halo.render();\n    },\n\n    handlePaperEvents() {\n      let self = this;\n      let paper = self.paper;\n      let graph = self.graph; //nếu bấm thì =true\n\n      document.addEventListener('keydown', function (evt) {\n        if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\n          self.ctrlDown = true;\n        }\n\n        if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\n          self.shiftDown = true;\n        }\n      }); //nếu thả nút thì =false\n\n      document.addEventListener('keyup', function (evt) {\n        if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\n          self.shiftDown = false;\n        }\n\n        if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\n          self.ctrlDown = false;\n        }\n      });\n      paper.on('cell:pointerup', function (cellView) {\n        self.addHalo(cellView);\n\n        if (cellView.model.attributes['type'] === 'standard.Link') {\n          self.$emit('select-link', {\n            id: cellView.model.id\n          });\n        } else {\n          self.$emit('select-cell', {\n            id: cellView.model.id\n          });\n        }\n\n        self.selectedElement = cellView.model;\n        self.selectedElement.toFront({\n          ignoreCommandManager: true\n        }); // cellView.$el[0].parentElement.appendChild(cellView.$el[0])\n        // console.log(graph.getLinks())\n      });\n      paper.on({\n        //xử lý khi các sự kiện \n        \"cell:mouseenter\": cellView => {\n          cellView.model.toFront({\n            ignoreCommandManager: true\n          });\n        },\n        \"cell:mouseleave\": cellView => {\n          cellView.model.toBack({\n            ignoreCommandManager: true\n          });\n\n          if (self.selectionNode) {\n            getElementPredecessorLinks(self.selectionNode).forEach(link => {\n              link.toFront({\n                ignoreCommandManager: true\n              });\n            });\n          }\n        },\n        \"element:pointerclick\": cellView => {\n          //chỉ đổi màu khi ko bấm ctrl\n          if (self.ctrlDown === false) {// selectElement(cellView.model)\n          }\n        },\n        \"link:pointerclick\": cellView => {// selectElement(cellView.model)\n          //chon vao link thi mo cho phep doi node\n          // cellView.addTools(toolsView);\n        },\n        //chuyển lại màu cũ khi bấm ra ngoài\n        \"blank:pointerclick\": () => {\n          // selectElement(null)\n          paper.removeTools({\n            ignoreCommandManager: true\n          });\n        },\n        'element:pointerup': function (cellView, evt) {\n          console.log(evt);\n\n          if (evt.ctrlKey || evt.metaKey) {\n            console.log(self.selection);\n            self.selection.collection.add(cellView.model); //loop to all the element in selection and set it to front\n\n            self.selection.collection.models.forEach(element => {\n              element.toFront({\n                ignoreCommandManager: true\n              });\n            });\n          }\n        },\n        //chuyển màu khi bấm vào link và cho nó lên trc\n        'link:pointerup': function (cellView) {\n          self.selectedLink = cellView.model;\n          self.selectedLink.toFront({\n            ignoreCommandManager: true\n          });\n        },\n        // lắng nghe sự kiện bấm ở ngoài khoange trống check shift để active select\n        'blank:pointerdown': function (evt, x, y) {\n          if (self.shiftDown === true) {\n            // selectElement(null)\n            self.paperScroller.setCursor('crosshair');\n            self.selection.startSelecting(evt);\n            console.log(self.selection);\n          } else {\n            console.log(self.selection.collection); // self.selection.collection.reset([]);\n\n            self.paperScroller.startPanning(evt, x, y);\n            paper.removeTools();\n            self.paperScroller.setCursor('grab');\n          }\n        }\n      }); //xóa el nếu chọn lại lần 2 khi bấm ctrl\n\n      this.selection.on('selection-box:pointerdown', function (cellView, evt) {\n        if (evt.ctrlKey || evt.metaKey) {\n          this.selection.collection.remove(cellView.model);\n        }\n      });\n    },\n\n    getAllLinks() {\n      return this.graph.getLinks();\n    },\n\n    getAllNodes() {\n      return this.graph.getCells();\n    },\n\n    clearAll() {\n      return this.graph.clear();\n    },\n\n    getNodeAttr(id) {\n      let node = this.graph.getCell(id);\n\n      if (node) {\n        return node.attributes;\n      } else {\n        return {};\n      }\n    },\n\n    render(node = {}, link = {}) {}\n\n  }\n};","map":{"version":3,"mappings":"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","names":["name","props","instanceKey","defaul","action","width","type","String","Number","default","height","gridSize","drawGrid","Object","Boolean","background","readonly","highLightLinks","Array","data","stencilShapes","selectionNode","selectedElement","selectedLink","ctrlDown","shiftDown","color","arr","created","graph","joint","dia","Graph","mounted","initPaper","methods","commandManager","CommandManager","cmdBeforeAdd","cmdName","cell","options","ignoreCommandManager","paper","Paper","model","async","sorting","APPROX","restrictTranslate","stopDelegation","interactive","vertexAdd","snapLinks","radius","linkPinning","multiLinks","defaultRouter","args","padding","defaultConnector","validateConnection","cellViewS","magnetS","cellViewT","magnetT","end","linkView","getAttribute","get","linkMove","labelMove","arrowheadMove","vertexMove","vertexRemove","useLinkTools","defaultLink","shapes","standard","Link","attrs","z","line","connection","stroke","strokeLinejoin","wrapper","strokeWidth","markup","tagName","selector","attributes","paperScroller","ui","PaperScroller","autoResizePaper","scrollWhileDragging","cursor","selection","Selection","theme","useModelGeometry","allowTranslate","snaplines","Snaplines","startListening","document","getElementById","appendChild","render","el","on","startPanning","$el","css","appendTo","center","addStencil","handlePaperEvents","collection","reset","getElements","jsUcfirst","string","charAt","toUpperCase","slice","stencilRenderHandler","positionX","positionY","elNoInPorts","spaceBetweenElToX","spaceBetweenElToY","customEl","Element","define","size","removable","image","x","y","root","magnet","body","fill","rx","ry","ports","items","id","group","groups","out","position","portBody","r","in","customElNoInPorts","targetMarker","forEach","element","elementName","prop","require","push","stencil","Stencil","dropAnimation","duration","easing","load","getNodeAttr","node","getCell","addHalo","cellView","halo","Halo","boxContent","removeHandle","self","addEventListener","evt","code","$emit","toFront","toBack","getElementPredecessorLinks","link","removeTools","console","log","ctrlKey","metaKey","add","models","setCursor","startSelecting","remove","getAllLinks","getLinks","getAllNodes","getCells","clearAll","clear"],"sourceRoot":"","sources":["C:\\Users\\Admin\\dataflow-test\\src\\components\\dataflow.vue"],"sourcesContent":["<template>\r\n  <div id=\"main\" >\r\n    <div class=\"btn_contain\">\r\n        <button id=\"btn-zoomout\" class=\"btn\">zoom out</button>\r\n        <button id=\"btn-zoomin\" class=\"btn\">zoom in</button>\r\n        <button id=\"btn-center\" class=\"btn\">center</button>\r\n        <button id=\"btn-center-content\" class=\"btn\">center content</button>\r\n    </div>\r\n    <div ref=\"nodeStencile\" id=\"stencil\"></div>\r\n    \r\n    <div id=\"paper\" ></div>\r\n    <div id=\"navigator\"></div>\r\n    \r\n    \r\n        </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name:'DataFlow',\r\n    props: {\r\n        instanceKey: {\r\n            defaul: ''\r\n        },\r\n        action: {\r\n            defaul: 'view'\r\n        },\r\n\t\twidth: {\r\n\t\t\ttype: [String, Number],\r\n\t\t\tdefault: 800\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: [String, Number],\r\n\t\t\tdefault: 250\r\n\t\t},\r\n\t\tgridSize: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 1\r\n\t\t},\r\n\t\tdrawGrid: {\r\n\t\t\ttype: [Object, Boolean],\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tbackground: {\r\n\t\t\ttype: [Object, Boolean],\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\treadonly: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n        highLightLinks:{\r\n            type: Array,\r\n            default(){\r\n                return []\r\n            }\r\n        }\r\n\t},\r\n    data(){\r\n        return{\r\n            stencilShapes : [],\r\n            selectionNode : null,\r\n            selectedElement : null,\r\n            selectedLink : null,\r\n            \r\n            //check ctrl shift\r\n            ctrlDown : false,\r\n            shiftDown : false,\r\n            color : \"rgb(255 136 0)\",\r\n            arr: ['filter', 'formula', 'join', 'load', 'pivot', 'sample', 'script', 'select', 'sort', 'summarize', 'transposeTable', 'union', 'weightAvg'],\r\n        }\r\n    },\r\n    created() {\r\n        this.graph = new joint.dia.Graph;\r\n    },\r\n    mounted() {\r\n        this.initPaper()\r\n    },\r\n    methods: {\r\n        \r\n        initPaper(){\r\n            let graph = this.graph;\r\n            var commandManager = new joint.dia.CommandManager({\r\n                graph: graph,\r\n                cmdBeforeAdd: (cmdName, cell, graph, options = {}) => {\r\n                    return !options.ignoreCommandManager;\r\n                }\r\n            });\r\n            this.paper = new joint.dia.Paper({  \r\n                \r\n                width: 1000,\r\n                height: 800,\r\n                model: this.graph,\r\n                async: true,\r\n                sorting: joint.dia.Paper.sorting.APPROX,\r\n                gridSize: 10,\r\n                drawGrid: true,\r\n                restrictTranslate: true,\r\n                stopDelegation: false,\r\n                \r\n                interactive: { vertexAdd: false } ,\r\n                // background: { color: '#F3F7F6' },\r\n                // defaultConnectionPoint: { name: 'boundary' },\r\n                // defaultConnector: {\r\n                //     name: \"rounded\"\r\n                //   },\r\n                //   defaultRouter: {\r\n                //     name: \"manhattan\",\r\n                //     args: {\r\n                //       step: 10,\r\n                //       endDirections: [\"bottom\"],\r\n                //       startDirections: [\"top\"],\r\n                //       padding: { bottom: 20 }\r\n                //     }\r\n                //   },\r\n                snapLinks: {\r\n                    radius: 75\r\n                },\r\n                linkPinning: false,\r\n                multiLinks: false,\r\n                defaultRouter: { name: 'manhattan', args: { padding: 10 }},\r\n                defaultConnector: { name: 'rounded' },\r\n                validateConnection: function(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\r\n                    // Prevent linking from input ports.\r\n                    if (magnetS && magnetS.getAttribute('port-group') === 'in') return false;\r\n                    // Prevent linking from output ports to input ports within one element.\r\n                    if (cellViewS === cellViewT) return false;\r\n                    // Prevent linking to input ports.\r\n                    return (magnetT && magnetT.getAttribute('port-group') === 'in') || (cellViewS.model.get('type') === 'qad.Question' && cellViewT.model.get('type') === 'qad.Answer');\r\n                },\r\n                // validateConnection: function (view1, _magnet1, view2, _magnet2) {\r\n                //     // Do not allow loop links (Element to Link, Element A to Element B is valid).\r\n                //     return view1 !== view2;\r\n                // },\r\n                interactive: {\r\n                    linkMove: true,\r\n                    labelMove: true,\r\n                    arrowheadMove: true,\r\n                    vertexMove: false,\r\n                    vertexAdd: false,\r\n                    vertexRemove: false,\r\n                    useLinkTools: false,\r\n                },\r\n                defaultLink: function () {\r\n                    return new joint.shapes.standard.Link({\r\n                        attrs: {\r\n                            z:1,\r\n                            line: {\r\n                                connection: true,\r\n                                stroke: '#707070',\r\n                                strokeLinejoin: 'round',\r\n                            },\r\n                            wrapper: {\r\n                                connection: true,\r\n                                strokeWidth: 10,\r\n                                strokeLinejoin: 'round'\r\n                            },\r\n                            \r\n                        },\r\n                        \r\n                        markup: [{\r\n                            tagName: 'path',\r\n                            selector: 'wrapper',\r\n                            attributes: {\r\n                                'fill': 'none',\r\n                                \r\n                                'stroke': 'transparent'\r\n                            }\r\n                        }, {\r\n                            tagName: 'path',\r\n                            selector: 'line',\r\n                            attributes: {\r\n                                'fill': 'none',\r\n                                \r\n                            }\r\n                        }]\r\n                    });\r\n                }\r\n            });\r\n            this.paperScroller = new joint.ui.PaperScroller({\r\n                paper: this.paper,\r\n                autoResizePaper: true,\r\n                scrollWhileDragging: true,\r\n                cursor: 'grab'\r\n                \r\n            });\r\n            this.selection = new joint.ui.Selection({\r\n                theme: 'material',\r\n                paper: this.paper,\r\n                useModelGeometry: true,\r\n                allowTranslate: true,\r\n            });\r\n            this.snaplines = new joint.ui.Snaplines({ paper: this.paper })\r\n            this.snaplines.startListening()\r\n            //render paper\r\n            document.getElementById('paper').appendChild(this.paperScroller.render().el);\r\n            //render paperScroller\r\n            this.paper.on('blank:pointerdown', this.paperScroller.startPanning);\r\n            this.paperScroller.$el.css({ width: 900, height: 600 }).appendTo('#paper');\r\n            this.paperScroller.center();\r\n            this.addStencil()\r\n            this.handlePaperEvents();\r\n            this.selection.collection.reset(graph.getElements());\r\n        },\r\n        jsUcfirst(string){\r\n            return string.charAt(0).toUpperCase() + string.slice(1);\r\n        },\r\n        stencilRenderHandler(positionX,positionY,arr,elNoInPorts =\"\",spaceBetweenElToX=0,spaceBetweenElToY=0){\r\n            \r\n            var customEl = joint.dia.Element.define('standard.Rectangle', {\r\n                z: 1,\r\n                size: {\r\n                    width: 44,\r\n                    height: 35\r\n                },\r\n                removable: false,\r\n                attrs: {\r\n                    image: {\r\n                        x: 5,\r\n                        y: 5,\r\n                        width: 'calc(w-10)',\r\n                        height: 'calc(h-10 )'\r\n                    },\r\n                    root: {\r\n                        magnet: false\r\n                    },\r\n                    body: {\r\n                        fill: '#FFFFFF',\r\n                        stroke: '#A0A0A0',\r\n                        width: 'calc(w)',\r\n                        height: 'calc(h)',\r\n                        strokeWidth: 2,\r\n                        rx: 5,\r\n                        ry: 5,\r\n\r\n                    }\r\n                },\r\n                ports: {\r\n                    items: [{\r\n                        id: 'out-port',\r\n                        group: 'out',\r\n\r\n                    },\r\n                    {\r\n                        id: 'in-port',\r\n                        group: 'in'\r\n                    }\r\n                    ],\r\n                    groups: {\r\n                        out: {\r\n                            markup: [{\r\n                                tagName: 'circle',\r\n                                selector: 'portBody'\r\n                            }],\r\n                            position: {\r\n                                name: 'right'\r\n                            },\r\n                            attrs: {\r\n                                portBody: {\r\n                                    r: 5,\r\n                                    magnet: 'active',\r\n                                    fill: '#187BD3',\r\n                                    stroke: '#187BD3'\r\n\r\n                                }\r\n                            }\r\n                        },\r\n                        in: {\r\n                            markup: [{\r\n                                tagName: 'circle',\r\n                                selector: 'portBody'\r\n                            }],\r\n                            position: {\r\n                                name: 'left'\r\n                            },\r\n                            attrs: {\r\n                                portBody: {\r\n                                    r: 5,\r\n                                    magnet: 'passive',\r\n                                    fill: '#FFFFFF',\r\n                                    stroke: '#187BD3',\r\n\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                markup: [\r\n                    {\r\n                        tagName: 'rect',\r\n                        selector: 'body',\r\n                    },\r\n                    {\r\n                        tagName: 'image',\r\n                        selector: 'image'\r\n                    }, {\r\n                        tagName: 'ports',\r\n                        selector: 'ports'\r\n                    }]\r\n            })\r\n            var customElNoInPorts = joint.dia.Element.define('standard.Rectangle', {\r\n                z: 1,\r\n                theme: 'material',\r\n                size: {\r\n                    width: 44,\r\n                    height: 35\r\n                },\r\n                removable: false,\r\n                attrs: {\r\n                    image: {\r\n                        x: 5,\r\n                        y: 5,\r\n                        width: 'calc(w-10)',\r\n                        height: 'calc(h-10 )'\r\n                    },\r\n                    root: {\r\n                        magnet: false\r\n                    },\r\n                    body: {\r\n                        fill: '#FFFFFF',\r\n                        stroke: '#A0A0A0',\r\n                        width: 'calc(w)',\r\n                        height: 'calc(h)',\r\n                        strokeWidth: 2,\r\n                    },\r\n                    line: {\r\n                        connection: true,\r\n                        stroke: '#333333',\r\n                        strokeWidth: 2,\r\n                        strokeLinejoin: 'round',\r\n                        targetMarker: {\r\n                            'type': 'path',\r\n                            'd': 'M 10 -5 0 0 10 5 z'\r\n                        }\r\n                    },\r\n                },\r\n                ports: {\r\n                    items: [\r\n                        {\r\n                            id: 'out-port',\r\n                            group: 'out'\r\n                        }\r\n                    ],\r\n                    groups: {\r\n                        out: {\r\n                            markup: [{\r\n                                tagName: 'circle',\r\n                                selector: 'portBody'\r\n                            }],\r\n                            position: {\r\n                                name: 'right'\r\n                            },\r\n                            attrs: {\r\n                                portBody: {\r\n                                    r: 5,\r\n                                    magnet: 'active',\r\n                                    fill: '#187BD3',\r\n                                    stroke: '#187BD3'\r\n                                }\r\n                            }\r\n                        },\r\n\r\n                    }\r\n                },\r\n                markup: [\r\n                    {\r\n                        tagName: 'rect',\r\n                        selector: 'body',\r\n                    }, {\r\n                        tagName: 'image',\r\n                        selector: 'image'\r\n                    }, {\r\n                        tagName: 'ports',\r\n                        selector: 'ports'\r\n                    }]\r\n            })\r\n            this.arr.forEach(element => {\r\n                //chuyển thành hoa chữ đầu cho đúng định dạng file ảnh lưu\r\n                let elementName = this.jsUcfirst(element)\r\n                if (elementName === this.jsUcfirst(elNoInPorts)) {\r\n                    element = new customElNoInPorts();\r\n                }\r\n                else {\r\n                    element = new customEl();\r\n                }\r\n                element.prop('attrs/image/xlinkHref', require(`../assets/${elementName}.svg`))\r\n                this.stencilShapes.push(element.position(positionX, positionY))\r\n                if(spaceBetweenElToX>0){\r\n                    positionX += element.attributes.size.width+spaceBetweenElToX;\r\n                }\r\n                if(spaceBetweenElToY>0){\r\n                    positionY += element.attributes.size.height+spaceBetweenElToY;\r\n                }\r\n            });\r\n        },\r\n    \r\n        addStencil(){\r\n            let graph = this.graph;\r\n            let paper = this.paper;\r\n            var stencil = new joint.ui.Stencil({\r\n                paper: this.paperScroller,\r\n                width: 900,\r\n                height: 60,\r\n                dropAnimation: { duration: 200, easing: 'swing' },\r\n            });\r\n            \r\n            this.stencilRenderHandler(20,20,this.arr,\"load\",16)\r\n            document.getElementById('stencil').appendChild(stencil.render().el);\r\n            stencil.load(this.stencilShapes);\r\n        },\r\n        getNodeAttr(id){\r\n            let node = this.graph.getCell(id);\r\n            if(node){\r\n                return node.attributes;\r\n            }else{\r\n                return {}\r\n            }\r\n        },\r\n        addHalo(cellView){\r\n            var halo = new joint.ui.Halo({\r\n                cellView: cellView,\r\n                type: 'toolbar',\r\n                boxContent:false // bang phia duoi cell cho biet tọa độ height width và angle\r\n            });\r\n            halo.removeHandle('resize');\r\n            halo.removeHandle('rotate');\r\n            halo.removeHandle('direction');\r\n            halo.render();\r\n        },\r\n        handlePaperEvents(){\r\n            let self = this;\r\n            let paper = self.paper;\r\n            let graph = self.graph;\r\n            //nếu bấm thì =true\r\n            document.addEventListener('keydown', function (evt) {\r\n                if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\r\n                    self.ctrlDown = true;\r\n                }\r\n                if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\r\n                    self.shiftDown = true;\r\n                }\r\n            })\r\n            //nếu thả nút thì =false\r\n            document.addEventListener('keyup', function (evt) {\r\n                if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\r\n                    self.shiftDown = false;\r\n\r\n                }\r\n                if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\r\n                    self.ctrlDown = false;\r\n                }\r\n            })\r\n            paper.on('cell:pointerup',function (cellView) {\r\n                self.addHalo(cellView)\r\n                if(cellView.model.attributes['type']==='standard.Link'){\r\n                    self.$emit('select-link', {id: cellView.model.id});\r\n                }else{\r\n                    self.$emit('select-cell', {id: cellView.model.id});\r\n                }\r\n                \r\n                self.selectedElement = cellView.model;\r\n                self.selectedElement.toFront({ ignoreCommandManager: true })\r\n                // cellView.$el[0].parentElement.appendChild(cellView.$el[0])\r\n                // console.log(graph.getLinks())\r\n            })\r\n            paper.on({\r\n          //xử lý khi các sự kiện \r\n                \"cell:mouseenter\":(cellView)=>{\r\n                        cellView.model.toFront({ ignoreCommandManager: true })\r\n                },\r\n                \"cell:mouseleave\":(cellView)=>{\r\n                    cellView.model.toBack({ ignoreCommandManager: true })\r\n                    if(self.selectionNode){\r\n                        getElementPredecessorLinks(self.selectionNode).forEach((link) => {\r\n                        \r\n                            link.toFront({ ignoreCommandManager: true })\r\n                        });\r\n                    }\r\n                },\r\n            \r\n                \"element:pointerclick\":(cellView) =>{\r\n                    //chỉ đổi màu khi ko bấm ctrl\r\n                    if(self.ctrlDown ===false )\r\n                        { \r\n                            // selectElement(cellView.model)\r\n                        }\r\n                    },\r\n                    \"link:pointerclick\":(cellView) =>\r\n                        {\r\n                            // selectElement(cellView.model)\r\n                            //chon vao link thi mo cho phep doi node\r\n                            // cellView.addTools(toolsView);\r\n                        \r\n                        },\r\n                        \r\n                        //chuyển lại màu cũ khi bấm ra ngoài\r\n                    \"blank:pointerclick\":() => {\r\n                        // selectElement(null)\r\n                        paper.removeTools({ ignoreCommandManager: true });\r\n                        \r\n                        },\r\n                    \r\n                    'element:pointerup': function (cellView, evt) {\r\n                        console.log(evt)\r\n                        if (evt.ctrlKey || evt.metaKey) {\r\n                            console.log(self.selection)\r\n                            self.selection.collection.add(cellView.model);\r\n                            //loop to all the element in selection and set it to front\r\n                            self.selection.collection.models.forEach(element => {\r\n                                element.toFront({ ignoreCommandManager: true })\r\n                            })               \r\n                        }\r\n                    },\r\n                    //chuyển màu khi bấm vào link và cho nó lên trc\r\n                    'link:pointerup': function (cellView) {\r\n                        self.selectedLink = cellView.model;\r\n                        self.selectedLink.toFront({ ignoreCommandManager: true })\r\n                    },\r\n                    \r\n                    // lắng nghe sự kiện bấm ở ngoài khoange trống check shift để active select\r\n                    'blank:pointerdown':function(evt, x, y) {\r\n                        if (self.shiftDown===true) {\r\n                            // selectElement(null)\r\n                            self.paperScroller.setCursor('crosshair')\r\n                            self.selection.startSelecting(evt);\r\n                            console.log(self.selection)\r\n                        } else {\r\n                            console.log(self.selection.collection)\r\n                            // self.selection.collection.reset([]);\r\n                            self.paperScroller.startPanning(evt, x, y);\r\n                            paper.removeTools();\r\n                            self.paperScroller.setCursor('grab');\r\n                        }\r\n                \r\n                    },\r\n            })\r\n            //xóa el nếu chọn lại lần 2 khi bấm ctrl\r\n            this.selection.on('selection-box:pointerdown', function (cellView, evt) {\r\n                if (evt.ctrlKey || evt.metaKey) {\r\n                    this.selection.collection.remove(cellView.model);\r\n                }\r\n            });\r\n        },\r\n        getAllLinks(){\r\n             return this.graph.getLinks()\r\n        },\r\n        getAllNodes(){\r\n            return this.graph.getCells()\r\n        },\r\n        clearAll(){\r\n            return this.graph.clear()\r\n        },\r\n        getNodeAttr(id){\r\n            let node = this.graph.getCell(id);\r\n            if(node){\r\n                return node.attributes;\r\n            }else{\r\n                return {}\r\n            }\r\n        },\r\n        render(node={},link={}){\r\n            \r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}