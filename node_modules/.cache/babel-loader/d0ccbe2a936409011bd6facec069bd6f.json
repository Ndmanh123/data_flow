{"ast":null,"code":"import { createElementVNode as _createElementVNode, createStaticVNode as _createStaticVNode, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\n\nconst _hoisted_1 = /*#__PURE__*/_createElementVNode(\"link\", {\n  rel: \"stylesheet\",\n  href: \"https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css\"\n}, null, -1\n/* HOISTED */\n);\n\nconst _hoisted_2 = {\n  id: \"main\"\n};\nconst _hoisted_3 = {\n  ref: \"Toolbar\",\n  id: \"Toolbar\"\n};\n\nconst _hoisted_4 = /*#__PURE__*/_createStaticVNode(\"<button id=\\\"btn-zoomout\\\" class=\\\"btn\\\"><i class=\\\"zmdi zmdi-plus-circle-o\\\"></i></button><button id=\\\"btn-zoomin\\\" class=\\\"btn\\\"><i class=\\\"zmdi zmdi-minus-circle-outline\\\"></i></button><button id=\\\"btn-center-content\\\" class=\\\"btn\\\"><i class=\\\"zmdi zmdi-filter-center-focus\\\"></i></button>\", 3);\n\nconst _hoisted_7 = [_hoisted_4];\nconst _hoisted_8 = {\n  ref: \"nodeStencile\",\n  id: \"stencil\"\n};\n\nconst _hoisted_9 = /*#__PURE__*/_createElementVNode(\"div\", {\n  id: \"paper\"\n}, null, -1\n/* HOISTED */\n);\n\nconst _hoisted_10 = /*#__PURE__*/_createElementVNode(\"div\", {\n  id: \"navigator\"\n}, null, -1\n/* HOISTED */\n);\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(_Fragment, null, [_hoisted_1, _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, _hoisted_7, 512\n  /* NEED_PATCH */\n  ), _createElementVNode(\"div\", _hoisted_8, null, 512\n  /* NEED_PATCH */\n  ), _hoisted_9, _hoisted_10])], 64\n  /* STABLE_FRAGMENT */\n  );\n}","map":{"version":3,"mappings":";;gCACAA,oBAA+I,MAA/I,EAA+I;EAAzIC,GAAG,EAAC,YAAqI;EAAxHC,IAAI,EAAC;AAAmH,CAA/I;;AAAA;;;EAEOC,EAAE,EAAC;;;EACDC,GAAG,EAAC;EAAUD,EAAE,EAAC;;;;;oBACpBE;;EAMGD,GAAG,EAAC;EAAeD,EAAE,EAAC;;;gCAE3BH,oBAAsB,KAAtB,EAAsB;EAAjBG,EAAE,EAAC;AAAc,CAAtB,EAAe,IAAf,EAAe;AAAA;AAAf;;iCACAH,oBAA0B,KAA1B,EAA0B;EAArBG,EAAE,EAAC;AAAkB,CAA1B,EAAmB,IAAnB,EAAmB;AAAA;AAAnB;;;6DAbJG,YAEEN,oBAYM,KAZN,cAYM,CAXJA,oBAMM,KANN,cAMMO,UANN,EAMM;EAAA;EANN,CAWI,EAJJP,oBAA2C,KAA3C,cAA2C,IAA3C,EAA2C;EAAA;EAA3C,CAII,EAFJQ,UAEI,EADJC,WACI,CAZN","names":["_createElementVNode","rel","href","id","ref","_hoisted_4","_hoisted_1","_hoisted_7","_hoisted_9","_hoisted_10"],"sourceRoot":"","sources":["C:\\Users\\Admin\\dataflow-test\\src\\components\\dataflowWithoutSelectedEl.vue"],"sourcesContent":["<template>\r\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css\">\r\n\r\n  <div id=\"main\">\r\n    <div ref=\"Toolbar\" id=\"Toolbar\">\r\n      <button id=\"btn-zoomout\" class=\"btn\"><i class=\"zmdi zmdi-plus-circle-o\"></i>\r\n</button>\r\n      <button id=\"btn-zoomin\" class=\"btn\"><i class=\"zmdi zmdi-minus-circle-outline\"></i></button>\r\n      \r\n      <button id=\"btn-center-content\" class=\"btn\"><i class=\"zmdi zmdi-filter-center-focus\"></i></button>\r\n    </div>\r\n    <div ref=\"nodeStencile\" id=\"stencil\"></div>\r\n\r\n    <div id=\"paper\"></div>\r\n    <div id=\"navigator\"></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"DataFlow\",\r\n  props: {\r\n    width: {\r\n      type: [String, Number],\r\n      default: 800,\r\n    },\r\n    height: {\r\n      type: [String, Number],\r\n      default: 650,\r\n    },\r\n    gridSize: {\r\n      type: Number,\r\n      default: 10,\r\n    },\r\n    drawGrid: {\r\n      type: [Object, Boolean],\r\n      default: true,\r\n    },\r\n\r\n    highLightLinks: {\r\n      type: Array,\r\n      default() {\r\n        return [];\r\n      },\r\n    },\r\n    nodes: {\r\n      type: [Object, Boolean],\r\n      default: [\r\n        {\r\n          id: \"fd9c3b76-efea-436f-9bd5-ac2ba665d512\",\r\n          name: \"load\",\r\n          position: { x: 250, y: 250 },\r\n          type: \"Rectangle\",\r\n        },\r\n        {\r\n          id: \"4b20a9c1-bdbf-44fa-a64c-3ac11c377f84\",\r\n          name: \"filter\",\r\n          position: { x: 550, y: 250 },\r\n          type: \"Rectangle\",\r\n        },\r\n        {\r\n          id: \"fd45s2v9-bdbf-44fa-a64c-3ac11c377f84\",\r\n          name: \"filter\",\r\n          position: { x: 250, y: 450 },\r\n          type: \"Rectangle\",\r\n        },\r\n      ],\r\n    },\r\n    links: {\r\n      type: [Object, Boolean],\r\n      default:\r\n        // false,\r\n        [\r\n          {\r\n            source: \"fd9c3b76-efea-436f-9bd5-ac2ba665d512\",\r\n            target: \"4b20a9c1-bdbf-44fa-a64c-3ac11c377f84\",\r\n          },\r\n          {\r\n            source: \"fd45s2v9-bdbf-44fa-a64c-3ac11c377f84\",\r\n            target: \"4b20a9c1-bdbf-44fa-a64c-3ac11c377f84\",\r\n          },\r\n        ],\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      stencilShapes: [],\r\n      selectionNode: null,\r\n      selectedElement: null,\r\n      selectedLink: null,\r\n\r\n      //check ctrl shift\r\n      ctrlDown: false,\r\n      shiftDown: false,\r\n      color: \"rgb(255 136 0)\",\r\n      arr: [\r\n        \"filter\",\r\n        \"formula\",\r\n        \"join\",\r\n        \"load\",\r\n        \"pivot\",\r\n        \"sample\",\r\n        \"script\",\r\n        \"select\",\r\n        \"sort\",\r\n        \"summarize\",\r\n        \"transposeTable\",\r\n        \"union\",\r\n        \"weightAvg\",\r\n      ],\r\n    };\r\n  },\r\n  created() {\r\n    this.graph = new joint.dia.Graph();\r\n  },\r\n  mounted() {\r\n    this.initPaper();\r\n    // this.center()\r\n  },\r\n  methods: {\r\n    // center() {\r\n    //   _.bind(self.paperScroller.centerContent, self.paperScroller);\r\n    // },\r\n    initPaper() {\r\n      let graph = this.graph;\r\n      this.commandManager = new joint.dia.CommandManager({\r\n        graph: graph,\r\n        cmdBeforeAdd: (cmdName, cell, graph, options = {}) => {\r\n          return !options.ignoreCommandManager;\r\n        },\r\n      });\r\n      this.paper = new joint.dia.Paper({\r\n        width: this.width,\r\n        height: this.height,\r\n        model: this.graph,\r\n        async: true,\r\n        sorting: joint.dia.Paper.sorting.APPROX,\r\n        gridSize: this.gridSize,\r\n        drawGrid: this.drawGrid,\r\n        restrictTranslate: true,\r\n        stopDelegation: false,\r\n\r\n        interactive: { vertexAdd: false },\r\n        // background: { color: '#F3F7F6' },\r\n        // defaultConnectionPoint: { name: 'boundary' },\r\n        // defaultConnector: {\r\n        //     name: \"rounded\"\r\n        //   },\r\n        //   defaultRouter: {\r\n        //     name: \"manhattan\",\r\n        //     args: {\r\n        //       step: 10,\r\n        //       endDirections: [\"bottom\"],\r\n        //       startDirections: [\"top\"],\r\n        //       padding: { bottom: 20 }\r\n        //     }\r\n        //   },\r\n        snapLinks: {\r\n          radius: 75,\r\n        },\r\n        linkPinning: false,\r\n        multiLinks: false,\r\n        defaultRouter: { name: \"manhattan\", args: { padding: 10 } },\r\n        defaultConnector: { name: \"rounded\" },\r\n        validateConnection: function (\r\n          cellViewS,\r\n          magnetS,\r\n          cellViewT,\r\n          magnetT,\r\n          end,\r\n          linkView\r\n        ) {\r\n          // Prevent linking from input ports.\r\n          if (magnetS && magnetS.getAttribute(\"port-group\") === \"in\")\r\n            return false;\r\n          // Prevent linking from output ports to input ports within one element.\r\n          if (cellViewS === cellViewT) return false;\r\n          // Prevent linking to input ports.\r\n          return (\r\n            (magnetT && magnetT.getAttribute(\"port-group\") === \"in\") ||\r\n            (cellViewS.model.get(\"type\") === \"qad.Question\" &&\r\n              cellViewT.model.get(\"type\") === \"qad.Answer\")\r\n          );\r\n        },\r\n        // validateConnection: function (view1, _magnet1, view2, _magnet2) {\r\n        //     // Do not allow loop links (Element to Link, Element A to Element B is valid).\r\n        //     return view1 !== view2;\r\n        // },\r\n        interactive: {\r\n          linkMove: true,\r\n          labelMove: true,\r\n          arrowheadMove: true,\r\n          vertexMove: false,\r\n          vertexAdd: false,\r\n          vertexRemove: false,\r\n          useLinkTools: false,\r\n        },\r\n        defaultLink: function () {\r\n          return new joint.shapes.standard.Link({\r\n            attrs: {\r\n              z: 1,\r\n              line: {\r\n                connection: true,\r\n                stroke: \"#707070\",\r\n                strokeWidth: 2,\r\n                strokeLinejoin: \"round\",\r\n              },\r\n              wrapper: {\r\n                connection: true,\r\n                strokeWidth: 10,\r\n                strokeLinejoin: \"round\",\r\n              },\r\n            },\r\n\r\n            markup: [\r\n              {\r\n                tagName: \"path\",\r\n                selector: \"wrapper\",\r\n                attributes: {\r\n                  fill: \"none\",\r\n\r\n                  stroke: \"transparent\",\r\n                },\r\n              },\r\n              {\r\n                tagName: \"path\",\r\n                selector: \"line\",\r\n                attributes: {\r\n                  fill: \"none\",\r\n                },\r\n              },\r\n            ],\r\n          });\r\n        },\r\n      });\r\n      var targetArrowheadTool = new joint.linkTools.TargetArrowhead();\r\n      this.toolsView = new joint.dia.ToolsView({\r\n        tools: [\r\n          // verticesTool, segmentsTool,\r\n          // sourceArrowheadTool,\r\n          targetArrowheadTool,\r\n          // sourceAnchorTool, targetAnchorTool,\r\n          // boundaryTool, removeButton\r\n        ],\r\n      });\r\n      // var elementView = element.findView(this.paper);\r\n      // elementView.addTools(this.toolsView);\r\n      // var linkView = this.link.findView(this.paper);\r\n      // linkView.addTools(this.toolsView);\r\n      this.paperScroller = new joint.ui.PaperScroller({\r\n        paper: this.paper,\r\n        autoResizePaper: true,\r\n        scrollWhileDragging: true,\r\n        cursor: \"grab\",\r\n      });\r\n      this.selection = new joint.ui.Selection({\r\n        theme: \"material\",\r\n        paper: this.paper,\r\n        useModelGeometry: true,\r\n        allowTranslate: true,\r\n      });\r\n      this.selection.removeHandle(\"rotate\");\r\n      this.selection.removeHandle(\"resize\");\r\n\r\n      // this.toolbar = new joint.ui.Toolbar({\r\n      //   // initialize tools with default settings\r\n      //   tools: [\"zoomIn\", \"zoomOut\", \"zoomToFit\", \"zoomSlider\", \"undo\", \"redo\"],\r\n      //   references: {\r\n      //     paperScroller: this.paperScroller,\r\n      //     commandManager: this.commandManager,\r\n      //   },\r\n      // });\r\n      // document.getElementById(\"Toolbar\").appendChild(this.toolbar.render().el);\r\n\r\n      this.snaplines = new joint.ui.Snaplines({ paper: this.paper });\r\n      this.snaplines.startListening();\r\n      //render paper\r\n      document\r\n        .getElementById(\"paper\")\r\n        .appendChild(this.paperScroller.render().el);\r\n      //render paperScroller\r\n      this.highlighters = joint.highlighters;\r\n      this.paperScroller.$el\r\n        .css({ width: 800, height: 600 })\r\n        .appendTo(\"#paper\");\r\n\r\n      this.addStencil();\r\n\r\n      this.handlePaperEvents();\r\n      this.btnHandler();\r\n      this.selection.collection.reset(graph.getElements());\r\n      this.render();\r\n      this.paperScroller.center();\r\n      // _.bind(this.paperScroller.centerContent, this.paperScroller)\r\n      // this.paperScroller.centerContent();\r\n      // this.paperScroller.adjustPaper();\r\n      // this.paperScroller.zoomToFit({ padding: 200 });\r\n    },\r\n    jsUcfirst(string) {\r\n      return string.charAt(0).toUpperCase() + string.slice(1);\r\n    },\r\n    stencilRenderHandler(\r\n      positionX,\r\n      positionY,\r\n      arr,\r\n      elNoInPorts = \"\",\r\n      spaceBetweenElToX = 0,\r\n      spaceBetweenElToY = 0\r\n    ) {\r\n      this.customEl = joint.dia.Element.define(\"standard.Rectangle\", {\r\n        z: 1,\r\n        size: {\r\n          width: 35,\r\n          height: 35,\r\n        },\r\n        removable: false,\r\n        attrs: {\r\n          image: {\r\n            x: 5,\r\n            y: 5,\r\n            width: \"calc(w-10)\",\r\n            height: \"calc(h-10 )\",\r\n          },\r\n          root: {\r\n            magnet: false,\r\n          },\r\n          body: {\r\n            fill: \"#FFFFFF\",\r\n            stroke: \"#A0A0A0\",\r\n            width: \"calc(w)\",\r\n            height: \"calc(h)\",\r\n            strokeWidth: 1,\r\n            rx: 5,\r\n            ry: 5,\r\n          },\r\n        },\r\n        ports: {\r\n          items: [\r\n            {\r\n              id: \"out-port\",\r\n              group: \"out\",\r\n            },\r\n            {\r\n              id: \"in-port\",\r\n              group: \"in\",\r\n            },\r\n          ],\r\n          groups: {\r\n            out: {\r\n              markup: [\r\n                {\r\n                  tagName: \"circle\",\r\n                  selector: \"portBody\",\r\n                },\r\n              ],\r\n              position: {\r\n                name: \"right\",\r\n              },\r\n              attrs: {\r\n                portBody: {\r\n                  r: 3,\r\n                  magnet: \"active\",\r\n                  fill: \"gray\",\r\n                  stroke: \"#187BD3\",\r\n                },\r\n              },\r\n            },\r\n            in: {\r\n              markup: [\r\n                {\r\n                  tagName: \"circle\",\r\n                  selector: \"portBody\",\r\n                },\r\n              ],\r\n              position: {\r\n                name: \"left\",\r\n              },\r\n              attrs: {\r\n                portBody: {\r\n                  r: 3,\r\n                  magnet: \"passive\",\r\n                  fill: \"gray\",\r\n                  stroke: \"#187BD3\",\r\n                },\r\n              },\r\n            },\r\n          },\r\n        },\r\n        markup: [\r\n          {\r\n            tagName: \"rect\",\r\n            selector: \"body\",\r\n          },\r\n          {\r\n            tagName: \"image\",\r\n            selector: \"image\",\r\n          },\r\n          {\r\n            tagName: \"ports\",\r\n            selector: \"ports\",\r\n          },\r\n        ],\r\n      });\r\n      this.customElNoInPorts = joint.dia.Element.define(\"standard.Rectangle\", {\r\n        z: 1,\r\n        size: {\r\n          width: 35,\r\n          height: 35,\r\n        },\r\n        removable: false,\r\n        attrs: {\r\n          image: {\r\n            x: 5,\r\n            y: 5,\r\n            width: \"calc(w-10)\",\r\n            height: \"calc(h-10 )\",\r\n          },\r\n          root: {\r\n            magnet: false,\r\n          },\r\n          body: {\r\n            fill: \"#FFFFFF\",\r\n            stroke: \"#A0A0A0\",\r\n            width: \"calc(w)\",\r\n            height: \"calc(h)\",\r\n            strokeWidth: 1,\r\n            rx: 5,\r\n            ry: 5,\r\n          },\r\n        },\r\n        ports: {\r\n          items: [\r\n            {\r\n              id: \"out-port\",\r\n              group: \"out\",\r\n            },\r\n            \r\n          ],\r\n          groups: {\r\n            out: {\r\n              markup: [\r\n                {\r\n                  tagName: \"circle\",\r\n                  selector: \"portBody\",\r\n                },\r\n              ],\r\n              position: {\r\n                name: \"right\",\r\n              },\r\n              attrs: {\r\n                portBody: {\r\n                  r: 3,\r\n                  magnet: \"active\",\r\n                  fill: \"gray\",\r\n                  stroke: \"#187BD3\",\r\n                },\r\n              },\r\n            },\r\n            \r\n          },\r\n        },\r\n        markup: [\r\n          {\r\n            tagName: \"rect\",\r\n            selector: \"body\",\r\n          },\r\n          {\r\n            tagName: \"image\",\r\n            selector: \"image\",\r\n          },\r\n          {\r\n            tagName: \"ports\",\r\n            selector: \"ports\",\r\n          },\r\n        ],\r\n      });\r\n      arr.forEach((element) => {\r\n        //chuyển thành hoa chữ đầu cho đúng định dạng file ảnh lưu\r\n        let elementName = this.jsUcfirst(element);\r\n        if (elementName === this.jsUcfirst(elNoInPorts)) {\r\n          element = new this.customElNoInPorts();\r\n        } else {\r\n          element = new this.customEl();\r\n        }\r\n        element.prop(\r\n          \"attrs/image/xlinkHref\",\r\n          require(`../assets/${elementName}.svg`)\r\n        );\r\n        this.stencilShapes.push(element.position(positionX, positionY));\r\n        if (spaceBetweenElToX > 0) {\r\n          positionX += element.attributes.size.width + spaceBetweenElToX;\r\n        }\r\n        if (spaceBetweenElToY > 0) {\r\n          positionY += element.attributes.size.height + spaceBetweenElToY;\r\n        }\r\n      });\r\n    },\r\n\r\n    addStencil() {\r\n      let graph = this.graph;\r\n      let paper = this.paper;\r\n      var stencil = new joint.ui.Stencil({\r\n        paper: this.paperScroller,\r\n        width: 900,\r\n        height: 60,\r\n        dropAnimation: { duration: 200, easing: \"swing\" },\r\n      });\r\n\r\n      this.stencilRenderHandler(20, 20, this.arr, \"load\", 16);\r\n      document.getElementById(\"stencil\").appendChild(stencil.render().el);\r\n      stencil.load(this.stencilShapes);\r\n    },\r\n    getElementPredecessorLinks(el) {\r\n      let graph = this.graph;\r\n\r\n      return graph\r\n        .getSubgraph([el, ...graph.getPredecessors(el)])\r\n        .filter((cell) => cell.isLink());\r\n    },\r\n    highlightCell(cell) {\r\n      let self = this;\r\n      if (cell) {\r\n        self.highlighters.addClass.add(\r\n          cell.findView(self.paper),\r\n          cell.isElement() ? \"body\" : \"line\",\r\n          \"selection\",\r\n          { className: \"selection\" }\r\n        );\r\n      } else {\r\n        return;\r\n      }\r\n    },\r\n    unhighlightCell(cell) {\r\n      let self = this;\r\n      if (cell) {\r\n        self.highlighters.addClass.remove(\r\n          cell.findView(self.paper),\r\n          \"selection\"\r\n        );\r\n      } else {\r\n        return;\r\n      }\r\n    },\r\n    selectElement(el) {\r\n      let self = this;\r\n      let graph = self.graph;\r\n      if (self.selectionNode === el) return;\r\n      if (self.selectionNode) {\r\n        self.unhighlightCell(self.selectionNode);\r\n        graph.getLinks().forEach((link) => self.unhighlightCell(link));\r\n      }\r\n      if (el) {\r\n        self.highlightCell(el);\r\n        self.getElementPredecessorLinks(el).forEach((link) => {\r\n          self.highlightCell(link);\r\n          link.toFront({ ignoreCommandManager: true });\r\n        });\r\n        self.selectionNode = el;\r\n      } else {\r\n        self.selectionNode = null;\r\n      }\r\n    },\r\n    addHaloAndTooltip(cellView) {\r\n      if (\r\n        cellView.model instanceof joint.dia.Link &&\r\n        cellView.model.attributes.target.id === undefined\r\n      )\r\n        return;\r\n      // {\r\n      //   console.log(cellView.model.attributes.target.id=== undefined)\r\n      //   if(cellView.model.attributes.target.id){\r\n      //       console.log(1)\r\n      //   }\r\n\r\n      // }\r\n      // if (cellView.model instanceof joint.dia.Link &&cellView.model.attributes.target.id ==\"undefined\") return;\r\n      this.halo = new joint.ui.Halo({\r\n        cellView: cellView,\r\n        type: \"toolbar\",\r\n        boxContent: false, // bang phia duoi cell cho biet tọa độ height width và angle\r\n      });\r\n      this.halo.changeHandle(\"remove\", { position: \"se\" });\r\n      this.halo.changeHandle(\"remove\", {\r\n        attrs: {\r\n          \".handle\": {\r\n            \"data-tooltip-class-name\": \"small\",\r\n            \"data-tooltip\": \"Click to remove the object\",\r\n            \"data-tooltip-position\": \"bottom\",\r\n          },\r\n        },\r\n      });\r\n      this.halo.changeHandle(\"fork\", {\r\n        attrs: {\r\n          \".handle\": {\r\n            \"data-tooltip-class-name\": \"small\",\r\n            \"data-tooltip\":\r\n              \"Click and drag to clone and connect the object in one go\",\r\n            \"data-tooltip-position\": \"bottom\",\r\n          },\r\n        },\r\n      });\r\n      this.halo.changeHandle(\"clone\", {\r\n        attrs: {\r\n          \".handle\": {\r\n            \"data-tooltip-class-name\": \"small\",\r\n            \"data-tooltip\": \"Click and drag to clone the object\",\r\n            \"data-tooltip-position\": \"bottom\",\r\n          },\r\n        },\r\n      });\r\n      this.halo.changeHandle(\"unlink\", {\r\n        attrs: {\r\n          \".handle\": {\r\n            \"data-tooltip-class-name\": \"small\",\r\n            \"data-tooltip\": \"Click to break all connections to other objects\",\r\n            \"data-tooltip-position\": \"bottom\",\r\n          },\r\n        },\r\n      });\r\n      this.halo.changeHandle(\"link\", {\r\n        attrs: {\r\n          \".handle\": {\r\n            \"data-tooltip-class-name\": \"small\",\r\n            \"data-tooltip\": \"Click and drag to connect the object\",\r\n            \"data-tooltip-position\": \"bottom\",\r\n          },\r\n        },\r\n      });\r\n      new joint.ui.Tooltip({\r\n        rootTarget: document.body,\r\n        target: \"[data-tooltip]\",\r\n        padding: 15,\r\n      });\r\n\r\n      this.halo.removeHandle(\"resize\");\r\n      this.halo.removeHandle(\"rotate\");\r\n      this.halo.removeHandle(\"direction\");\r\n      this.halo.render();\r\n    },\r\n\r\n    handlePaperEvents() {\r\n      let self = this;\r\n      let paper = self.paper;\r\n      let graph = self.graph;\r\n      //nếu bấm thì =true\r\n      document.addEventListener(\"keydown\", function (evt) {\r\n        if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\r\n          self.ctrlDown = true;\r\n        }\r\n        if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\r\n          self.shiftDown = true;\r\n        }\r\n      });\r\n      document.addEventListener(\r\n        \"keyup\",\r\n        function (evt) {\r\n          if ( !self.selection) return;\r\n          if (evt.code === \"Backspace\" || evt.code === \"Delete\") {\r\n            //xóa 1 el\r\n\r\n            //xóa toàn bộ  el đã chọn\r\n            if (self.selection.model.length > 0) {\r\n              // chuyeent selection.collection thành mảng hảm remove cell nhận vào 1 mảng và xóa khỏi graph\r\n              let deleteArrId = [];\r\n              self.selection.model.models.forEach((element) => {\r\n               \r\n                deleteArrId.push(element.id);\r\n                self.getNodeAttr(element.id);\r\n              });\r\n              self.$emit(\"arr-node-delete\", deleteArrId);\r\n\r\n              evt.preventDefault();\r\n              graph.removeCells(self.selection.collection.toArray());\r\n              self.selection.collection.reset([]);\r\n              self.selectionNode = null;\r\n            } \r\n            \r\n          }\r\n        },\r\n        false\r\n      );\r\n      \r\n      //nếu thả nút thì =false\r\n      \r\n      document.addEventListener(\"keyup\", function (evt) {\r\n        if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\r\n          self.shiftDown = false;\r\n        }\r\n        if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\r\n          self.ctrlDown = false;\r\n        }\r\n      });\r\n      paper.on(\"cell:pointerup\", function (cellView) {\r\n        self.addHaloAndTooltip(cellView);\r\n\r\n        if (cellView.model.attributes[\"type\"] === \"standard.Link\") {\r\n          self.$emit(\"select-link\", { id: cellView.model.id });\r\n        } else {\r\n          self.$emit(\"select-cell\", { id: cellView.model.id });\r\n        }\r\n        self.selection.collection.add(cellView.model)\r\n        // self.selectedElement = cellView.model;\r\n        cellView.model.toFront({ ignoreCommandManager: true });\r\n        // cellView.$el[0].parentElement.appendChild(cellView.$el[0])\r\n        // console.log(graph.getLinks())\r\n      });\r\n\r\n      paper.on({\r\n        //xử lý khi các sự kiện\r\n        \"cell:mouseenter\": (cellView) => {\r\n          cellView.model.toFront({ ignoreCommandManager: true });\r\n        },\r\n        \"cell:mouseleave\": (cellView) => {\r\n          cellView.model.toBack({ ignoreCommandManager: true });\r\n\r\n          if (self.selectionNode) {\r\n            self\r\n              .getElementPredecessorLinks(self.selectionNode)\r\n              .forEach((link) => {\r\n                link.toFront({ ignoreCommandManager: true });\r\n              });\r\n          }\r\n        },\r\n\r\n       \r\n        \"link:mouseenter\": (cellView) => {\r\n          cellView.addTools(this.toolsView);\r\n        },\r\n        \"link:mouseleave\": (cellView) => {\r\n          cellView.hideTools();\r\n        },\r\n       \r\n\r\n        //chuyển lại màu cũ khi bấm ra ngoài\r\n        \"blank:pointerclick\": () => {\r\n          self.selectElement(null);\r\n          paper.removeTools({ ignoreCommandManager: true });\r\n        },\r\n\r\n        \"element:pointerup\": function (cellView, evt) {\r\n          console.log(cellView)\r\n          if (evt.ctrlKey || evt.metaKey) {\r\n            console.log(self.selection);\r\n            \r\n            self.selection.collection.add(cellView.model);\r\n            //loop to all the element in selection and set it to front\r\n            self.selection.collection.models.forEach((element) => {\r\n              element.toFront({ ignoreCommandManager: true });\r\n            });\r\n          }\r\n          else{\r\n              self.selection.collection.reset([]);\r\n              if (self.ctrlDown === false) {\r\n                self.selectElement(cellView.model);\r\n          }\r\n          }\r\n        },\r\n        //chuyển màu khi bấm vào link và cho nó lên trc\r\n        \"link:pointerup\": function (cellView) {\r\n          console.log(cellView)\r\n            self.selection.collection.reset([]);\r\n          self.selectedLink = cellView.model;\r\n          self.selectElement(cellView.model);\r\n          //chon vao link thi mo cho phep doi node\r\n          cellView.addTools(this.toolsView);\r\n          self.selectedLink.toFront({ ignoreCommandManager: true });\r\n          \r\n        },\r\n\r\n        // lắng nghe sự kiện bấm ở ngoài khoange trống check shift để active select\r\n        \"blank:pointerdown\": function (evt, x, y) {\r\n          if (self.shiftDown === true) {\r\n            self.selectElement(null);\r\n\r\n            self.paperScroller.setCursor(\"crosshair\");\r\n            self.selection.startSelecting(evt);\r\n          } else {\r\n            self.selection.collection.reset([]);\r\n            self.paperScroller.startPanning(evt, x, y);\r\n            paper.removeTools();\r\n            self.paperScroller.setCursor(\"grab\");\r\n          }\r\n        },\r\n      });\r\n      //xử lý scroll\r\n      \r\n      window.addEventListener(\"mousewheel\", function(e) {\r\n        \r\n        if (e.ctrlKey) {\r\n          e.preventDefault();\r\n          \r\n          if(e.deltaY>0){\r\n            self.paperScroller.zoom(0.2, { max: 4 });\r\n          }\r\n          else if(e.deltaY<0){\r\n             self.paperScroller.zoom(-0.2, { min: 0.2 });\r\n          }\r\n        }\r\n      },{ passive: false });\r\n\r\n     \r\n      graph.on(\"add\", (cell, collection, opt) => {\r\n        let type = cell.attributes.type;\r\n        // console.log(type.split('.')[1])\r\n        if (type == \"standard.Link\") {\r\n          // self.addLinkTools(cell, paper);\r\n          // console.log(cell.attributes.source)\r\n          self.$emit(\"link-added\", {\r\n            source: cell.attributes.source,\r\n            target: cell.attributes.target,\r\n          });\r\n        } else {\r\n          type = type.split(\".\")[1];\r\n          self.$emit(\"node-added\", {\r\n            id: cell.id,\r\n            type: type,\r\n            prosition: cell.attributes.position,\r\n          });\r\n        }\r\n      });\r\n      graph.on(\"change:target\", function (link) {\r\n        if (link.get(\"target\").id) {\r\n          self.$emit(\"change-link-target\", { id: link.get(\"target\").id });\r\n        }\r\n      });\r\n      //xóa el nếu chọn lại lần 2 khi bấm ctrl\r\n      self.selection.on(\"selection-box:pointerdown\", function (cellView, evt) {\r\n        if (evt.ctrlKey || evt.metaKey) {\r\n          self.selection.collection.remove(cellView.model);\r\n        }\r\n      });\r\n      //kết hợp bấm ctrl để check các tổ hợp phím ctrl + C,V,Z,Y,A...\r\n      document.addEventListener(\"keydown\", function (evt) {\r\n        self.clipboard = new joint.ui.Clipboard();\r\n\r\n        if (evt.code === \"NumpadAdd\" && self.shiftDown === true) {\r\n          // console.log(evt.code)\r\n          self.paperScroller.zoom(0.2, { max: 4 });\r\n        }\r\n        if (evt.code === \"NumpadSubtract\" && self.shiftDown === true) {\r\n          self.paperScroller.zoom(-0.2, { min: 0.2 });\r\n          // console.log(evt.code)\r\n        }\r\n        //check+ A\r\n        if (evt.code === \"KeyA\" && self.ctrlDown === true) {\r\n          self.selection.collection.reset(graph.getElements());\r\n          evt.preventDefault();\r\n        } //check ctrl + Z\r\n        if (evt.code === \"KeyZ\" && self.ctrlDown === true) {\r\n          console.log(self.commandManager)\r\n          self.commandManager.undo();\r\n          console.log(self.commandManager)\r\n          if (self.selectionNode) {\r\n            self.unhighlightCell(self.selectionNode);\r\n            graph.getLinks().forEach((link) => self.unhighlightCell(link));\r\n\r\n            // console.log(selectionNode)\r\n            self.selectionNode = null;\r\n          }\r\n        }\r\n        //check ctrl + Y\r\n        if (evt.code === \"KeyY\" && self.ctrlDown === true) {\r\n          self.commandManager.redo();\r\n          self.selectElement(null);\r\n        }\r\n        //check ctrl + V ,ctrl + C, ctrl+X\r\n        if (evt.code === \"KeyX\" && self.ctrlDown === true) {\r\n          self.clipboard.cutElements(self.selection.collection, paper.model);\r\n        }\r\n        if (evt.code === \"KeyC\" && self.ctrlDown === true) {\r\n          self.clipboard.copyElements(self.selection.collection, graph);\r\n        }\r\n        if (evt.code === \"KeyV\" && self.ctrlDown === true) {\r\n          var pastedCells = self.clipboard.pasteCells(graph, {\r\n            translate: { dx: 40, dy: 40 },\r\n            useLocalStorage: true,\r\n          });\r\n\r\n          var elements = _.filter(pastedCells, function (cell) {\r\n            return cell.isElement();\r\n          });\r\n          // Make sure pasted elements get selected immediately. This makes the UX better as\r\n          // the user can immediately manipulate the pasted elements.\r\n          self.selection.collection.reset(elements);\r\n        }\r\n      });\r\n    },\r\n    btnHandler() {\r\n      let self = this;\r\n      $(\"#btn-zoomin\").on(\"click\", function () {\r\n        self.paperScroller.zoom(0.2, { max: 4 });\r\n      });\r\n      $(\"#btn-zoomout\").on(\"click\", function () {\r\n        self.paperScroller.zoom(-0.2, { min: 0.2 });\r\n      });\r\n      \r\n      $(\"#btn-center-content\").on(\r\n        \"click\",\r\n        _.bind(self.paperScroller.centerContent, self.paperScroller)\r\n      );\r\n    },\r\n\r\n    getAllLinks() {\r\n      return this.graph.getLinks();\r\n    },\r\n    getAllNodes() {\r\n      return this.graph.getCells();\r\n    },\r\n    clearAll() {\r\n      return this.graph.clear();\r\n    },\r\n    getNodeAttr(id) {\r\n      let node = this.graph.getCell(id);\r\n      if (node) {\r\n        return node.attributes;\r\n      } else {\r\n        return {};\r\n      }\r\n    },\r\n    render() {\r\n      let nodeInfos = this.nodes;\r\n      let linkInfos = this.links;\r\n      nodeInfos.forEach((nodeInfo) => {\r\n        let nodeType = nodeInfo.type;\r\n        let elementName = this.jsUcfirst(nodeInfo.name);\r\n        //checknode\r\n        if (nodeType === \"Rectangle\") {\r\n          if (elementName === \"Load\") {\r\n            let cell = new this.customElNoInPorts({\r\n              position: nodeInfo.position,\r\n              id: nodeInfo.id,\r\n            });\r\n            cell.prop(\r\n              \"attrs/image/xlinkHref\",\r\n              require(`../assets/${elementName}.svg`)\r\n            );\r\n            this.graph.addCell(cell);\r\n            // console.log(cell)\r\n            // linkInfo.source=cell\r\n          } else {\r\n            let cell = new this.customEl({\r\n              position: nodeInfo.position,\r\n              id: nodeInfo.id,\r\n            });\r\n            cell.prop(\r\n              \"attrs/image/xlinkHref\",\r\n              require(`../assets/${elementName}.svg`)\r\n            );\r\n            this.graph.addCell(cell);\r\n            //   linkInfo.target=cell\r\n            // console.log(cell)\r\n          }\r\n        } else {\r\n          console.error(\"Node type '\" + nodeType + \"' is not defined\");\r\n        }\r\n      });\r\n\r\n      if (linkInfos) {\r\n        linkInfos.forEach((linkInfo) => {\r\n          let link = new joint.shapes.standard.Link({\r\n            attrs: {\r\n              z: 1,\r\n              line: {\r\n                connection: true,\r\n                stroke: \"#707070\",\r\n                strokeWidth: 3,\r\n                strokeLinejoin: \"round\",\r\n                targetMarker: {\r\n                  type: \"path\",\r\n\r\n                  d: \"M 10 -5 0 0 10 5 Z\",\r\n                },\r\n              },\r\n              wrapper: {\r\n                connection: true,\r\n                strokeWidth: 6,\r\n                strokeLinejoin: \"round\",\r\n              },\r\n            },\r\n\r\n            markup: [\r\n              {\r\n                tagName: \"path\",\r\n                selector: \"wrapper\",\r\n                attributes: {\r\n                  fill: \"none\",\r\n\r\n                  stroke: \"transparent\",\r\n                },\r\n              },\r\n              {\r\n                tagName: \"path\",\r\n                selector: \"line\",\r\n                attributes: {\r\n                  fill: \"none\",\r\n                },\r\n              },\r\n            ],\r\n          });\r\n            console.log(this.getNodeAttr(linkInfo.source)   )\r\n          link.source({\r\n            id:linkInfo.source,\r\n            port:'out-port'\r\n          });\r\n          link.target({\r\n            id:linkInfo.target,\r\n            port:'in-port'\r\n          });\r\n          link.addTo(this.graph);\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.joint-element .selection {\r\n  stroke: rgb(255 136 0);\r\n}\r\n.joint-link .selection {\r\n  stroke: rgb(255 136 0);\r\n  /* fill: rgb(255 136 0); */\r\n}\r\n/* .joint-paper-scroller.joint-theme-default {\r\n  width: 800px !important;\r\n  height: 600px;\r\n}\r\n.joint-toolbar.joint-theme-default {\r\n  width: 800px !important;\r\n} */\r\n#Toolbar{\r\nheight: 35px;\r\n    line-height: 35px;\r\n    display: flex !important;\r\n    align-items: center;\r\n}\r\n.btn{\r\n  border :none;\r\n  background: #eee;\r\n  float: left;\r\n  width: 24px;\r\n  height: 24px;\r\n \r\n}\r\n.joint-halo.joint-theme-default.toolbar.type-element .handle.remove {\r\n  position: relative !important;\r\n  right: 0 !important;\r\n}\r\n.joint-halo.joint-theme-default.toolbar .handles:after {\r\n  left: 12px !important;\r\n}\r\n.joint-halo.joint-theme-default.toolbar .handles {\r\n  margin-left: 5px !important;\r\n}\r\n.joint-paper-background,\r\n.joint-paper-grid,\r\n.joint-paper > svg {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n}\r\n.joint-selection.joint-theme-material .handle.remove {\r\n  position: static;\r\n  display: inline-block;\r\n  vertical-align: top;\r\n  white-space: nowrap;\r\n  background-color: #fff;\r\n  border: 1px solid #d3d3d3;\r\n  border-bottom: 4px solid #000;\r\n  width: 20px;\r\n  margin-top: -50px;\r\n  margin-left: 54px;\r\n}\r\ndiv.handle.nw.remove:before {\r\n  content: \"\";\r\n\r\n  position: absolute;\r\n  vertical-align: top;\r\n\r\n  margin-top: 22px;\r\n\r\n  border-top: 6px solid #000;\r\n  border-right: 10px solid transparent;\r\n  border-left: 8px solid transparent;\r\n  /* width: 2px; */\r\n}\r\n.joint-paper-scroller.joint-theme-default{\r\n  width:100% !important;\r\n  \r\n}\r\n.joint-paper-scroller {\r\n    position: relative;\r\n    overflow: scroll;\r\n    box-sizing: border-box;\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n.joint-selection.joint-theme-material .handle.remove:after {\r\n  /* font-family: selection-icons-dark;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  speak: none;\r\n  display: inline-block;\r\n  text-decoration: inherit;\r\n  margin: auto;\r\n  text-align: center;\r\n  font-variant: normal;\r\n  text-transform: none;\r\n  font-size: 18px;\r\n  color: #5faaee; */\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}