{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport V from '../V/index.mjs';\nimport { config } from '../config/index.mjs';\nexport const addClassNamePrefix = function (className) {\n  if (!className) return className;\n  return className.toString().split(' ').map(function (_className) {\n    if (_className.substr(0, config.classNamePrefix.length) !== config.classNamePrefix) {\n      _className = config.classNamePrefix + _className;\n    }\n\n    return _className;\n  }).join(' ');\n};\nexport const removeClassNamePrefix = function (className) {\n  if (!className) return className;\n  return className.toString().split(' ').map(function (_className) {\n    if (_className.substr(0, config.classNamePrefix.length) === config.classNamePrefix) {\n      _className = _className.substr(config.classNamePrefix.length);\n    }\n\n    return _className;\n  }).join(' ');\n};\nexport const parseDOMJSON = function (json, namespace) {\n  var selectors = {};\n  var groupSelectors = {};\n  var svgNamespace = V.namespace.svg;\n  var ns = namespace || svgNamespace;\n  var fragment = document.createDocumentFragment();\n  var queue = [json, fragment, ns];\n\n  while (queue.length > 0) {\n    ns = queue.pop();\n    var parentNode = queue.pop();\n    var siblingsDef = queue.pop();\n\n    for (var i = 0, n = siblingsDef.length; i < n; i++) {\n      var nodeDef = siblingsDef[i]; // TagName\n\n      if (!nodeDef.hasOwnProperty('tagName')) throw new Error('json-dom-parser: missing tagName');\n      var tagName = nodeDef.tagName; // Namespace URI\n\n      if (nodeDef.hasOwnProperty('namespaceURI')) ns = nodeDef.namespaceURI;\n      var node = document.createElementNS(ns, tagName);\n      var svg = ns === svgNamespace;\n      var wrapper = svg ? V : $; // Attributes\n\n      var attributes = nodeDef.attributes;\n      if (attributes) wrapper(node).attr(attributes); // Style\n\n      var style = nodeDef.style;\n      if (style) $(node).css(style); // ClassName\n\n      if (nodeDef.hasOwnProperty('className')) {\n        var className = nodeDef.className;\n\n        if (svg) {\n          node.className.baseVal = className;\n        } else {\n          node.className = className;\n        }\n      } // TextContent\n\n\n      if (nodeDef.hasOwnProperty('textContent')) {\n        node.textContent = nodeDef.textContent;\n      } // Selector\n\n\n      if (nodeDef.hasOwnProperty('selector')) {\n        var nodeSelector = nodeDef.selector;\n        if (selectors[nodeSelector]) throw new Error('json-dom-parser: selector must be unique');\n        selectors[nodeSelector] = node;\n        wrapper(node).attr('joint-selector', nodeSelector);\n      } // Groups\n\n\n      if (nodeDef.hasOwnProperty('groupSelector')) {\n        var nodeGroups = nodeDef.groupSelector;\n        if (!Array.isArray(nodeGroups)) nodeGroups = [nodeGroups];\n\n        for (var j = 0, m = nodeGroups.length; j < m; j++) {\n          var nodeGroup = nodeGroups[j];\n          var group = groupSelectors[nodeGroup];\n          if (!group) group = groupSelectors[nodeGroup] = [];\n          group.push(node);\n        }\n      }\n\n      parentNode.appendChild(node); // Children\n\n      var childrenDef = nodeDef.children;\n      if (Array.isArray(childrenDef)) queue.push(childrenDef, node, ns);\n    }\n  }\n\n  return {\n    fragment: fragment,\n    selectors: selectors,\n    groupSelectors: groupSelectors\n  };\n}; // Return a simple hash code from a string. See http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/.\n\nexport const hashCode = function (str) {\n  let hash = 0;\n  if (str.length === 0) return hash;\n\n  for (let i = 0; i < str.length; i++) {\n    const c = str.charCodeAt(i);\n    hash = (hash << 5) - hash + c;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n\n  return hash;\n};\nexport const getByPath = function (obj, path, delimiter) {\n  var keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n  var key;\n  var i = 0;\n  var length = keys.length;\n\n  while (i < length) {\n    key = keys[i++];\n\n    if (Object(obj) === obj && key in obj) {\n      obj = obj[key];\n    } else {\n      return undefined;\n    }\n  }\n\n  return obj;\n};\n\nconst isGetSafe = function (obj, key) {\n  // Prevent prototype pollution\n  // https://snyk.io/vuln/SNYK-JS-JSON8MERGEPATCH-1038399\n  if (typeof key !== 'string' && typeof key !== 'number') {\n    key = String(key);\n  }\n\n  if (key === 'constructor' && typeof obj[key] === 'function') {\n    return false;\n  }\n\n  if (key === '__proto__') {\n    return false;\n  }\n\n  return true;\n};\n\nexport const setByPath = function (obj, path, value, delimiter) {\n  const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n  const last = keys.length - 1;\n  let diver = obj;\n  let i = 0;\n\n  for (; i < last; i++) {\n    const key = keys[i];\n    if (!isGetSafe(diver, key)) return obj;\n    const value = diver[key]; // diver creates an empty object if there is no nested object under such a key.\n    // This means that one can populate an empty nested object with setByPath().\n\n    diver = value || (diver[key] = {});\n  }\n\n  diver[keys[last]] = value;\n  return obj;\n};\nexport const unsetByPath = function (obj, path, delimiter) {\n  const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n  const last = keys.length - 1;\n  let diver = obj;\n  let i = 0;\n\n  for (; i < last; i++) {\n    const key = keys[i];\n    if (!isGetSafe(diver, key)) return obj;\n    const value = diver[key];\n    if (!value) return obj;\n    diver = value;\n  }\n\n  delete diver[keys[last]];\n  return obj;\n};\nexport const flattenObject = function (obj, delim, stop) {\n  delim = delim || '/';\n  var ret = {};\n\n  for (var key in obj) {\n    if (!obj.hasOwnProperty(key)) continue;\n    var shouldGoDeeper = typeof obj[key] === 'object';\n\n    if (shouldGoDeeper && stop && stop(obj[key])) {\n      shouldGoDeeper = false;\n    }\n\n    if (shouldGoDeeper) {\n      var flatObject = flattenObject(obj[key], delim, stop);\n\n      for (var flatKey in flatObject) {\n        if (!flatObject.hasOwnProperty(flatKey)) continue;\n        ret[key + delim + flatKey] = flatObject[flatKey];\n      }\n    } else {\n      ret[key] = obj[key];\n    }\n  }\n\n  return ret;\n};\nexport const uuid = function () {\n  // credit: http://stackoverflow.com/posts/2117523/revisions\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0;\n    var v = c === 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n}; // Generate global unique id for obj and store it as a property of the object.\n\nexport const guid = function (obj) {\n  guid.id = guid.id || 1;\n  obj.id = obj.id === undefined ? 'j_' + guid.id++ : obj.id;\n  return obj.id;\n};\nexport const toKebabCase = function (string) {\n  return string.replace(/[A-Z]/g, '-$&').toLowerCase();\n};\nexport const normalizeEvent = function (evt) {\n  var normalizedEvent = evt;\n  var touchEvt = evt.originalEvent && evt.originalEvent.changedTouches && evt.originalEvent.changedTouches[0];\n\n  if (touchEvt) {\n    for (var property in evt) {\n      // copy all the properties from the input event that are not\n      // defined on the touch event (functions included).\n      if (touchEvt[property] === undefined) {\n        touchEvt[property] = evt[property];\n      }\n    }\n\n    normalizedEvent = touchEvt;\n  } // IE: evt.target could be set to SVGElementInstance for SVGUseElement\n\n\n  var target = normalizedEvent.target;\n\n  if (target) {\n    var useElement = target.correspondingUseElement;\n    if (useElement) normalizedEvent.target = useElement;\n  }\n\n  return normalizedEvent;\n};\nexport const nextFrame = function () {\n  var raf;\n\n  if (typeof window !== 'undefined') {\n    raf = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame;\n  }\n\n  if (!raf) {\n    var lastTime = 0;\n\n    raf = function (callback) {\n      var currTime = new Date().getTime();\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n      var id = setTimeout(function () {\n        callback(currTime + timeToCall);\n      }, timeToCall);\n      lastTime = currTime + timeToCall;\n      return id;\n    };\n  }\n\n  return function (callback, context, ...rest) {\n    return context !== undefined ? raf(callback.bind(context, ...rest)) : raf(callback);\n  };\n}();\nexport const cancelFrame = function () {\n  var caf;\n  var client = typeof window != 'undefined';\n\n  if (client) {\n    caf = window.cancelAnimationFrame || window.webkitCancelAnimationFrame || window.webkitCancelRequestAnimationFrame || window.msCancelAnimationFrame || window.msCancelRequestAnimationFrame || window.oCancelAnimationFrame || window.oCancelRequestAnimationFrame || window.mozCancelAnimationFrame || window.mozCancelRequestAnimationFrame;\n  }\n\n  caf = caf || clearTimeout;\n  return client ? caf.bind(window) : caf;\n}();\n/**\n * @deprecated\n */\n\nexport const shapePerimeterConnectionPoint = function (linkView, view, magnet, reference) {\n  var bbox;\n  var spot;\n\n  if (!magnet) {\n    // There is no magnet, try to make the best guess what is the\n    // wrapping SVG element. This is because we want this \"smart\"\n    // connection points to work out of the box without the\n    // programmer to put magnet marks to any of the subelements.\n    // For example, we want the function to work on basic.Path elements\n    // without any special treatment of such elements.\n    // The code below guesses the wrapping element based on\n    // one simple assumption. The wrapping elemnet is the\n    // first child of the scalable group if such a group exists\n    // or the first child of the rotatable group if not.\n    // This makese sense because usually the wrapping element\n    // is below any other sub element in the shapes.\n    var scalable = view.$('.scalable')[0];\n    var rotatable = view.$('.rotatable')[0];\n\n    if (scalable && scalable.firstChild) {\n      magnet = scalable.firstChild;\n    } else if (rotatable && rotatable.firstChild) {\n      magnet = rotatable.firstChild;\n    }\n  }\n\n  if (magnet) {\n    spot = V(magnet).findIntersection(reference, linkView.paper.cells);\n\n    if (!spot) {\n      bbox = V(magnet).getBBox({\n        target: linkView.paper.cells\n      });\n    }\n  } else {\n    bbox = view.model.getBBox();\n    spot = bbox.intersectionWithLineFromCenterToPoint(reference);\n  }\n\n  return spot || bbox.center();\n};\nexport const isPercentage = function (val) {\n  return isString(val) && val.slice(-1) === '%';\n};\nexport const parseCssNumeric = function (val, restrictUnits) {\n  function getUnit(validUnitExp) {\n    // one or more numbers, followed by\n    // any number of (\n    //  `.`, followed by\n    //  one or more numbers\n    // ), followed by\n    // `validUnitExp`, followed by\n    // end of string\n    var matches = new RegExp('(?:\\\\d+(?:\\\\.\\\\d+)*)(' + validUnitExp + ')$').exec(val);\n    if (!matches) return null;\n    return matches[1];\n  }\n\n  var number = parseFloat(val); // if `val` cannot be parsed as a number, return `null`\n\n  if (Number.isNaN(number)) return null; // else: we know `output.value`\n\n  var output = {};\n  output.value = number; // determine the unit\n\n  var validUnitExp;\n\n  if (restrictUnits == null) {\n    // no restriction\n    // accept any unit, as well as no unit\n    validUnitExp = '[A-Za-z]*';\n  } else if (Array.isArray(restrictUnits)) {\n    // if this is an empty array, top restriction - return `null`\n    if (restrictUnits.length === 0) return null; // else: restriction - an array of valid unit strings\n\n    validUnitExp = restrictUnits.join('|');\n  } else if (isString(restrictUnits)) {\n    // restriction - a single valid unit string\n    validUnitExp = restrictUnits;\n  }\n\n  var unit = getUnit(validUnitExp); // if we found no matches for `restrictUnits`, return `null`\n\n  if (unit === null) return null; // else: we know the unit\n\n  output.unit = unit;\n  return output;\n};\nexport const breakText = function (text, size, styles = {}, opt = {}) {\n  var width = size.width;\n  var height = size.height;\n  var svgDocument = opt.svgDocument || V('svg').node;\n  var textSpan = V('tspan').node;\n  var textElement = V('text').attr(styles).append(textSpan).node;\n  var textNode = document.createTextNode(''); // Prevent flickering\n\n  textElement.style.opacity = 0; // Prevent FF from throwing an uncaught exception when `getBBox()`\n  // called on element that is not in the render tree (is not measurable).\n  // <tspan>.getComputedTextLength() returns always 0 in this case.\n  // Note that the `textElement` resp. `textSpan` can become hidden\n  // when it's appended to the DOM and a `display: none` CSS stylesheet\n  // rule gets applied.\n\n  textElement.style.display = 'block';\n  textSpan.style.display = 'block';\n  textSpan.appendChild(textNode);\n  svgDocument.appendChild(textElement); // lgtm [js/xss-through-dom]\n\n  if (!opt.svgDocument) {\n    document.body.appendChild(svgDocument);\n  }\n\n  var separator = opt.separator || ' ';\n  var eol = opt.eol || '\\n';\n  var hyphen = opt.hyphen ? new RegExp(opt.hyphen) : /[^\\w\\d]/;\n  var maxLineCount = opt.maxLineCount;\n  if (!isNumber(maxLineCount)) maxLineCount = Infinity;\n  var words = text.split(separator);\n  var full = [];\n  var lines = [];\n  var p, h;\n  var lineHeight;\n\n  for (var i = 0, l = 0, len = words.length; i < len; i++) {\n    var word = words[i];\n    if (!word) continue;\n    var isEol = false;\n\n    if (eol && word.indexOf(eol) >= 0) {\n      // word contains end-of-line character\n      if (word.length > 1) {\n        // separate word and continue cycle\n        var eolWords = word.split(eol);\n\n        for (var j = 0, jl = eolWords.length - 1; j < jl; j++) {\n          eolWords.splice(2 * j + 1, 0, eol);\n        }\n\n        words.splice(i, 1, ...eolWords.filter(word => word !== ''));\n        i--;\n        len = words.length;\n        continue;\n      } else {\n        // creates a new line\n        lines[++l] = '';\n        isEol = true;\n      }\n    }\n\n    if (!isEol) {\n      textNode.data = lines[l] ? lines[l] + ' ' + word : word;\n\n      if (textSpan.getComputedTextLength() <= width) {\n        // the current line fits\n        lines[l] = textNode.data;\n\n        if (p || h) {\n          // We were partitioning. Put rest of the word onto next line\n          full[l++] = true; // cancel partitioning and splitting by hyphens\n\n          p = 0;\n          h = 0;\n        }\n      } else {\n        if (!lines[l] || p) {\n          var partition = !!p;\n          p = word.length - 1;\n\n          if (partition || !p) {\n            // word has only one character.\n            if (!p) {\n              if (!lines[l]) {\n                // we won't fit this text within our rect\n                lines = [];\n                break;\n              } // partitioning didn't help on the non-empty line\n              // try again, but this time start with a new line\n              // cancel partitions created\n\n\n              words.splice(i, 2, word + words[i + 1]); // adjust word length\n\n              len--;\n              full[l++] = true;\n              i--;\n              continue;\n            } // move last letter to the beginning of the next word\n\n\n            words[i] = word.substring(0, p);\n            words[i + 1] = word.substring(p) + (words[i + 1] === undefined ? '' : words[i + 1]);\n          } else {\n            if (h) {\n              // cancel splitting and put the words together again\n              words.splice(i, 2, words[i] + words[i + 1]);\n              h = 0;\n            } else {\n              var hyphenIndex = word.search(hyphen);\n\n              if (hyphenIndex > -1 && hyphenIndex !== word.length - 1 && hyphenIndex !== 0) {\n                h = hyphenIndex + 1;\n                p = 0;\n              } // We initiate partitioning or splitting\n              // split the long word into two words\n\n\n              words.splice(i, 1, word.substring(0, h || p), word.substring(h || p)); // adjust words length\n\n              len++;\n            }\n\n            if (l && !full[l - 1]) {\n              // if the previous line is not full, try to fit max part of\n              // the current word there\n              l--;\n            }\n          }\n\n          i--;\n          continue;\n        }\n\n        l++;\n        i--;\n      }\n    }\n\n    var lastL = null;\n\n    if (lines.length > maxLineCount) {\n      lastL = maxLineCount - 1;\n    } else if (height !== undefined) {\n      // if size.height is defined we have to check whether the height of the entire\n      // text exceeds the rect height\n      if (lineHeight === undefined) {\n        var heightValue; // use the same defaults as in V.prototype.text\n\n        if (styles.lineHeight === 'auto') {\n          heightValue = {\n            value: 1.5,\n            unit: 'em'\n          };\n        } else {\n          heightValue = parseCssNumeric(styles.lineHeight, ['em']) || {\n            value: 1,\n            unit: 'em'\n          };\n        }\n\n        lineHeight = heightValue.value;\n\n        if (heightValue.unit === 'em') {\n          lineHeight *= textElement.getBBox().height;\n        }\n      }\n\n      if (lineHeight * lines.length > height) {\n        // remove overflowing lines\n        lastL = Math.floor(height / lineHeight) - 1;\n      }\n    }\n\n    if (lastL !== null) {\n      lines.splice(lastL + 1); // add ellipsis\n\n      var ellipsis = opt.ellipsis;\n      if (!ellipsis || lastL < 0) break;\n      if (typeof ellipsis !== 'string') ellipsis = '\\u2026';\n      var lastLine = lines[lastL];\n      if (!lastLine && !isEol) break;\n      var k = lastLine.length;\n      var lastLineWithOmission, lastChar, separatorChar;\n\n      do {\n        lastChar = lastLine[k];\n        lastLineWithOmission = lastLine.substring(0, k);\n\n        if (!lastChar) {\n          separatorChar = typeof separator === 'string' ? separator : ' ';\n          lastLineWithOmission += separatorChar;\n        } else if (lastChar.match(separator)) {\n          lastLineWithOmission += lastChar;\n        }\n\n        lastLineWithOmission += ellipsis;\n        textNode.data = lastLineWithOmission;\n\n        if (textSpan.getComputedTextLength() <= width) {\n          lines[lastL] = lastLineWithOmission;\n          break;\n        }\n\n        k--;\n      } while (k >= 0);\n\n      break;\n    }\n  }\n\n  if (opt.svgDocument) {\n    // svg document was provided, remove the text element only\n    svgDocument.removeChild(textElement);\n  } else {\n    // clean svg document\n    document.body.removeChild(svgDocument);\n  }\n\n  return lines.join(eol);\n}; // Sanitize HTML\n// Based on https://gist.github.com/ufologist/5a0da51b2b9ef1b861c30254172ac3c9\n// Parses a string into an array of DOM nodes.\n// Then outputs it back as a string.\n\nexport const sanitizeHTML = function (html) {\n  // Ignores tags that are invalid inside a <div> tag (e.g. <body>, <head>)\n  // If documentContext (second parameter) is not specified or given as `null` or `undefined`, a new document is used.\n  // Inline events will not execute when the HTML is parsed; this includes, for example, sending GET requests for images.\n  // If keepScripts (last parameter) is `false`, scripts are not executed.\n  var output = $($.parseHTML('<div>' + html + '</div>', null, false));\n  output.find('*').each(function () {\n    // for all nodes\n    var currentNode = this;\n    $.each(currentNode.attributes, function () {\n      // for all attributes in each node\n      var currentAttribute = this;\n      var attrName = currentAttribute.name;\n      var attrValue = currentAttribute.value; // Remove attribute names that start with \"on\" (e.g. onload, onerror...).\n      // Remove attribute values that start with \"javascript:\" pseudo protocol (e.g. `href=\"javascript:alert(1)\"`).\n\n      if (attrName.startsWith('on') || attrValue.startsWith('javascript:') || attrValue.startsWith('data:') || attrValue.startsWith('vbscript:')) {\n        $(currentNode).removeAttr(attrName);\n      }\n    });\n  });\n  return output.html();\n}; // Download `blob` as file with `fileName`.\n// Does not work in IE9.\n\nexport const downloadBlob = function (blob, fileName) {\n  if (window.navigator.msSaveBlob) {\n    // requires IE 10+\n    // pulls up a save dialog\n    window.navigator.msSaveBlob(blob, fileName);\n  } else {\n    // other browsers\n    // downloads directly in Chrome and Safari\n    // presents a save/open dialog in Firefox\n    // Firefox bug: `from` field in save dialog always shows `from:blob:`\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1053327\n    var url = window.URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = url;\n    link.download = fileName;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(url); // mark the url for garbage collection\n  }\n}; // Download `dataUri` as file with `fileName`.\n// Does not work in IE9.\n\nexport const downloadDataUri = function (dataUri, fileName) {\n  const blob = dataUriToBlob(dataUri);\n  downloadBlob(blob, fileName);\n}; // Convert an uri-encoded data component (possibly also base64-encoded) to a blob.\n\nexport const dataUriToBlob = function (dataUri) {\n  // first, make sure there are no newlines in the data uri\n  dataUri = dataUri.replace(/\\s/g, '');\n  dataUri = decodeURIComponent(dataUri);\n  var firstCommaIndex = dataUri.indexOf(','); // split dataUri as `dataTypeString`,`data`\n\n  var dataTypeString = dataUri.slice(0, firstCommaIndex); // e.g. 'data:image/jpeg;base64'\n\n  var mimeString = dataTypeString.split(':')[1].split(';')[0]; // e.g. 'image/jpeg'\n\n  var data = dataUri.slice(firstCommaIndex + 1);\n  var decodedString;\n\n  if (dataTypeString.indexOf('base64') >= 0) {\n    // data may be encoded in base64\n    decodedString = atob(data); // decode data\n  } else {\n    // convert the decoded string to UTF-8\n    decodedString = unescape(encodeURIComponent(data));\n  } // write the bytes of the string to a typed array\n\n\n  var ia = new Uint8Array(decodedString.length);\n\n  for (var i = 0; i < decodedString.length; i++) {\n    ia[i] = decodedString.charCodeAt(i);\n  }\n\n  return new Blob([ia], {\n    type: mimeString\n  }); // return the typed array as Blob\n}; // Read an image at `url` and return it as base64-encoded data uri.\n// The mime type of the image is inferred from the `url` file extension.\n// If data uri is provided as `url`, it is returned back unchanged.\n// `callback` is a method with `err` as first argument and `dataUri` as second argument.\n// Works with IE9.\n\nexport const imageToDataUri = function (url, callback) {\n  if (!url || url.substr(0, 'data:'.length) === 'data:') {\n    // No need to convert to data uri if it is already in data uri.\n    // This not only convenient but desired. For example,\n    // IE throws a security error if data:image/svg+xml is used to render\n    // an image to the canvas and an attempt is made to read out data uri.\n    // Now if our image is already in data uri, there is no need to render it to the canvas\n    // and so we can bypass this error.\n    // Keep the async nature of the function.\n    return setTimeout(function () {\n      callback(null, url);\n    }, 0);\n  } // chrome, IE10+\n\n\n  var modernHandler = function (xhr, callback) {\n    if (xhr.status === 200) {\n      var reader = new FileReader();\n\n      reader.onload = function (evt) {\n        var dataUri = evt.target.result;\n        callback(null, dataUri);\n      };\n\n      reader.onerror = function () {\n        callback(new Error('Failed to load image ' + url));\n      };\n\n      reader.readAsDataURL(xhr.response);\n    } else {\n      callback(new Error('Failed to load image ' + url));\n    }\n  };\n\n  var legacyHandler = function (xhr, callback) {\n    var Uint8ToString = function (u8a) {\n      var CHUNK_SZ = 0x8000;\n      var c = [];\n\n      for (var i = 0; i < u8a.length; i += CHUNK_SZ) {\n        c.push(String.fromCharCode.apply(null, u8a.subarray(i, i + CHUNK_SZ)));\n      }\n\n      return c.join('');\n    };\n\n    if (xhr.status === 200) {\n      var bytes = new Uint8Array(xhr.response);\n      var suffix = url.split('.').pop() || 'png';\n      var map = {\n        'svg': 'svg+xml'\n      };\n      var meta = 'data:image/' + (map[suffix] || suffix) + ';base64,';\n      var b64encoded = meta + btoa(Uint8ToString(bytes));\n      callback(null, b64encoded);\n    } else {\n      callback(new Error('Failed to load image ' + url));\n    }\n  };\n\n  var xhr = new XMLHttpRequest();\n  xhr.open('GET', url, true);\n  xhr.addEventListener('error', function () {\n    callback(new Error('Failed to load image ' + url));\n  });\n  xhr.responseType = window.FileReader ? 'blob' : 'arraybuffer';\n  xhr.addEventListener('load', function () {\n    if (window.FileReader) {\n      modernHandler(xhr, callback);\n    } else {\n      legacyHandler(xhr, callback);\n    }\n  });\n  xhr.send();\n};\nexport const getElementBBox = function (el) {\n  var $el = $(el);\n\n  if ($el.length === 0) {\n    throw new Error('Element not found');\n  }\n\n  var element = $el[0];\n  var doc = element.ownerDocument;\n  var clientBBox = element.getBoundingClientRect();\n  var strokeWidthX = 0;\n  var strokeWidthY = 0; // Firefox correction\n\n  if (element.ownerSVGElement) {\n    var vel = V(element);\n    var bbox = vel.getBBox({\n      target: vel.svg()\n    }); // if FF getBoundingClientRect includes stroke-width, getBBox doesn't.\n    // To unify this across all browsers we need to adjust the final bBox with `stroke-width` value.\n\n    strokeWidthX = clientBBox.width - bbox.width;\n    strokeWidthY = clientBBox.height - bbox.height;\n  }\n\n  return {\n    x: clientBBox.left + window.pageXOffset - doc.documentElement.offsetLeft + strokeWidthX / 2,\n    y: clientBBox.top + window.pageYOffset - doc.documentElement.offsetTop + strokeWidthY / 2,\n    width: clientBBox.width - strokeWidthX,\n    height: clientBBox.height - strokeWidthY\n  };\n}; // Highly inspired by the jquery.sortElements plugin by Padolsey.\n// See http://james.padolsey.com/javascript/sorting-elements-with-jquery/.\n\nexport const sortElements = function (elements, comparator) {\n  var $elements = $(elements);\n  var placements = $elements.map(function () {\n    var sortElement = this;\n    var parentNode = sortElement.parentNode; // Since the element itself will change position, we have\n    // to have some way of storing it's original position in\n    // the DOM. The easiest way is to have a 'flag' node:\n\n    var nextSibling = parentNode.insertBefore(document.createTextNode(''), sortElement.nextSibling);\n    return function () {\n      if (parentNode === this) {\n        throw new Error('You can\\'t sort elements if any one is a descendant of another.');\n      } // Insert before flag:\n\n\n      parentNode.insertBefore(this, nextSibling); // Remove flag:\n\n      parentNode.removeChild(nextSibling);\n    };\n  });\n  return Array.prototype.sort.call($elements, comparator).each(function (i) {\n    placements[i].call(this);\n  });\n}; // Sets attributes on the given element and its descendants based on the selector.\n// `attrs` object: { [SELECTOR1]: { attrs1 }, [SELECTOR2]: { attrs2}, ... } e.g. { 'input': { color : 'red' }}\n\nexport const setAttributesBySelector = function (element, attrs) {\n  var $element = $(element);\n  forIn(attrs, function (attrs, selector) {\n    var $elements = $element.find(selector).addBack().filter(selector); // Make a special case for setting classes.\n    // We do not want to overwrite any existing class.\n\n    if (has(attrs, 'class')) {\n      $elements.addClass(attrs['class']);\n      attrs = omit(attrs, 'class');\n    }\n\n    $elements.attr(attrs);\n  });\n}; // Return a new object with all four sides (top, right, bottom, left) in it.\n// Value of each side is taken from the given argument (either number or object).\n// Default value for a side is 0.\n// Examples:\n// normalizeSides(5) --> { top: 5, right: 5, bottom: 5, left: 5 }\n// normalizeSides({ horizontal: 5 }) --> { top: 0, right: 5, bottom: 0, left: 5 }\n// normalizeSides({ left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 10, left: 5 }) --> { top: 0, right: 10, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 0, left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\n\nexport const normalizeSides = function (box) {\n  if (Object(box) !== box) {\n    // `box` is not an object\n    var val = 0; // `val` left as 0 if `box` cannot be understood as finite number\n\n    if (isFinite(box)) val = +box; // actually also accepts string numbers (e.g. '100')\n\n    return {\n      top: val,\n      right: val,\n      bottom: val,\n      left: val\n    };\n  } // `box` is an object\n\n\n  var top, right, bottom, left;\n  top = right = bottom = left = 0;\n  if (isFinite(box.vertical)) top = bottom = +box.vertical;\n  if (isFinite(box.horizontal)) right = left = +box.horizontal;\n  if (isFinite(box.top)) top = +box.top; // overwrite vertical\n\n  if (isFinite(box.right)) right = +box.right; // overwrite horizontal\n\n  if (isFinite(box.bottom)) bottom = +box.bottom; // overwrite vertical\n\n  if (isFinite(box.left)) left = +box.left; // overwrite horizontal\n\n  return {\n    top: top,\n    right: right,\n    bottom: bottom,\n    left: left\n  };\n};\nexport const timing = {\n  linear: function (t) {\n    return t;\n  },\n  quad: function (t) {\n    return t * t;\n  },\n  cubic: function (t) {\n    return t * t * t;\n  },\n  inout: function (t) {\n    if (t <= 0) return 0;\n    if (t >= 1) return 1;\n    var t2 = t * t;\n    var t3 = t2 * t;\n    return 4 * (t < .5 ? t3 : 3 * (t - t2) + t3 - .75);\n  },\n  exponential: function (t) {\n    return Math.pow(2, 10 * (t - 1));\n  },\n  bounce: function (t) {\n    for (var a = 0, b = 1; 1; a += b, b /= 2) {\n      if (t >= (7 - 4 * a) / 11) {\n        var q = (11 - 6 * a - 11 * t) / 4;\n        return -q * q + b * b;\n      }\n    }\n  },\n  reverse: function (f) {\n    return function (t) {\n      return 1 - f(1 - t);\n    };\n  },\n  reflect: function (f) {\n    return function (t) {\n      return .5 * (t < .5 ? f(2 * t) : 2 - f(2 - 2 * t));\n    };\n  },\n  clamp: function (f, n, x) {\n    n = n || 0;\n    x = x || 1;\n    return function (t) {\n      var r = f(t);\n      return r < n ? n : r > x ? x : r;\n    };\n  },\n  back: function (s) {\n    if (!s) s = 1.70158;\n    return function (t) {\n      return t * t * ((s + 1) * t - s);\n    };\n  },\n  elastic: function (x) {\n    if (!x) x = 1.5;\n    return function (t) {\n      return Math.pow(2, 10 * (t - 1)) * Math.cos(20 * Math.PI * x / 3 * t);\n    };\n  }\n};\nexport const interpolate = {\n  number: function (a, b) {\n    var d = b - a;\n    return function (t) {\n      return a + d * t;\n    };\n  },\n  object: function (a, b) {\n    var s = Object.keys(a);\n    return function (t) {\n      var i, p;\n      var r = {};\n\n      for (i = s.length - 1; i != -1; i--) {\n        p = s[i];\n        r[p] = a[p] + (b[p] - a[p]) * t;\n      }\n\n      return r;\n    };\n  },\n  hexColor: function (a, b) {\n    var ca = parseInt(a.slice(1), 16);\n    var cb = parseInt(b.slice(1), 16);\n    var ra = ca & 0x0000ff;\n    var rd = (cb & 0x0000ff) - ra;\n    var ga = ca & 0x00ff00;\n    var gd = (cb & 0x00ff00) - ga;\n    var ba = ca & 0xff0000;\n    var bd = (cb & 0xff0000) - ba;\n    return function (t) {\n      var r = ra + rd * t & 0x000000ff;\n      var g = ga + gd * t & 0x0000ff00;\n      var b = ba + bd * t & 0x00ff0000;\n      return '#' + (1 << 24 | r | g | b).toString(16).slice(1);\n    };\n  },\n  unit: function (a, b) {\n    var r = /(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;\n    var ma = r.exec(a);\n    var mb = r.exec(b);\n    var p = mb[1].indexOf('.');\n    var f = p > 0 ? mb[1].length - p - 1 : 0;\n    a = +ma[1];\n    var d = +mb[1] - a;\n    var u = ma[2];\n    return function (t) {\n      return (a + d * t).toFixed(f) + u;\n    };\n  }\n}; // SVG filters.\n// (values in parentheses are default values)\n\nexport const filter = {\n  // `color` ... outline color ('blue')\n  // `width`... outline width (1)\n  // `opacity` ... outline opacity (1)\n  // `margin` ... gap between outline and the element (2)\n  outline: function (args) {\n    var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology in=\"SourceAlpha\" result=\"morphedOuter\" operator=\"dilate\" radius=\"${outerRadius}\" /><feMorphology in=\"SourceAlpha\" result=\"morphedInner\" operator=\"dilate\" radius=\"${innerRadius}\" /><feComposite result=\"morphedOuterColored\" in=\"colored\" in2=\"morphedOuter\" operator=\"in\"/><feComposite operator=\"xor\" in=\"morphedOuterColored\" in2=\"morphedInner\" result=\"outline\"/><feMerge><feMergeNode in=\"outline\"/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n    var margin = Number.isFinite(args.margin) ? args.margin : 2;\n    var width = Number.isFinite(args.width) ? args.width : 1;\n    return template(tpl)({\n      color: args.color || 'blue',\n      opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n      outerRadius: margin + width,\n      innerRadius: margin\n    });\n  },\n  // `color` ... color ('red')\n  // `width`... width (1)\n  // `blur` ... blur (0)\n  // `opacity` ... opacity (1)\n  highlight: function (args) {\n    var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology result=\"morphed\" in=\"SourceGraphic\" operator=\"dilate\" radius=\"${width}\"/><feComposite result=\"composed\" in=\"colored\" in2=\"morphed\" operator=\"in\"/><feGaussianBlur result=\"blured\" in=\"composed\" stdDeviation=\"${blur}\"/><feBlend in=\"SourceGraphic\" in2=\"blured\" mode=\"normal\"/></filter>';\n    return template(tpl)({\n      color: args.color || 'red',\n      width: Number.isFinite(args.width) ? args.width : 1,\n      blur: Number.isFinite(args.blur) ? args.blur : 0,\n      opacity: Number.isFinite(args.opacity) ? args.opacity : 1\n    });\n  },\n  // `x` ... horizontal blur (2)\n  // `y` ... vertical blur (optional)\n  blur: function (args) {\n    var x = Number.isFinite(args.x) ? args.x : 2;\n    return template('<filter><feGaussianBlur stdDeviation=\"${stdDeviation}\"/></filter>')({\n      stdDeviation: Number.isFinite(args.y) ? [x, args.y] : x\n    });\n  },\n  // `dx` ... horizontal shift (0)\n  // `dy` ... vertical shift (0)\n  // `blur` ... blur (4)\n  // `color` ... color ('black')\n  // `opacity` ... opacity (1)\n  dropShadow: function (args) {\n    var tpl = 'SVGFEDropShadowElement' in window ? '<filter><feDropShadow stdDeviation=\"${blur}\" dx=\"${dx}\" dy=\"${dy}\" flood-color=\"${color}\" flood-opacity=\"${opacity}\"/></filter>' : '<filter><feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"${blur}\"/><feOffset dx=\"${dx}\" dy=\"${dy}\" result=\"offsetblur\"/><feFlood flood-color=\"${color}\"/><feComposite in2=\"offsetblur\" operator=\"in\"/><feComponentTransfer><feFuncA type=\"linear\" slope=\"${opacity}\"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n    return template(tpl)({\n      dx: args.dx || 0,\n      dy: args.dy || 0,\n      opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n      color: args.color || 'black',\n      blur: Number.isFinite(args.blur) ? args.blur : 4\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely grayscale. A value of 0 leaves the input unchanged.\n  grayscale: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0\"/></filter>')({\n      a: 0.2126 + 0.7874 * (1 - amount),\n      b: 0.7152 - 0.7152 * (1 - amount),\n      c: 0.0722 - 0.0722 * (1 - amount),\n      d: 0.2126 - 0.2126 * (1 - amount),\n      e: 0.7152 + 0.2848 * (1 - amount),\n      f: 0.0722 - 0.0722 * (1 - amount),\n      g: 0.2126 - 0.2126 * (1 - amount),\n      h: 0.0722 + 0.9278 * (1 - amount)\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely sepia. A value of 0 leaves the input unchanged.\n  sepia: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0\"/></filter>')({\n      a: 0.393 + 0.607 * (1 - amount),\n      b: 0.769 - 0.769 * (1 - amount),\n      c: 0.189 - 0.189 * (1 - amount),\n      d: 0.349 - 0.349 * (1 - amount),\n      e: 0.686 + 0.314 * (1 - amount),\n      f: 0.168 - 0.168 * (1 - amount),\n      g: 0.272 - 0.272 * (1 - amount),\n      h: 0.534 - 0.534 * (1 - amount),\n      i: 0.131 + 0.869 * (1 - amount)\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 0 is completely un-saturated. A value of 1 (default) leaves the input unchanged.\n  saturate: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feColorMatrix type=\"saturate\" values=\"${amount}\"/></filter>')({\n      amount: 1 - amount\n    });\n  },\n  // `angle` ...  the number of degrees around the color circle the input samples will be adjusted (0).\n  hueRotate: function (args) {\n    return template('<filter><feColorMatrix type=\"hueRotate\" values=\"${angle}\"/></filter>')({\n      angle: args.angle || 0\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely inverted. A value of 0 leaves the input unchanged.\n  invert: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feComponentTransfer><feFuncR type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncG type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncB type=\"table\" tableValues=\"${amount} ${amount2}\"/></feComponentTransfer></filter>')({\n      amount: amount,\n      amount2: 1 - amount\n    });\n  },\n  // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n  brightness: function (args) {\n    return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\"/><feFuncG type=\"linear\" slope=\"${amount}\"/><feFuncB type=\"linear\" slope=\"${amount}\"/></feComponentTransfer></filter>')({\n      amount: Number.isFinite(args.amount) ? args.amount : 1\n    });\n  },\n  // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n  contrast: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncG type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncB type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/></feComponentTransfer></filter>')({\n      amount: amount,\n      amount2: .5 - amount / 2\n    });\n  }\n};\nexport const format = {\n  // Formatting numbers via the Python Format Specification Mini-language.\n  // See http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n  // Heavilly inspired by the D3.js library implementation.\n  number: function (specifier, value, locale) {\n    locale = locale || {\n      currency: ['$', ''],\n      decimal: '.',\n      thousands: ',',\n      grouping: [3]\n    }; // See Python format specification mini-language: http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n    // [[fill]align][sign][symbol][0][width][,][.precision][type]\n\n    var re = /(?:([^{])?([<>=^]))?([+\\- ])?([$#])?(0)?(\\d+)?(,)?(\\.-?\\d+)?([a-z%])?/i;\n    var match = re.exec(specifier);\n    var fill = match[1] || ' ';\n    var align = match[2] || '>';\n    var sign = match[3] || '';\n    var symbol = match[4] || '';\n    var zfill = match[5];\n    var width = +match[6];\n    var comma = match[7];\n    var precision = match[8];\n    var type = match[9];\n    var scale = 1;\n    var prefix = '';\n    var suffix = '';\n    var integer = false;\n    if (precision) precision = +precision.substring(1);\n\n    if (zfill || fill === '0' && align === '=') {\n      zfill = fill = '0';\n      align = '=';\n      if (comma) width -= Math.floor((width - 1) / 4);\n    }\n\n    switch (type) {\n      case 'n':\n        comma = true;\n        type = 'g';\n        break;\n\n      case '%':\n        scale = 100;\n        suffix = '%';\n        type = 'f';\n        break;\n\n      case 'p':\n        scale = 100;\n        suffix = '%';\n        type = 'r';\n        break;\n\n      case 'b':\n      case 'o':\n      case 'x':\n      case 'X':\n        if (symbol === '#') prefix = '0' + type.toLowerCase();\n        break;\n\n      case 'c':\n      case 'd':\n        integer = true;\n        precision = 0;\n        break;\n\n      case 's':\n        scale = -1;\n        type = 'r';\n        break;\n    }\n\n    if (symbol === '$') {\n      prefix = locale.currency[0];\n      suffix = locale.currency[1];\n    } // If no precision is specified for `'r'`, fallback to general notation.\n\n\n    if (type == 'r' && !precision) type = 'g'; // Ensure that the requested precision is in the supported range.\n\n    if (precision != null) {\n      if (type == 'g') precision = Math.max(1, Math.min(21, precision));else if (type == 'e' || type == 'f') precision = Math.max(0, Math.min(20, precision));\n    }\n\n    var zcomma = zfill && comma; // Return the empty string for floats formatted as ints.\n\n    if (integer && value % 1) return ''; // Convert negative to positive, and record the sign prefix.\n\n    var negative = value < 0 || value === 0 && 1 / value < 0 ? (value = -value, '-') : sign;\n    var fullSuffix = suffix; // Apply the scale, computing it from the value's exponent for si format.\n    // Preserve the existing suffix, if any, such as the currency symbol.\n\n    if (scale < 0) {\n      var unit = this.prefix(value, precision);\n      value = unit.scale(value);\n      fullSuffix = unit.symbol + suffix;\n    } else {\n      value *= scale;\n    } // Convert to the desired precision.\n\n\n    value = this.convert(type, value, precision); // Break the value into the integer part (before) and decimal part (after).\n\n    var i = value.lastIndexOf('.');\n    var before = i < 0 ? value : value.substring(0, i);\n    var after = i < 0 ? '' : locale.decimal + value.substring(i + 1);\n\n    function formatGroup(value) {\n      var i = value.length;\n      var t = [];\n      var j = 0;\n      var g = locale.grouping[0];\n\n      while (i > 0 && g > 0) {\n        t.push(value.substring(i -= g, i + g));\n        g = locale.grouping[j = (j + 1) % locale.grouping.length];\n      }\n\n      return t.reverse().join(locale.thousands);\n    } // If the fill character is not `'0'`, grouping is applied before padding.\n\n\n    if (!zfill && comma && locale.grouping) {\n      before = formatGroup(before);\n    }\n\n    var length = prefix.length + before.length + after.length + (zcomma ? 0 : negative.length);\n    var padding = length < width ? new Array(length = width - length + 1).join(fill) : ''; // If the fill character is `'0'`, grouping is applied after padding.\n\n    if (zcomma) before = formatGroup(padding + before); // Apply prefix.\n\n    negative += prefix; // Rejoin integer and decimal parts.\n\n    value = before + after;\n    return (align === '<' ? negative + value + padding : align === '>' ? padding + negative + value : align === '^' ? padding.substring(0, length >>= 1) + negative + value + padding.substring(length) : negative + (zcomma ? value : padding + value)) + fullSuffix;\n  },\n  // Formatting string via the Python Format string.\n  // See https://docs.python.org/2/library/string.html#format-string-syntax)\n  string: function (formatString, value) {\n    var fieldDelimiterIndex;\n    var fieldDelimiter = '{';\n    var endPlaceholder = false;\n    var formattedStringArray = [];\n\n    while ((fieldDelimiterIndex = formatString.indexOf(fieldDelimiter)) !== -1) {\n      var pieceFormattedString, formatSpec, fieldName;\n      pieceFormattedString = formatString.slice(0, fieldDelimiterIndex);\n\n      if (endPlaceholder) {\n        formatSpec = pieceFormattedString.split(':');\n        fieldName = formatSpec.shift().split('.');\n        pieceFormattedString = value;\n\n        for (var i = 0; i < fieldName.length; i++) pieceFormattedString = pieceFormattedString[fieldName[i]];\n\n        if (formatSpec.length) pieceFormattedString = this.number(formatSpec, pieceFormattedString);\n      }\n\n      formattedStringArray.push(pieceFormattedString);\n      formatString = formatString.slice(fieldDelimiterIndex + 1);\n      endPlaceholder = !endPlaceholder;\n      fieldDelimiter = endPlaceholder ? '}' : '{';\n    }\n\n    formattedStringArray.push(formatString);\n    return formattedStringArray.join('');\n  },\n  convert: function (type, value, precision) {\n    switch (type) {\n      case 'b':\n        return value.toString(2);\n\n      case 'c':\n        return String.fromCharCode(value);\n\n      case 'o':\n        return value.toString(8);\n\n      case 'x':\n        return value.toString(16);\n\n      case 'X':\n        return value.toString(16).toUpperCase();\n\n      case 'g':\n        return value.toPrecision(precision);\n\n      case 'e':\n        return value.toExponential(precision);\n\n      case 'f':\n        return value.toFixed(precision);\n\n      case 'r':\n        return (value = this.round(value, this.precision(value, precision))).toFixed(Math.max(0, Math.min(20, this.precision(value * (1 + 1e-15), precision))));\n\n      default:\n        return value + '';\n    }\n  },\n  round: function (value, precision) {\n    return precision ? Math.round(value * (precision = Math.pow(10, precision))) / precision : Math.round(value);\n  },\n  precision: function (value, precision) {\n    return precision - (value ? Math.ceil(Math.log(value) / Math.LN10) : 1);\n  },\n  prefix: function (value, precision) {\n    var prefixes = ['y', 'z', 'a', 'f', 'p', 'n', 'Âµ', 'm', '', 'k', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y'].map(function (d, i) {\n      var k = Math.pow(10, Math.abs(8 - i) * 3);\n      return {\n        scale: i > 8 ? function (d) {\n          return d / k;\n        } : function (d) {\n          return d * k;\n        },\n        symbol: d\n      };\n    });\n    var i = 0;\n\n    if (value) {\n      if (value < 0) value *= -1;\n      if (precision) value = this.round(value, this.precision(value, precision));\n      i = 1 + Math.floor(1e-12 + Math.log(value) / Math.LN10);\n      i = Math.max(-24, Math.min(24, Math.floor((i <= 0 ? i + 1 : i - 1) / 3) * 3));\n    }\n\n    return prefixes[8 + i / 3];\n  }\n};\n/*\n    Pre-compile the HTML to be used as a template.\n*/\n\nexport const template = function (html) {\n  /*\n      Must support the variation in templating syntax found here:\n      https://lodash.com/docs#template\n  */\n  var regex = /<%= ([^ ]+) %>|\\$\\{ ?([^{} ]+) ?\\}|\\{\\{([^{} ]+)\\}\\}/g;\n  return function (data) {\n    data = data || {};\n    return html.replace(regex, function (match) {\n      var args = Array.from(arguments);\n      var attr = args.slice(1, 4).find(function (_attr) {\n        return !!_attr;\n      });\n      var attrArray = attr.split('.');\n      var value = data[attrArray.shift()];\n\n      while (value !== undefined && attrArray.length) {\n        value = value[attrArray.shift()];\n      }\n\n      return value !== undefined ? value : '';\n    });\n  };\n};\n/**\n * @param {Element} el Element, which content is intent to display in full-screen mode, 'window.top.document.body' is default.\n */\n\nexport const toggleFullScreen = function (el) {\n  var topDocument = window.top.document;\n  el = el || topDocument.body;\n\n  function prefixedResult(el, prop) {\n    var prefixes = ['webkit', 'moz', 'ms', 'o', ''];\n\n    for (var i = 0; i < prefixes.length; i++) {\n      var prefix = prefixes[i];\n      var propName = prefix ? prefix + prop : prop.substr(0, 1).toLowerCase() + prop.substr(1);\n\n      if (el[propName] !== undefined) {\n        return isFunction(el[propName]) ? el[propName]() : el[propName];\n      }\n    }\n  }\n\n  if (prefixedResult(topDocument, 'FullscreenElement') || prefixedResult(topDocument, 'FullScreenElement')) {\n    prefixedResult(topDocument, 'ExitFullscreen') || // Spec.\n    prefixedResult(topDocument, 'CancelFullScreen'); // Firefox\n  } else {\n    prefixedResult(el, 'RequestFullscreen') || // Spec.\n    prefixedResult(el, 'RequestFullScreen'); // Firefox\n  }\n}; // Deprecated\n// Copy all the properties to the first argument from the following arguments.\n// All the properties will be overwritten by the properties from the following\n// arguments. Inherited properties are ignored.\n\nexport const mixin = _.assign; // Deprecated\n// Copy all properties to the first argument from the following\n// arguments only in case if they don't exists in the first argument.\n// All the function propererties in the first argument will get\n// additional property base pointing to the extenders same named\n// property function's call method.\n\nexport const supplement = _.defaults; // Same as `mixin()` but deep version.\n\nexport const deepMixin = mixin; // Deprecated\n// Same as `supplement()` but deep version.\n\nexport const deepSupplement = _.defaultsDeep; // Replacements for deprecated functions\n\nexport const assign = _.assign;\nexport const defaults = _.defaults; // no better-named replacement for `deepMixin`\n\nexport const defaultsDeep = _.defaultsDeep; // Lodash 3 vs 4 incompatible\n\nexport const invoke = _.invokeMap || _.invoke;\nexport const sortedIndex = _.sortedIndexBy || _.sortedIndex;\nexport const uniq = _.uniqBy || _.uniq;\nexport const clone = _.clone;\nexport const cloneDeep = _.cloneDeep;\nexport const isEmpty = _.isEmpty;\nexport const isEqual = _.isEqual;\nexport const isFunction = _.isFunction;\nexport const isPlainObject = _.isPlainObject;\nexport const toArray = _.toArray;\nexport const debounce = _.debounce;\nexport const groupBy = _.groupBy;\nexport const sortBy = _.sortBy;\nexport const flattenDeep = _.flattenDeep;\nexport const without = _.without;\nexport const difference = _.difference;\nexport const intersection = _.intersection;\nexport const union = _.union;\nexport const has = _.has;\nexport const result = _.result;\nexport const omit = _.omit;\nexport const pick = _.pick;\nexport const bindAll = _.bindAll;\nexport const forIn = _.forIn;\nexport const camelCase = _.camelCase;\nexport const uniqueId = _.uniqueId;\nexport const merge = function () {\n  if (_.mergeWith) {\n    var args = Array.from(arguments);\n    var last = args[args.length - 1];\n    var customizer = isFunction(last) ? last : noop;\n    args.push(function (a, b) {\n      var customResult = customizer(a, b);\n\n      if (customResult !== undefined) {\n        return customResult;\n      }\n\n      if (Array.isArray(a) && !Array.isArray(b)) {\n        return b;\n      }\n    });\n    return _.mergeWith.apply(this, args);\n  }\n\n  return _.merge.apply(this, arguments);\n};\nexport const isBoolean = function (value) {\n  var toString = Object.prototype.toString;\n  return value === true || value === false || !!value && typeof value === 'object' && toString.call(value) === '[object Boolean]';\n};\nexport const isObject = function (value) {\n  return !!value && (typeof value === 'object' || typeof value === 'function');\n};\nexport const isNumber = function (value) {\n  var toString = Object.prototype.toString;\n  return typeof value === 'number' || !!value && typeof value === 'object' && toString.call(value) === '[object Number]';\n};\nexport const isString = function (value) {\n  var toString = Object.prototype.toString;\n  return typeof value === 'string' || !!value && typeof value === 'object' && toString.call(value) === '[object String]';\n};\nexport const noop = function () {};","map":{"version":3,"names":["_","$","V","config","addClassNamePrefix","className","toString","split","map","_className","substr","classNamePrefix","length","join","removeClassNamePrefix","parseDOMJSON","json","namespace","selectors","groupSelectors","svgNamespace","svg","ns","fragment","document","createDocumentFragment","queue","pop","parentNode","siblingsDef","i","n","nodeDef","hasOwnProperty","Error","tagName","namespaceURI","node","createElementNS","wrapper","attributes","attr","style","css","baseVal","textContent","nodeSelector","selector","nodeGroups","groupSelector","Array","isArray","j","m","nodeGroup","group","push","appendChild","childrenDef","children","hashCode","str","hash","c","charCodeAt","getByPath","obj","path","delimiter","keys","key","Object","undefined","isGetSafe","String","setByPath","value","last","diver","unsetByPath","flattenObject","delim","stop","ret","shouldGoDeeper","flatObject","flatKey","uuid","replace","r","Math","random","v","guid","id","toKebabCase","string","toLowerCase","normalizeEvent","evt","normalizedEvent","touchEvt","originalEvent","changedTouches","property","target","useElement","correspondingUseElement","nextFrame","raf","window","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","lastTime","callback","currTime","Date","getTime","timeToCall","max","setTimeout","context","rest","bind","cancelFrame","caf","client","cancelAnimationFrame","webkitCancelAnimationFrame","webkitCancelRequestAnimationFrame","msCancelAnimationFrame","msCancelRequestAnimationFrame","oCancelAnimationFrame","oCancelRequestAnimationFrame","mozCancelAnimationFrame","mozCancelRequestAnimationFrame","clearTimeout","shapePerimeterConnectionPoint","linkView","view","magnet","reference","bbox","spot","scalable","rotatable","firstChild","findIntersection","paper","cells","getBBox","model","intersectionWithLineFromCenterToPoint","center","isPercentage","val","isString","slice","parseCssNumeric","restrictUnits","getUnit","validUnitExp","matches","RegExp","exec","number","parseFloat","Number","isNaN","output","unit","breakText","text","size","styles","opt","width","height","svgDocument","textSpan","textElement","append","textNode","createTextNode","opacity","display","body","separator","eol","hyphen","maxLineCount","isNumber","Infinity","words","full","lines","p","h","lineHeight","l","len","word","isEol","indexOf","eolWords","jl","splice","filter","data","getComputedTextLength","partition","substring","hyphenIndex","search","lastL","heightValue","floor","ellipsis","lastLine","k","lastLineWithOmission","lastChar","separatorChar","match","removeChild","sanitizeHTML","html","parseHTML","find","each","currentNode","currentAttribute","attrName","name","attrValue","startsWith","removeAttr","downloadBlob","blob","fileName","navigator","msSaveBlob","url","URL","createObjectURL","link","createElement","href","download","click","revokeObjectURL","downloadDataUri","dataUri","dataUriToBlob","decodeURIComponent","firstCommaIndex","dataTypeString","mimeString","decodedString","atob","unescape","encodeURIComponent","ia","Uint8Array","Blob","type","imageToDataUri","modernHandler","xhr","status","reader","FileReader","onload","result","onerror","readAsDataURL","response","legacyHandler","Uint8ToString","u8a","CHUNK_SZ","fromCharCode","apply","subarray","bytes","suffix","meta","b64encoded","btoa","XMLHttpRequest","open","addEventListener","responseType","send","getElementBBox","el","$el","element","doc","ownerDocument","clientBBox","getBoundingClientRect","strokeWidthX","strokeWidthY","ownerSVGElement","vel","x","left","pageXOffset","documentElement","offsetLeft","y","top","pageYOffset","offsetTop","sortElements","elements","comparator","$elements","placements","sortElement","nextSibling","insertBefore","prototype","sort","call","setAttributesBySelector","attrs","$element","forIn","addBack","has","addClass","omit","normalizeSides","box","isFinite","right","bottom","vertical","horizontal","timing","linear","t","quad","cubic","inout","t2","t3","exponential","pow","bounce","a","b","q","reverse","f","reflect","clamp","back","s","elastic","cos","PI","interpolate","d","object","hexColor","ca","parseInt","cb","ra","rd","ga","gd","ba","bd","g","ma","mb","u","toFixed","outline","args","tpl","margin","template","color","outerRadius","innerRadius","highlight","blur","stdDeviation","dropShadow","dx","dy","grayscale","amount","e","sepia","saturate","hueRotate","angle","invert","amount2","brightness","contrast","format","specifier","locale","currency","decimal","thousands","grouping","re","fill","align","sign","symbol","zfill","comma","precision","scale","prefix","integer","min","zcomma","negative","fullSuffix","convert","lastIndexOf","before","after","formatGroup","padding","formatString","fieldDelimiterIndex","fieldDelimiter","endPlaceholder","formattedStringArray","pieceFormattedString","formatSpec","fieldName","shift","toUpperCase","toPrecision","toExponential","round","ceil","log","LN10","prefixes","abs","regex","from","arguments","_attr","attrArray","toggleFullScreen","topDocument","prefixedResult","prop","propName","isFunction","mixin","assign","supplement","defaults","deepMixin","deepSupplement","defaultsDeep","invoke","invokeMap","sortedIndex","sortedIndexBy","uniq","uniqBy","clone","cloneDeep","isEmpty","isEqual","isPlainObject","toArray","debounce","groupBy","sortBy","flattenDeep","without","difference","intersection","union","pick","bindAll","camelCase","uniqueId","merge","mergeWith","customizer","noop","customResult","isBoolean","isObject"],"sources":["C:/Users/Admin/dataflow-test/node_modules/jointjs/src/util/util.mjs"],"sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport V from '../V/index.mjs';\nimport { config } from '../config/index.mjs';\n\nexport const addClassNamePrefix = function(className) {\n\n    if (!className) return className;\n\n    return className.toString().split(' ').map(function(_className) {\n\n        if (_className.substr(0, config.classNamePrefix.length) !== config.classNamePrefix) {\n            _className = config.classNamePrefix + _className;\n        }\n\n        return _className;\n\n    }).join(' ');\n};\n\nexport const removeClassNamePrefix = function(className) {\n\n    if (!className) return className;\n\n    return className.toString().split(' ').map(function(_className) {\n\n        if (_className.substr(0, config.classNamePrefix.length) === config.classNamePrefix) {\n            _className = _className.substr(config.classNamePrefix.length);\n        }\n\n        return _className;\n\n    }).join(' ');\n};\n\nexport const parseDOMJSON = function(json, namespace) {\n\n    var selectors = {};\n    var groupSelectors = {};\n    var svgNamespace = V.namespace.svg;\n\n    var ns = namespace || svgNamespace;\n    var fragment = document.createDocumentFragment();\n    var queue = [json, fragment, ns];\n    while (queue.length > 0) {\n        ns = queue.pop();\n        var parentNode = queue.pop();\n        var siblingsDef = queue.pop();\n        for (var i = 0, n = siblingsDef.length; i < n; i++) {\n            var nodeDef = siblingsDef[i];\n            // TagName\n            if (!nodeDef.hasOwnProperty('tagName')) throw new Error('json-dom-parser: missing tagName');\n            var tagName = nodeDef.tagName;\n            // Namespace URI\n            if (nodeDef.hasOwnProperty('namespaceURI')) ns = nodeDef.namespaceURI;\n            var node = document.createElementNS(ns, tagName);\n            var svg = (ns === svgNamespace);\n\n            var wrapper = (svg) ? V : $;\n            // Attributes\n            var attributes = nodeDef.attributes;\n            if (attributes) wrapper(node).attr(attributes);\n            // Style\n            var style = nodeDef.style;\n            if (style) $(node).css(style);\n            // ClassName\n            if (nodeDef.hasOwnProperty('className')) {\n                var className = nodeDef.className;\n                if (svg) {\n                    node.className.baseVal = className;\n                } else {\n                    node.className = className;\n                }\n            }\n            // TextContent\n            if (nodeDef.hasOwnProperty('textContent')) {\n                node.textContent = nodeDef.textContent;\n            }\n            // Selector\n            if (nodeDef.hasOwnProperty('selector')) {\n                var nodeSelector = nodeDef.selector;\n                if (selectors[nodeSelector]) throw new Error('json-dom-parser: selector must be unique');\n                selectors[nodeSelector] = node;\n                wrapper(node).attr('joint-selector', nodeSelector);\n            }\n            // Groups\n            if (nodeDef.hasOwnProperty('groupSelector')) {\n                var nodeGroups = nodeDef.groupSelector;\n                if (!Array.isArray(nodeGroups)) nodeGroups = [nodeGroups];\n                for (var j = 0, m = nodeGroups.length; j < m; j++) {\n                    var nodeGroup = nodeGroups[j];\n                    var group = groupSelectors[nodeGroup];\n                    if (!group) group = groupSelectors[nodeGroup] = [];\n                    group.push(node);\n                }\n            }\n            parentNode.appendChild(node);\n            // Children\n            var childrenDef = nodeDef.children;\n            if (Array.isArray(childrenDef)) queue.push(childrenDef, node, ns);\n        }\n    }\n    return {\n        fragment: fragment,\n        selectors: selectors,\n        groupSelectors: groupSelectors\n    };\n};\n\n// Return a simple hash code from a string. See http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/.\nexport const hashCode = function(str) {\n\n    let hash = 0;\n    if (str.length === 0) return hash;\n    for (let i = 0; i < str.length; i++) {\n        const c = str.charCodeAt(i);\n        hash = ((hash << 5) - hash) + c;\n        hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash;\n};\n\nexport const getByPath = function(obj, path, delimiter) {\n\n    var keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n    var key;\n    var i = 0;\n    var length = keys.length;\n    while (i < length) {\n        key = keys[i++];\n        if (Object(obj) === obj && key in obj) {\n            obj = obj[key];\n        } else {\n            return undefined;\n        }\n    }\n    return obj;\n};\n\nconst isGetSafe = function(obj, key) {\n    // Prevent prototype pollution\n    // https://snyk.io/vuln/SNYK-JS-JSON8MERGEPATCH-1038399\n    if (typeof key !== 'string' && typeof key !== 'number') {\n        key = String(key);\n    }\n    if (key === 'constructor' && typeof obj[key] === 'function') {\n        return false;\n    }\n    if (key === '__proto__') {\n        return false;\n    }\n    return true;\n};\n\nexport const setByPath = function(obj, path, value, delimiter) {\n\n    const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n    const last = keys.length - 1;\n    let diver = obj;\n    let i = 0;\n\n    for (; i < last; i++) {\n        const key = keys[i];\n        if (!isGetSafe(diver, key)) return obj;\n        const value = diver[key];\n        // diver creates an empty object if there is no nested object under such a key.\n        // This means that one can populate an empty nested object with setByPath().\n        diver = value || (diver[key] = {});\n    }\n\n    diver[keys[last]] = value;\n\n    return obj;\n};\n\nexport const unsetByPath = function(obj, path, delimiter) {\n\n    const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n    const last = keys.length - 1;\n    let diver = obj;\n    let i = 0;\n\n    for (; i < last; i++) {\n        const key = keys[i];\n        if (!isGetSafe(diver, key)) return obj;\n        const value = diver[key];\n        if (!value) return obj;\n        diver = value;\n    }\n\n    delete diver[keys[last]];\n\n    return obj;\n};\n\nexport const flattenObject = function(obj, delim, stop) {\n\n    delim = delim || '/';\n    var ret = {};\n\n    for (var key in obj) {\n\n        if (!obj.hasOwnProperty(key)) continue;\n\n        var shouldGoDeeper = typeof obj[key] === 'object';\n        if (shouldGoDeeper && stop && stop(obj[key])) {\n            shouldGoDeeper = false;\n        }\n\n        if (shouldGoDeeper) {\n\n            var flatObject = flattenObject(obj[key], delim, stop);\n\n            for (var flatKey in flatObject) {\n                if (!flatObject.hasOwnProperty(flatKey)) continue;\n                ret[key + delim + flatKey] = flatObject[flatKey];\n            }\n\n        } else {\n\n            ret[key] = obj[key];\n        }\n    }\n\n    return ret;\n};\n\nexport const uuid = function() {\n\n    // credit: http://stackoverflow.com/posts/2117523/revisions\n\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (Math.random() * 16) | 0;\n        var v = (c === 'x') ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n};\n\n// Generate global unique id for obj and store it as a property of the object.\nexport const guid = function(obj) {\n\n    guid.id = guid.id || 1;\n    obj.id = (obj.id === undefined ? 'j_' + guid.id++ : obj.id);\n    return obj.id;\n};\n\nexport const toKebabCase = function(string) {\n\n    return string.replace(/[A-Z]/g, '-$&').toLowerCase();\n};\n\nexport const normalizeEvent = function(evt) {\n\n    var normalizedEvent = evt;\n    var touchEvt = evt.originalEvent && evt.originalEvent.changedTouches && evt.originalEvent.changedTouches[0];\n    if (touchEvt) {\n        for (var property in evt) {\n            // copy all the properties from the input event that are not\n            // defined on the touch event (functions included).\n            if (touchEvt[property] === undefined) {\n                touchEvt[property] = evt[property];\n            }\n        }\n        normalizedEvent = touchEvt;\n    }\n\n    // IE: evt.target could be set to SVGElementInstance for SVGUseElement\n    var target = normalizedEvent.target;\n    if (target) {\n        var useElement = target.correspondingUseElement;\n        if (useElement) normalizedEvent.target = useElement;\n    }\n\n    return normalizedEvent;\n};\n\nexport const nextFrame = (function() {\n\n    var raf;\n\n    if (typeof window !== 'undefined') {\n\n        raf = window.requestAnimationFrame ||\n            window.webkitRequestAnimationFrame ||\n            window.mozRequestAnimationFrame ||\n            window.oRequestAnimationFrame ||\n            window.msRequestAnimationFrame;\n    }\n\n    if (!raf) {\n\n        var lastTime = 0;\n\n        raf = function(callback) {\n\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var id = setTimeout(function() {\n                callback(currTime + timeToCall);\n            }, timeToCall);\n\n            lastTime = currTime + timeToCall;\n\n            return id;\n        };\n    }\n\n    return function(callback, context, ...rest) {\n        return (context !== undefined)\n            ? raf(callback.bind(context, ...rest))\n            : raf(callback);\n    };\n\n})();\n\nexport const cancelFrame = (function() {\n\n    var caf;\n    var client = typeof window != 'undefined';\n\n    if (client) {\n\n        caf = window.cancelAnimationFrame ||\n            window.webkitCancelAnimationFrame ||\n            window.webkitCancelRequestAnimationFrame ||\n            window.msCancelAnimationFrame ||\n            window.msCancelRequestAnimationFrame ||\n            window.oCancelAnimationFrame ||\n            window.oCancelRequestAnimationFrame ||\n            window.mozCancelAnimationFrame ||\n            window.mozCancelRequestAnimationFrame;\n    }\n\n    caf = caf || clearTimeout;\n\n    return client ? caf.bind(window) : caf;\n\n})();\n\n/**\n * @deprecated\n */\nexport const shapePerimeterConnectionPoint = function(linkView, view, magnet, reference) {\n\n    var bbox;\n    var spot;\n\n    if (!magnet) {\n\n        // There is no magnet, try to make the best guess what is the\n        // wrapping SVG element. This is because we want this \"smart\"\n        // connection points to work out of the box without the\n        // programmer to put magnet marks to any of the subelements.\n        // For example, we want the function to work on basic.Path elements\n        // without any special treatment of such elements.\n        // The code below guesses the wrapping element based on\n        // one simple assumption. The wrapping elemnet is the\n        // first child of the scalable group if such a group exists\n        // or the first child of the rotatable group if not.\n        // This makese sense because usually the wrapping element\n        // is below any other sub element in the shapes.\n        var scalable = view.$('.scalable')[0];\n        var rotatable = view.$('.rotatable')[0];\n\n        if (scalable && scalable.firstChild) {\n\n            magnet = scalable.firstChild;\n\n        } else if (rotatable && rotatable.firstChild) {\n\n            magnet = rotatable.firstChild;\n        }\n    }\n\n    if (magnet) {\n\n        spot = V(magnet).findIntersection(reference, linkView.paper.cells);\n        if (!spot) {\n            bbox = V(magnet).getBBox({ target: linkView.paper.cells });\n        }\n\n    } else {\n\n        bbox = view.model.getBBox();\n        spot = bbox.intersectionWithLineFromCenterToPoint(reference);\n    }\n    return spot || bbox.center();\n};\n\nexport const isPercentage = function(val) {\n\n    return isString(val) && val.slice(-1) === '%';\n};\n\nexport const parseCssNumeric = function(val, restrictUnits) {\n\n    function getUnit(validUnitExp) {\n\n        // one or more numbers, followed by\n        // any number of (\n        //  `.`, followed by\n        //  one or more numbers\n        // ), followed by\n        // `validUnitExp`, followed by\n        // end of string\n        var matches = new RegExp('(?:\\\\d+(?:\\\\.\\\\d+)*)(' + validUnitExp + ')$').exec(val);\n\n        if (!matches) return null;\n        return matches[1];\n    }\n\n    var number = parseFloat(val);\n\n    // if `val` cannot be parsed as a number, return `null`\n    if (Number.isNaN(number)) return null;\n\n    // else: we know `output.value`\n    var output = {};\n    output.value = number;\n\n    // determine the unit\n    var validUnitExp;\n    if (restrictUnits == null) {\n        // no restriction\n        // accept any unit, as well as no unit\n        validUnitExp = '[A-Za-z]*';\n\n    } else if (Array.isArray(restrictUnits)) {\n        // if this is an empty array, top restriction - return `null`\n        if (restrictUnits.length === 0) return null;\n\n        // else: restriction - an array of valid unit strings\n        validUnitExp = restrictUnits.join('|');\n\n    } else if (isString(restrictUnits)) {\n        // restriction - a single valid unit string\n        validUnitExp = restrictUnits;\n    }\n    var unit = getUnit(validUnitExp);\n\n    // if we found no matches for `restrictUnits`, return `null`\n    if (unit === null) return null;\n\n    // else: we know the unit\n    output.unit = unit;\n    return output;\n};\n\nexport const breakText = function(text, size, styles = {}, opt = {}) {\n\n    var width = size.width;\n    var height = size.height;\n\n    var svgDocument = opt.svgDocument || V('svg').node;\n    var textSpan = V('tspan').node;\n    var textElement = V('text').attr(styles).append(textSpan).node;\n    var textNode = document.createTextNode('');\n\n    // Prevent flickering\n    textElement.style.opacity = 0;\n    // Prevent FF from throwing an uncaught exception when `getBBox()`\n    // called on element that is not in the render tree (is not measurable).\n    // <tspan>.getComputedTextLength() returns always 0 in this case.\n    // Note that the `textElement` resp. `textSpan` can become hidden\n    // when it's appended to the DOM and a `display: none` CSS stylesheet\n    // rule gets applied.\n    textElement.style.display = 'block';\n    textSpan.style.display = 'block';\n\n    textSpan.appendChild(textNode);\n    svgDocument.appendChild(textElement); // lgtm [js/xss-through-dom]\n\n    if (!opt.svgDocument) {\n\n        document.body.appendChild(svgDocument);\n    }\n\n    var separator = opt.separator || ' ';\n    var eol = opt.eol || '\\n';\n    var hyphen = opt.hyphen ? new RegExp(opt.hyphen) : /[^\\w\\d]/;\n    var maxLineCount = opt.maxLineCount;\n    if (!isNumber(maxLineCount)) maxLineCount = Infinity;\n\n    var words = text.split(separator);\n    var full = [];\n    var lines = [];\n    var p, h;\n    var lineHeight;\n\n    for (var i = 0, l = 0, len = words.length; i < len; i++) {\n\n        var word = words[i];\n\n        if (!word) continue;\n\n        var isEol = false;\n        if (eol && word.indexOf(eol) >= 0) {\n            // word contains end-of-line character\n            if (word.length > 1) {\n                // separate word and continue cycle\n                var eolWords = word.split(eol);\n                for (var j = 0, jl = eolWords.length - 1; j < jl; j++) {\n                    eolWords.splice(2 * j + 1, 0, eol);\n                }\n                words.splice(i, 1, ...eolWords.filter(word => word !== ''));\n                i--;\n                len = words.length;\n                continue;\n            } else {\n                // creates a new line\n                lines[++l] = '';\n                isEol = true;\n            }\n        }\n\n        if (!isEol) {\n            textNode.data = lines[l] ? lines[l] + ' ' + word : word;\n\n            if (textSpan.getComputedTextLength() <= width) {\n\n                // the current line fits\n                lines[l] = textNode.data;\n\n                if (p || h) {\n                // We were partitioning. Put rest of the word onto next line\n                    full[l++] = true;\n\n                    // cancel partitioning and splitting by hyphens\n                    p = 0;\n                    h = 0;\n                }\n\n            } else {\n\n                if (!lines[l] || p) {\n\n                    var partition = !!p;\n\n                    p = word.length - 1;\n\n                    if (partition || !p) {\n\n                        // word has only one character.\n                        if (!p) {\n\n                            if (!lines[l]) {\n\n                                // we won't fit this text within our rect\n                                lines = [];\n\n                                break;\n                            }\n\n                            // partitioning didn't help on the non-empty line\n                            // try again, but this time start with a new line\n\n                            // cancel partitions created\n                            words.splice(i, 2, word + words[i + 1]);\n\n                            // adjust word length\n                            len--;\n\n                            full[l++] = true;\n                            i--;\n\n                            continue;\n                        }\n\n                        // move last letter to the beginning of the next word\n                        words[i] = word.substring(0, p);\n                        words[i + 1] = word.substring(p) + (words[i + 1] === undefined ? '' : words[i + 1]);\n\n                    } else {\n\n                        if (h) {\n                        // cancel splitting and put the words together again\n                            words.splice(i, 2, words[i] + words[i + 1]);\n                            h = 0;\n                        } else {\n                            var hyphenIndex = word.search(hyphen);\n                            if (hyphenIndex > -1 && hyphenIndex !== word.length - 1 && hyphenIndex !== 0) {\n                                h = hyphenIndex + 1;\n                                p = 0;\n                            }\n\n                            // We initiate partitioning or splitting\n                            // split the long word into two words\n                            words.splice(i, 1, word.substring(0, h || p), word.substring(h|| p));\n                            // adjust words length\n                            len++;\n\n                        }\n\n                        if (l && !full[l - 1]) {\n                        // if the previous line is not full, try to fit max part of\n                        // the current word there\n                            l--;\n                        }\n                    }\n\n                    i--;\n\n                    continue;\n                }\n\n                l++;\n                i--;\n            }\n        }\n        var lastL = null;\n\n        if (lines.length > maxLineCount) {\n\n            lastL = maxLineCount - 1;\n\n        } else if (height !== undefined) {\n\n            // if size.height is defined we have to check whether the height of the entire\n            // text exceeds the rect height\n\n            if (lineHeight === undefined) {\n\n                var heightValue;\n\n                // use the same defaults as in V.prototype.text\n                if (styles.lineHeight === 'auto') {\n                    heightValue = { value: 1.5, unit: 'em' };\n                } else {\n                    heightValue = parseCssNumeric(styles.lineHeight, ['em']) || { value: 1, unit: 'em' };\n                }\n\n                lineHeight = heightValue.value;\n                if (heightValue.unit === 'em') {\n                    lineHeight *= textElement.getBBox().height;\n                }\n            }\n\n            if (lineHeight * lines.length > height) {\n\n                // remove overflowing lines\n                lastL = Math.floor(height / lineHeight) - 1;\n            }\n        }\n\n        if (lastL !== null) {\n\n            lines.splice(lastL + 1);\n\n            // add ellipsis\n            var ellipsis = opt.ellipsis;\n            if (!ellipsis || lastL < 0) break;\n            if (typeof ellipsis !== 'string') ellipsis = '\\u2026';\n\n            var lastLine = lines[lastL];\n            if (!lastLine && !isEol) break;\n            var k = lastLine.length;\n            var lastLineWithOmission, lastChar, separatorChar;\n            do {\n                lastChar = lastLine[k];\n                lastLineWithOmission = lastLine.substring(0, k);\n                if (!lastChar) {\n                    separatorChar = (typeof separator === 'string') ? separator : ' ';\n                    lastLineWithOmission += separatorChar;\n                } else if (lastChar.match(separator)) {\n                    lastLineWithOmission += lastChar;\n                }\n                lastLineWithOmission += ellipsis;\n                textNode.data = lastLineWithOmission;\n                if (textSpan.getComputedTextLength() <= width) {\n                    lines[lastL] = lastLineWithOmission;\n                    break;\n                }\n                k--;\n            } while (k >= 0);\n            break;\n        }\n    }\n\n    if (opt.svgDocument) {\n\n        // svg document was provided, remove the text element only\n        svgDocument.removeChild(textElement);\n\n    } else {\n\n        // clean svg document\n        document.body.removeChild(svgDocument);\n    }\n\n    return lines.join(eol);\n};\n\n// Sanitize HTML\n// Based on https://gist.github.com/ufologist/5a0da51b2b9ef1b861c30254172ac3c9\n// Parses a string into an array of DOM nodes.\n// Then outputs it back as a string.\nexport const sanitizeHTML = function(html) {\n\n    // Ignores tags that are invalid inside a <div> tag (e.g. <body>, <head>)\n\n    // If documentContext (second parameter) is not specified or given as `null` or `undefined`, a new document is used.\n    // Inline events will not execute when the HTML is parsed; this includes, for example, sending GET requests for images.\n\n    // If keepScripts (last parameter) is `false`, scripts are not executed.\n    var output = $($.parseHTML('<div>' + html + '</div>', null, false));\n\n    output.find('*').each(function() { // for all nodes\n        var currentNode = this;\n\n        $.each(currentNode.attributes, function() { // for all attributes in each node\n            var currentAttribute = this;\n\n            var attrName = currentAttribute.name;\n            var attrValue = currentAttribute.value;\n\n            // Remove attribute names that start with \"on\" (e.g. onload, onerror...).\n            // Remove attribute values that start with \"javascript:\" pseudo protocol (e.g. `href=\"javascript:alert(1)\"`).\n            if (attrName.startsWith('on') || attrValue.startsWith('javascript:') || attrValue.startsWith('data:') || attrValue.startsWith('vbscript:')) {\n                $(currentNode).removeAttr(attrName);\n            }\n        });\n    });\n\n    return output.html();\n};\n\n// Download `blob` as file with `fileName`.\n// Does not work in IE9.\nexport const downloadBlob = function(blob, fileName) {\n\n    if (window.navigator.msSaveBlob) { // requires IE 10+\n        // pulls up a save dialog\n        window.navigator.msSaveBlob(blob, fileName);\n\n    } else { // other browsers\n        // downloads directly in Chrome and Safari\n\n        // presents a save/open dialog in Firefox\n        // Firefox bug: `from` field in save dialog always shows `from:blob:`\n        // https://bugzilla.mozilla.org/show_bug.cgi?id=1053327\n\n        var url = window.URL.createObjectURL(blob);\n        var link = document.createElement('a');\n\n        link.href = url;\n        link.download = fileName;\n        document.body.appendChild(link);\n\n        link.click();\n\n        document.body.removeChild(link);\n        window.URL.revokeObjectURL(url); // mark the url for garbage collection\n    }\n};\n\n// Download `dataUri` as file with `fileName`.\n// Does not work in IE9.\nexport const downloadDataUri = function(dataUri, fileName) {\n\n    const blob = dataUriToBlob(dataUri);\n    downloadBlob(blob, fileName);\n};\n\n// Convert an uri-encoded data component (possibly also base64-encoded) to a blob.\nexport const dataUriToBlob = function(dataUri) {\n\n    // first, make sure there are no newlines in the data uri\n    dataUri = dataUri.replace(/\\s/g, '');\n    dataUri = decodeURIComponent(dataUri);\n\n    var firstCommaIndex = dataUri.indexOf(','); // split dataUri as `dataTypeString`,`data`\n\n    var dataTypeString = dataUri.slice(0, firstCommaIndex); // e.g. 'data:image/jpeg;base64'\n    var mimeString = dataTypeString.split(':')[1].split(';')[0]; // e.g. 'image/jpeg'\n\n    var data = dataUri.slice(firstCommaIndex + 1);\n    var decodedString;\n    if (dataTypeString.indexOf('base64') >= 0) { // data may be encoded in base64\n        decodedString = atob(data); // decode data\n    } else {\n        // convert the decoded string to UTF-8\n        decodedString = unescape(encodeURIComponent(data));\n    }\n    // write the bytes of the string to a typed array\n    var ia = new Uint8Array(decodedString.length);\n    for (var i = 0; i < decodedString.length; i++) {\n        ia[i] = decodedString.charCodeAt(i);\n    }\n\n    return new Blob([ia], { type: mimeString }); // return the typed array as Blob\n};\n\n// Read an image at `url` and return it as base64-encoded data uri.\n// The mime type of the image is inferred from the `url` file extension.\n// If data uri is provided as `url`, it is returned back unchanged.\n// `callback` is a method with `err` as first argument and `dataUri` as second argument.\n// Works with IE9.\nexport const imageToDataUri = function(url, callback) {\n\n    if (!url || url.substr(0, 'data:'.length) === 'data:') {\n        // No need to convert to data uri if it is already in data uri.\n\n        // This not only convenient but desired. For example,\n        // IE throws a security error if data:image/svg+xml is used to render\n        // an image to the canvas and an attempt is made to read out data uri.\n        // Now if our image is already in data uri, there is no need to render it to the canvas\n        // and so we can bypass this error.\n\n        // Keep the async nature of the function.\n        return setTimeout(function() {\n            callback(null, url);\n        }, 0);\n    }\n\n    // chrome, IE10+\n    var modernHandler = function(xhr, callback) {\n\n        if (xhr.status === 200) {\n\n            var reader = new FileReader();\n\n            reader.onload = function(evt) {\n                var dataUri = evt.target.result;\n                callback(null, dataUri);\n            };\n\n            reader.onerror = function() {\n                callback(new Error('Failed to load image ' + url));\n            };\n\n            reader.readAsDataURL(xhr.response);\n        } else {\n            callback(new Error('Failed to load image ' + url));\n        }\n    };\n\n    var legacyHandler = function(xhr, callback) {\n\n        var Uint8ToString = function(u8a) {\n            var CHUNK_SZ = 0x8000;\n            var c = [];\n            for (var i = 0; i < u8a.length; i += CHUNK_SZ) {\n                c.push(String.fromCharCode.apply(null, u8a.subarray(i, i + CHUNK_SZ)));\n            }\n            return c.join('');\n        };\n\n        if (xhr.status === 200) {\n\n            var bytes = new Uint8Array(xhr.response);\n\n            var suffix = (url.split('.').pop()) || 'png';\n            var map = {\n                'svg': 'svg+xml'\n            };\n            var meta = 'data:image/' + (map[suffix] || suffix) + ';base64,';\n            var b64encoded = meta + btoa(Uint8ToString(bytes));\n            callback(null, b64encoded);\n        } else {\n            callback(new Error('Failed to load image ' + url));\n        }\n    };\n\n    var xhr = new XMLHttpRequest();\n\n    xhr.open('GET', url, true);\n    xhr.addEventListener('error', function() {\n        callback(new Error('Failed to load image ' + url));\n    });\n\n    xhr.responseType = window.FileReader ? 'blob' : 'arraybuffer';\n\n    xhr.addEventListener('load', function() {\n        if (window.FileReader) {\n            modernHandler(xhr, callback);\n        } else {\n            legacyHandler(xhr, callback);\n        }\n    });\n\n    xhr.send();\n};\n\nexport const getElementBBox = function(el) {\n\n    var $el = $(el);\n    if ($el.length === 0) {\n        throw new Error('Element not found');\n    }\n\n    var element = $el[0];\n    var doc = element.ownerDocument;\n    var clientBBox = element.getBoundingClientRect();\n\n    var strokeWidthX = 0;\n    var strokeWidthY = 0;\n\n    // Firefox correction\n    if (element.ownerSVGElement) {\n\n        var vel = V(element);\n        var bbox = vel.getBBox({ target: vel.svg() });\n\n        // if FF getBoundingClientRect includes stroke-width, getBBox doesn't.\n        // To unify this across all browsers we need to adjust the final bBox with `stroke-width` value.\n        strokeWidthX = (clientBBox.width - bbox.width);\n        strokeWidthY = (clientBBox.height - bbox.height);\n    }\n\n    return {\n        x: clientBBox.left + window.pageXOffset - doc.documentElement.offsetLeft + strokeWidthX / 2,\n        y: clientBBox.top + window.pageYOffset - doc.documentElement.offsetTop + strokeWidthY / 2,\n        width: clientBBox.width - strokeWidthX,\n        height: clientBBox.height - strokeWidthY\n    };\n};\n\n\n// Highly inspired by the jquery.sortElements plugin by Padolsey.\n// See http://james.padolsey.com/javascript/sorting-elements-with-jquery/.\nexport const sortElements = function(elements, comparator) {\n\n    var $elements = $(elements);\n    var placements = $elements.map(function() {\n\n        var sortElement = this;\n        var parentNode = sortElement.parentNode;\n        // Since the element itself will change position, we have\n        // to have some way of storing it's original position in\n        // the DOM. The easiest way is to have a 'flag' node:\n        var nextSibling = parentNode.insertBefore(document.createTextNode(''), sortElement.nextSibling);\n\n        return function() {\n\n            if (parentNode === this) {\n                throw new Error('You can\\'t sort elements if any one is a descendant of another.');\n            }\n\n            // Insert before flag:\n            parentNode.insertBefore(this, nextSibling);\n            // Remove flag:\n            parentNode.removeChild(nextSibling);\n        };\n    });\n\n    return Array.prototype.sort.call($elements, comparator).each(function(i) {\n        placements[i].call(this);\n    });\n};\n\n// Sets attributes on the given element and its descendants based on the selector.\n// `attrs` object: { [SELECTOR1]: { attrs1 }, [SELECTOR2]: { attrs2}, ... } e.g. { 'input': { color : 'red' }}\nexport const setAttributesBySelector = function(element, attrs) {\n\n    var $element = $(element);\n\n    forIn(attrs, function(attrs, selector) {\n        var $elements = $element.find(selector).addBack().filter(selector);\n        // Make a special case for setting classes.\n        // We do not want to overwrite any existing class.\n        if (has(attrs, 'class')) {\n            $elements.addClass(attrs['class']);\n            attrs = omit(attrs, 'class');\n        }\n        $elements.attr(attrs);\n    });\n};\n\n// Return a new object with all four sides (top, right, bottom, left) in it.\n// Value of each side is taken from the given argument (either number or object).\n// Default value for a side is 0.\n// Examples:\n// normalizeSides(5) --> { top: 5, right: 5, bottom: 5, left: 5 }\n// normalizeSides({ horizontal: 5 }) --> { top: 0, right: 5, bottom: 0, left: 5 }\n// normalizeSides({ left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 10, left: 5 }) --> { top: 0, right: 10, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 0, left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\nexport const normalizeSides = function(box) {\n\n    if (Object(box) !== box) { // `box` is not an object\n        var val = 0; // `val` left as 0 if `box` cannot be understood as finite number\n        if (isFinite(box)) val = +box; // actually also accepts string numbers (e.g. '100')\n\n        return { top: val, right: val, bottom: val, left: val };\n    }\n\n    // `box` is an object\n    var top, right, bottom, left;\n    top = right = bottom = left = 0;\n\n    if (isFinite(box.vertical)) top = bottom = +box.vertical;\n    if (isFinite(box.horizontal)) right = left = +box.horizontal;\n\n    if (isFinite(box.top)) top = +box.top; // overwrite vertical\n    if (isFinite(box.right)) right = +box.right; // overwrite horizontal\n    if (isFinite(box.bottom)) bottom = +box.bottom; // overwrite vertical\n    if (isFinite(box.left)) left = +box.left; // overwrite horizontal\n\n    return { top: top, right: right, bottom: bottom, left: left };\n};\n\nexport const timing = {\n\n    linear: function(t) {\n        return t;\n    },\n\n    quad: function(t) {\n        return t * t;\n    },\n\n    cubic: function(t) {\n        return t * t * t;\n    },\n\n    inout: function(t) {\n        if (t <= 0) return 0;\n        if (t >= 1) return 1;\n        var t2 = t * t;\n        var t3 = t2 * t;\n        return 4 * (t < .5 ? t3 : 3 * (t - t2) + t3 - .75);\n    },\n\n    exponential: function(t) {\n        return Math.pow(2, 10 * (t - 1));\n    },\n\n    bounce: function(t) {\n        for (var a = 0, b = 1; 1; a += b, b /= 2) {\n            if (t >= (7 - 4 * a) / 11) {\n                var q = (11 - 6 * a - 11 * t) / 4;\n                return -q * q + b * b;\n            }\n        }\n    },\n\n    reverse: function(f) {\n        return function(t) {\n            return 1 - f(1 - t);\n        };\n    },\n\n    reflect: function(f) {\n        return function(t) {\n            return .5 * (t < .5 ? f(2 * t) : (2 - f(2 - 2 * t)));\n        };\n    },\n\n    clamp: function(f, n, x) {\n        n = n || 0;\n        x = x || 1;\n        return function(t) {\n            var r = f(t);\n            return r < n ? n : r > x ? x : r;\n        };\n    },\n\n    back: function(s) {\n        if (!s) s = 1.70158;\n        return function(t) {\n            return t * t * ((s + 1) * t - s);\n        };\n    },\n\n    elastic: function(x) {\n        if (!x) x = 1.5;\n        return function(t) {\n            return Math.pow(2, 10 * (t - 1)) * Math.cos(20 * Math.PI * x / 3 * t);\n        };\n    }\n};\n\nexport const interpolate = {\n\n    number: function(a, b) {\n        var d = b - a;\n        return function(t) {\n            return a + d * t;\n        };\n    },\n\n    object: function(a, b) {\n        var s = Object.keys(a);\n        return function(t) {\n            var i, p;\n            var r = {};\n            for (i = s.length - 1; i != -1; i--) {\n                p = s[i];\n                r[p] = a[p] + (b[p] - a[p]) * t;\n            }\n            return r;\n        };\n    },\n\n    hexColor: function(a, b) {\n\n        var ca = parseInt(a.slice(1), 16);\n        var cb = parseInt(b.slice(1), 16);\n        var ra = ca & 0x0000ff;\n        var rd = (cb & 0x0000ff) - ra;\n        var ga = ca & 0x00ff00;\n        var gd = (cb & 0x00ff00) - ga;\n        var ba = ca & 0xff0000;\n        var bd = (cb & 0xff0000) - ba;\n\n        return function(t) {\n\n            var r = (ra + rd * t) & 0x000000ff;\n            var g = (ga + gd * t) & 0x0000ff00;\n            var b = (ba + bd * t) & 0x00ff0000;\n\n            return '#' + (1 << 24 | r | g | b).toString(16).slice(1);\n        };\n    },\n\n    unit: function(a, b) {\n\n        var r = /(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;\n        var ma = r.exec(a);\n        var mb = r.exec(b);\n        var p = mb[1].indexOf('.');\n        var f = p > 0 ? mb[1].length - p - 1 : 0;\n        a = +ma[1];\n        var d = +mb[1] - a;\n        var u = ma[2];\n\n        return function(t) {\n            return (a + d * t).toFixed(f) + u;\n        };\n    }\n};\n\n// SVG filters.\n// (values in parentheses are default values)\nexport const filter = {\n\n    // `color` ... outline color ('blue')\n    // `width`... outline width (1)\n    // `opacity` ... outline opacity (1)\n    // `margin` ... gap between outline and the element (2)\n    outline: function(args) {\n\n        var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology in=\"SourceAlpha\" result=\"morphedOuter\" operator=\"dilate\" radius=\"${outerRadius}\" /><feMorphology in=\"SourceAlpha\" result=\"morphedInner\" operator=\"dilate\" radius=\"${innerRadius}\" /><feComposite result=\"morphedOuterColored\" in=\"colored\" in2=\"morphedOuter\" operator=\"in\"/><feComposite operator=\"xor\" in=\"morphedOuterColored\" in2=\"morphedInner\" result=\"outline\"/><feMerge><feMergeNode in=\"outline\"/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n\n        var margin = Number.isFinite(args.margin) ? args.margin : 2;\n        var width = Number.isFinite(args.width) ? args.width : 1;\n\n        return template(tpl)({\n            color: args.color || 'blue',\n            opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n            outerRadius: margin + width,\n            innerRadius: margin\n        });\n    },\n\n    // `color` ... color ('red')\n    // `width`... width (1)\n    // `blur` ... blur (0)\n    // `opacity` ... opacity (1)\n    highlight: function(args) {\n\n        var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology result=\"morphed\" in=\"SourceGraphic\" operator=\"dilate\" radius=\"${width}\"/><feComposite result=\"composed\" in=\"colored\" in2=\"morphed\" operator=\"in\"/><feGaussianBlur result=\"blured\" in=\"composed\" stdDeviation=\"${blur}\"/><feBlend in=\"SourceGraphic\" in2=\"blured\" mode=\"normal\"/></filter>';\n\n        return template(tpl)({\n            color: args.color || 'red',\n            width: Number.isFinite(args.width) ? args.width : 1,\n            blur: Number.isFinite(args.blur) ? args.blur : 0,\n            opacity: Number.isFinite(args.opacity) ? args.opacity : 1\n        });\n    },\n\n    // `x` ... horizontal blur (2)\n    // `y` ... vertical blur (optional)\n    blur: function(args) {\n\n        var x = Number.isFinite(args.x) ? args.x : 2;\n\n        return template('<filter><feGaussianBlur stdDeviation=\"${stdDeviation}\"/></filter>')({\n            stdDeviation: Number.isFinite(args.y) ? [x, args.y] : x\n        });\n    },\n\n    // `dx` ... horizontal shift (0)\n    // `dy` ... vertical shift (0)\n    // `blur` ... blur (4)\n    // `color` ... color ('black')\n    // `opacity` ... opacity (1)\n    dropShadow: function(args) {\n\n        var tpl = 'SVGFEDropShadowElement' in window\n            ? '<filter><feDropShadow stdDeviation=\"${blur}\" dx=\"${dx}\" dy=\"${dy}\" flood-color=\"${color}\" flood-opacity=\"${opacity}\"/></filter>'\n            : '<filter><feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"${blur}\"/><feOffset dx=\"${dx}\" dy=\"${dy}\" result=\"offsetblur\"/><feFlood flood-color=\"${color}\"/><feComposite in2=\"offsetblur\" operator=\"in\"/><feComponentTransfer><feFuncA type=\"linear\" slope=\"${opacity}\"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n\n        return template(tpl)({\n            dx: args.dx || 0,\n            dy: args.dy || 0,\n            opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n            color: args.color || 'black',\n            blur: Number.isFinite(args.blur) ? args.blur : 4\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely grayscale. A value of 0 leaves the input unchanged.\n    grayscale: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0\"/></filter>')({\n            a: 0.2126 + 0.7874 * (1 - amount),\n            b: 0.7152 - 0.7152 * (1 - amount),\n            c: 0.0722 - 0.0722 * (1 - amount),\n            d: 0.2126 - 0.2126 * (1 - amount),\n            e: 0.7152 + 0.2848 * (1 - amount),\n            f: 0.0722 - 0.0722 * (1 - amount),\n            g: 0.2126 - 0.2126 * (1 - amount),\n            h: 0.0722 + 0.9278 * (1 - amount)\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely sepia. A value of 0 leaves the input unchanged.\n    sepia: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0\"/></filter>')({\n            a: 0.393 + 0.607 * (1 - amount),\n            b: 0.769 - 0.769 * (1 - amount),\n            c: 0.189 - 0.189 * (1 - amount),\n            d: 0.349 - 0.349 * (1 - amount),\n            e: 0.686 + 0.314 * (1 - amount),\n            f: 0.168 - 0.168 * (1 - amount),\n            g: 0.272 - 0.272 * (1 - amount),\n            h: 0.534 - 0.534 * (1 - amount),\n            i: 0.131 + 0.869 * (1 - amount)\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 0 is completely un-saturated. A value of 1 (default) leaves the input unchanged.\n    saturate: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feColorMatrix type=\"saturate\" values=\"${amount}\"/></filter>')({\n            amount: 1 - amount\n        });\n    },\n\n    // `angle` ...  the number of degrees around the color circle the input samples will be adjusted (0).\n    hueRotate: function(args) {\n\n        return template('<filter><feColorMatrix type=\"hueRotate\" values=\"${angle}\"/></filter>')({\n            angle: args.angle || 0\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely inverted. A value of 0 leaves the input unchanged.\n    invert: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feComponentTransfer><feFuncR type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncG type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncB type=\"table\" tableValues=\"${amount} ${amount2}\"/></feComponentTransfer></filter>')({\n            amount: amount,\n            amount2: 1 - amount\n        });\n    },\n\n    // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n    brightness: function(args) {\n\n        return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\"/><feFuncG type=\"linear\" slope=\"${amount}\"/><feFuncB type=\"linear\" slope=\"${amount}\"/></feComponentTransfer></filter>')({\n            amount: Number.isFinite(args.amount) ? args.amount : 1\n        });\n    },\n\n    // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n    contrast: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncG type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncB type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/></feComponentTransfer></filter>')({\n            amount: amount,\n            amount2: .5 - amount / 2\n        });\n    }\n};\n\nexport const format = {\n\n    // Formatting numbers via the Python Format Specification Mini-language.\n    // See http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n    // Heavilly inspired by the D3.js library implementation.\n    number: function(specifier, value, locale) {\n\n        locale = locale || {\n\n            currency: ['$', ''],\n            decimal: '.',\n            thousands: ',',\n            grouping: [3]\n        };\n\n        // See Python format specification mini-language: http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n        // [[fill]align][sign][symbol][0][width][,][.precision][type]\n        var re = /(?:([^{])?([<>=^]))?([+\\- ])?([$#])?(0)?(\\d+)?(,)?(\\.-?\\d+)?([a-z%])?/i;\n\n        var match = re.exec(specifier);\n        var fill = match[1] || ' ';\n        var align = match[2] || '>';\n        var sign = match[3] || '';\n        var symbol = match[4] || '';\n        var zfill = match[5];\n        var width = +match[6];\n        var comma = match[7];\n        var precision = match[8];\n        var type = match[9];\n        var scale = 1;\n        var prefix = '';\n        var suffix = '';\n        var integer = false;\n\n        if (precision) precision = +precision.substring(1);\n\n        if (zfill || fill === '0' && align === '=') {\n            zfill = fill = '0';\n            align = '=';\n            if (comma) width -= Math.floor((width - 1) / 4);\n        }\n\n        switch (type) {\n            case 'n':\n                comma = true;\n                type = 'g';\n                break;\n            case '%':\n                scale = 100;\n                suffix = '%';\n                type = 'f';\n                break;\n            case 'p':\n                scale = 100;\n                suffix = '%';\n                type = 'r';\n                break;\n            case 'b':\n            case 'o':\n            case 'x':\n            case 'X':\n                if (symbol === '#') prefix = '0' + type.toLowerCase();\n                break;\n            case 'c':\n            case 'd':\n                integer = true;\n                precision = 0;\n                break;\n            case 's':\n                scale = -1;\n                type = 'r';\n                break;\n        }\n\n        if (symbol === '$') {\n            prefix = locale.currency[0];\n            suffix = locale.currency[1];\n        }\n\n        // If no precision is specified for `'r'`, fallback to general notation.\n        if (type == 'r' && !precision) type = 'g';\n\n        // Ensure that the requested precision is in the supported range.\n        if (precision != null) {\n            if (type == 'g') precision = Math.max(1, Math.min(21, precision));\n            else if (type == 'e' || type == 'f') precision = Math.max(0, Math.min(20, precision));\n        }\n\n        var zcomma = zfill && comma;\n\n        // Return the empty string for floats formatted as ints.\n        if (integer && (value % 1)) return '';\n\n        // Convert negative to positive, and record the sign prefix.\n        var negative = value < 0 || value === 0 && 1 / value < 0 ? (value = -value, '-') : sign;\n\n        var fullSuffix = suffix;\n\n        // Apply the scale, computing it from the value's exponent for si format.\n        // Preserve the existing suffix, if any, such as the currency symbol.\n        if (scale < 0) {\n            var unit = this.prefix(value, precision);\n            value = unit.scale(value);\n            fullSuffix = unit.symbol + suffix;\n        } else {\n            value *= scale;\n        }\n\n        // Convert to the desired precision.\n        value = this.convert(type, value, precision);\n\n        // Break the value into the integer part (before) and decimal part (after).\n        var i = value.lastIndexOf('.');\n        var before = i < 0 ? value : value.substring(0, i);\n        var after = i < 0 ? '' : locale.decimal + value.substring(i + 1);\n\n        function formatGroup(value) {\n\n            var i = value.length;\n            var t = [];\n            var j = 0;\n            var g = locale.grouping[0];\n            while (i > 0 && g > 0) {\n                t.push(value.substring(i -= g, i + g));\n                g = locale.grouping[j = (j + 1) % locale.grouping.length];\n            }\n            return t.reverse().join(locale.thousands);\n        }\n\n        // If the fill character is not `'0'`, grouping is applied before padding.\n        if (!zfill && comma && locale.grouping) {\n\n            before = formatGroup(before);\n        }\n\n        var length = prefix.length + before.length + after.length + (zcomma ? 0 : negative.length);\n        var padding = length < width ? new Array(length = width - length + 1).join(fill) : '';\n\n        // If the fill character is `'0'`, grouping is applied after padding.\n        if (zcomma) before = formatGroup(padding + before);\n\n        // Apply prefix.\n        negative += prefix;\n\n        // Rejoin integer and decimal parts.\n        value = before + after;\n\n        return (align === '<' ? negative + value + padding\n            : align === '>' ? padding + negative + value\n                : align === '^' ? padding.substring(0, length >>= 1) + negative + value + padding.substring(length)\n                    : negative + (zcomma ? value : padding + value)) + fullSuffix;\n    },\n\n    // Formatting string via the Python Format string.\n    // See https://docs.python.org/2/library/string.html#format-string-syntax)\n    string: function(formatString, value) {\n\n        var fieldDelimiterIndex;\n        var fieldDelimiter = '{';\n        var endPlaceholder = false;\n        var formattedStringArray = [];\n\n        while ((fieldDelimiterIndex = formatString.indexOf(fieldDelimiter)) !== -1) {\n\n            var pieceFormattedString, formatSpec, fieldName;\n\n            pieceFormattedString = formatString.slice(0, fieldDelimiterIndex);\n\n            if (endPlaceholder) {\n                formatSpec = pieceFormattedString.split(':');\n                fieldName = formatSpec.shift().split('.');\n                pieceFormattedString = value;\n\n                for (var i = 0; i < fieldName.length; i++)\n                    pieceFormattedString = pieceFormattedString[fieldName[i]];\n\n                if (formatSpec.length)\n                    pieceFormattedString = this.number(formatSpec, pieceFormattedString);\n            }\n\n            formattedStringArray.push(pieceFormattedString);\n\n            formatString = formatString.slice(fieldDelimiterIndex + 1);\n            endPlaceholder = !endPlaceholder;\n            fieldDelimiter = (endPlaceholder) ? '}' : '{';\n        }\n        formattedStringArray.push(formatString);\n\n        return formattedStringArray.join('');\n    },\n\n    convert: function(type, value, precision) {\n\n        switch (type) {\n            case 'b':\n                return value.toString(2);\n            case 'c':\n                return String.fromCharCode(value);\n            case 'o':\n                return value.toString(8);\n            case 'x':\n                return value.toString(16);\n            case 'X':\n                return value.toString(16).toUpperCase();\n            case 'g':\n                return value.toPrecision(precision);\n            case 'e':\n                return value.toExponential(precision);\n            case 'f':\n                return value.toFixed(precision);\n            case 'r':\n                return (value = this.round(value, this.precision(value, precision))).toFixed(Math.max(0, Math.min(20, this.precision(value * (1 + 1e-15), precision))));\n            default:\n                return value + '';\n        }\n    },\n\n    round: function(value, precision) {\n\n        return precision\n            ? Math.round(value * (precision = Math.pow(10, precision))) / precision\n            : Math.round(value);\n    },\n\n    precision: function(value, precision) {\n\n        return precision - (value ? Math.ceil(Math.log(value) / Math.LN10) : 1);\n    },\n\n    prefix: function(value, precision) {\n\n        var prefixes = ['y', 'z', 'a', 'f', 'p', 'n', 'Âµ', 'm', '', 'k', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y'].map(function(d, i) {\n            var k = Math.pow(10, Math.abs(8 - i) * 3);\n            return {\n                scale: i > 8 ? function(d) {\n                    return d / k;\n                } : function(d) {\n                    return d * k;\n                },\n                symbol: d\n            };\n        });\n\n        var i = 0;\n        if (value) {\n            if (value < 0) value *= -1;\n            if (precision) value = this.round(value, this.precision(value, precision));\n            i = 1 + Math.floor(1e-12 + Math.log(value) / Math.LN10);\n            i = Math.max(-24, Math.min(24, Math.floor((i <= 0 ? i + 1 : i - 1) / 3) * 3));\n        }\n        return prefixes[8 + i / 3];\n    }\n};\n\n/*\n    Pre-compile the HTML to be used as a template.\n*/\nexport const template = function(html) {\n\n    /*\n        Must support the variation in templating syntax found here:\n        https://lodash.com/docs#template\n    */\n    var regex = /<%= ([^ ]+) %>|\\$\\{ ?([^{} ]+) ?\\}|\\{\\{([^{} ]+)\\}\\}/g;\n\n    return function(data) {\n\n        data = data || {};\n\n        return html.replace(regex, function(match) {\n\n            var args = Array.from(arguments);\n            var attr = args.slice(1, 4).find(function(_attr) {\n                return !!_attr;\n            });\n\n            var attrArray = attr.split('.');\n            var value = data[attrArray.shift()];\n\n            while (value !== undefined && attrArray.length) {\n                value = value[attrArray.shift()];\n            }\n\n            return value !== undefined ? value : '';\n        });\n    };\n};\n\n/**\n * @param {Element} el Element, which content is intent to display in full-screen mode, 'window.top.document.body' is default.\n */\nexport const toggleFullScreen = function(el) {\n\n    var topDocument = window.top.document;\n    el = el || topDocument.body;\n\n    function prefixedResult(el, prop) {\n\n        var prefixes = ['webkit', 'moz', 'ms', 'o', ''];\n        for (var i = 0; i < prefixes.length; i++) {\n            var prefix = prefixes[i];\n            var propName = prefix ? (prefix + prop) : (prop.substr(0, 1).toLowerCase() + prop.substr(1));\n            if (el[propName] !== undefined) {\n                return isFunction(el[propName]) ? el[propName]() : el[propName];\n            }\n        }\n    }\n\n    if (prefixedResult(topDocument, 'FullscreenElement') || prefixedResult(topDocument, 'FullScreenElement')) {\n        prefixedResult(topDocument, 'ExitFullscreen') || // Spec.\n        prefixedResult(topDocument, 'CancelFullScreen'); // Firefox\n    } else {\n        prefixedResult(el, 'RequestFullscreen') || // Spec.\n        prefixedResult(el, 'RequestFullScreen'); // Firefox\n    }\n};\n\n// Deprecated\n// Copy all the properties to the first argument from the following arguments.\n// All the properties will be overwritten by the properties from the following\n// arguments. Inherited properties are ignored.\nexport const mixin = _.assign;\n\n// Deprecated\n// Copy all properties to the first argument from the following\n// arguments only in case if they don't exists in the first argument.\n// All the function propererties in the first argument will get\n// additional property base pointing to the extenders same named\n// property function's call method.\nexport const supplement = _.defaults;\n\n// Same as `mixin()` but deep version.\nexport const deepMixin = mixin;\n\n// Deprecated\n// Same as `supplement()` but deep version.\nexport const deepSupplement = _.defaultsDeep;\n\n// Replacements for deprecated functions\nexport const assign = _.assign;\nexport const defaults = _.defaults;\n// no better-named replacement for `deepMixin`\nexport const defaultsDeep = _.defaultsDeep;\n\n// Lodash 3 vs 4 incompatible\nexport const invoke = _.invokeMap || _.invoke;\nexport const sortedIndex = _.sortedIndexBy || _.sortedIndex;\nexport const uniq = _.uniqBy || _.uniq;\n\nexport const clone = _.clone;\nexport const cloneDeep = _.cloneDeep;\nexport const isEmpty = _.isEmpty;\nexport const isEqual = _.isEqual;\nexport const isFunction = _.isFunction;\nexport const isPlainObject = _.isPlainObject;\nexport const toArray = _.toArray;\nexport const debounce = _.debounce;\nexport const groupBy = _.groupBy;\nexport const sortBy = _.sortBy;\nexport const flattenDeep = _.flattenDeep;\nexport const without = _.without;\nexport const difference = _.difference;\nexport const intersection = _.intersection;\nexport const union = _.union;\nexport const has = _.has;\nexport const result = _.result;\nexport const omit = _.omit;\nexport const pick = _.pick;\nexport const bindAll = _.bindAll;\nexport const forIn = _.forIn;\nexport const camelCase = _.camelCase;\nexport const uniqueId = _.uniqueId;\n\nexport const merge = function() {\n    if (_.mergeWith) {\n        var args = Array.from(arguments);\n        var last = args[args.length - 1];\n\n        var customizer = isFunction(last) ? last : noop;\n        args.push(function(a, b) {\n            var customResult = customizer(a, b);\n            if (customResult !== undefined) {\n                return customResult;\n            }\n\n            if (Array.isArray(a) && !Array.isArray(b)) {\n                return b;\n            }\n        });\n\n        return _.mergeWith.apply(this, args);\n    }\n    return _.merge.apply(this, arguments);\n};\n\nexport const isBoolean = function(value) {\n    var toString = Object.prototype.toString;\n    return value === true || value === false || (!!value && typeof value === 'object' && toString.call(value) === '[object Boolean]');\n};\n\nexport const isObject = function(value) {\n    return !!value && (typeof value === 'object' || typeof value === 'function');\n};\n\nexport const isNumber = function(value) {\n    var toString = Object.prototype.toString;\n    return typeof value === 'number' || (!!value && typeof value === 'object' && toString.call(value) === '[object Number]');\n};\n\nexport const isString = function(value) {\n    var toString = Object.prototype.toString;\n    return typeof value === 'string' || (!!value && typeof value === 'object' && toString.call(value) === '[object String]');\n};\n\nexport const noop = function() {\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}