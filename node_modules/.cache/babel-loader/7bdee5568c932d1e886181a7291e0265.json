{"ast":null,"code":"const joint = require('jointjs');\n\nwindow.$ = require('jquery'); // import { Options, Vue } from 'vue-class-component';\n\nexport default {\n  mounted() {\n    var highlighters = joint.highlighters;\n    var mask = joint.highlighters.mask;\n    let selectionNode = null;\n    let selectedElement = null;\n    let selectedLink = null; //check ctrl shift\n\n    var ctrlDown = false;\n    var shiftDown = false;\n    const color = \"rgb(255 136 0)\";\n    var customEl = joint.dia.Element.define('standard.Rectangle', {\n      z: 1,\n      size: {\n        width: 44,\n        height: 35\n      },\n      removable: false,\n      attrs: {\n        image: {\n          x: 5,\n          y: 5,\n          width: 'calc(w-10)',\n          height: 'calc(h-10 )'\n        },\n        root: {\n          magnet: false\n        },\n        body: {\n          fill: '#FFFFFF',\n          stroke: '#A0A0A0',\n          width: 'calc(w)',\n          height: 'calc(h)',\n          strokeWidth: 2,\n          rx: 5,\n          ry: 5\n        }\n      },\n      ports: {\n        items: [{\n          id: 'out-port',\n          group: 'out'\n        }, {\n          id: 'in-port',\n          group: 'in'\n        }],\n        groups: {\n          out: {\n            markup: [{\n              tagName: 'circle',\n              selector: 'portBody'\n            }],\n            position: {\n              name: 'right'\n            },\n            attrs: {\n              portBody: {\n                r: 5,\n                magnet: 'active',\n                fill: '#187BD3',\n                stroke: '#187BD3'\n              }\n            }\n          },\n          in: {\n            markup: [{\n              tagName: 'circle',\n              selector: 'portBody'\n            }],\n            position: {\n              name: 'left'\n            },\n            attrs: {\n              portBody: {\n                r: 5,\n                magnet: 'passive',\n                fill: '#FFFFFF',\n                stroke: '#187BD3'\n              }\n            }\n          }\n        }\n      },\n      markup: [{\n        tagName: 'rect',\n        selector: 'body'\n      }, {\n        tagName: 'image',\n        selector: 'image'\n      }, {\n        tagName: 'ports',\n        selector: 'ports'\n      }]\n    });\n    var customElNoInPorts = joint.dia.Element.define('standard.Rectangle', {\n      z: 1,\n      theme: 'material',\n      size: {\n        width: 44,\n        height: 35\n      },\n      removable: false,\n      attrs: {\n        image: {\n          x: 5,\n          y: 5,\n          width: 'calc(w-10)',\n          height: 'calc(h-10 )'\n        },\n        root: {\n          magnet: false\n        },\n        body: {\n          fill: '#FFFFFF',\n          stroke: '#A0A0A0',\n          width: 'calc(w)',\n          height: 'calc(h)',\n          strokeWidth: 2\n        },\n        line: {\n          connection: true,\n          stroke: '#333333',\n          strokeWidth: 2,\n          strokeLinejoin: 'round',\n          targetMarker: {\n            'type': 'path',\n            'd': 'M 10 -5 0 0 10 5 z'\n          }\n        }\n      },\n      ports: {\n        items: [{\n          id: 'out-port',\n          group: 'out'\n        }],\n        groups: {\n          out: {\n            markup: [{\n              tagName: 'circle',\n              selector: 'portBody'\n            }],\n            position: {\n              name: 'right'\n            },\n            attrs: {\n              portBody: {\n                r: 5,\n                magnet: 'active',\n                fill: '#187BD3',\n                stroke: '#187BD3'\n              }\n            }\n          }\n        }\n      },\n      markup: [{\n        tagName: 'rect',\n        selector: 'body'\n      }, {\n        tagName: 'image',\n        selector: 'image'\n      }, {\n        tagName: 'ports',\n        selector: 'ports'\n      }]\n    }); //create link tool\n    //     var verticesTool = new joint.linkTools.Vertices();\n    // var segmentsTool = new joint.linkTools.Segments();\n    // var sourceArrowheadTool = new joint.linkTools.SourceArrowhead();\n\n    var targetArrowheadTool = new joint.linkTools.TargetArrowhead(); // var sourceAnchorTool = new joint.linkTools.SourceAnchor();\n    // var targetAnchorTool = new joint.linkTools.TargetAnchor();\n    // var boundaryTool = new joint.linkTools.Boundary();\n    // var removeButton = new joint.linkTools.Remove();\n    // var toolsView = new joint.dia.ToolsView({\n    //     tools: [\n    //         // verticesTool, segmentsTool,\n    //         // sourceArrowheadTool, \n    //         targetArrowheadTool,\n    //         // sourceAnchorTool, targetAnchorTool,\n    //         // boundaryTool, removeButton\n    //     ]\n    // });\n    // 2) creating a tools view\n    // var linkView = link.findView(paper);\n    // linkView.addTools(toolsView);\n    //custom link \n    // \n    // Paper & Graph\n\n    var graph = new joint.dia.Graph(); //ctrl+z\n\n    var commandManager = new joint.dia.CommandManager({\n      graph: graph\n    }); //cấu hình paper\n\n    var paper = new joint.dia.Paper({\n      width: 800,\n      height: 600,\n      model: graph,\n      async: true,\n      sorting: joint.dia.Paper.sorting.APPROX,\n      gridSize: 10,\n      drawGrid: true,\n      restrictTranslate: true,\n      stopDelegation: false,\n      interactive: {\n        vertexAdd: false\n      },\n      // background: { color: '#F3F7F6' },\n      // defaultConnectionPoint: { name: 'boundary' },\n      // defaultConnector: {\n      //     name: \"rounded\"\n      //   },\n      //   defaultRouter: {\n      //     name: \"manhattan\",\n      //     args: {\n      //       step: 10,\n      //       endDirections: [\"bottom\"],\n      //       startDirections: [\"top\"],\n      //       padding: { bottom: 20 }\n      //     }\n      //   },\n      snapLinks: {\n        radius: 75\n      },\n      linkPinning: false,\n      multiLinks: false,\n      defaultRouter: {\n        name: 'manhattan',\n        args: {\n          padding: 10\n        }\n      },\n      defaultConnector: {\n        name: 'rounded'\n      },\n      validateConnection: function (cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\n        // Prevent linking from input ports.\n        if (magnetS && magnetS.getAttribute('port-group') === 'in') return false; // Prevent linking from output ports to input ports within one element.\n\n        if (cellViewS === cellViewT) return false; // Prevent linking to input ports.\n\n        return magnetT && magnetT.getAttribute('port-group') === 'in' || cellViewS.model.get('type') === 'qad.Question' && cellViewT.model.get('type') === 'qad.Answer';\n      },\n      // validateConnection: function (view1, _magnet1, view2, _magnet2) {\n      //     // Do not allow loop links (Element to Link, Element A to Element B is valid).\n      //     return view1 !== view2;\n      // },\n      interactive: {\n        linkMove: true,\n        labelMove: true,\n        arrowheadMove: true,\n        vertexMove: false,\n        vertexAdd: false,\n        vertexRemove: false,\n        useLinkTools: false\n      },\n      defaultLink: function () {\n        return new joint.shapes.standard.Link({\n          attrs: {\n            line: {\n              connection: true,\n              stroke: '#707070',\n              strokeLinejoin: 'round'\n            },\n            wrapper: {\n              connection: true,\n              strokeWidth: 10,\n              strokeLinejoin: 'round'\n            }\n          },\n          markup: [{\n            tagName: 'path',\n            selector: 'wrapper',\n            attributes: {\n              'fill': 'none',\n              'stroke': 'transparent'\n            }\n          }, {\n            tagName: 'path',\n            selector: 'line',\n            attributes: {\n              'fill': 'none'\n            }\n          }]\n        });\n      }\n    }); //paperScroller\n\n    var paperScroller = new joint.ui.PaperScroller({\n      paper: paper,\n      autoResizePaper: true,\n      scrollWhileDragging: true,\n      cursor: 'grab'\n    }); // cấu hình snaplines\n\n    var snaplines = new joint.ui.Snaplines({\n      paper: paper\n    });\n    snaplines.startListening(); // cấu hình Stencil \n\n    var stencil = new joint.ui.Stencil({\n      paper: paperScroller,\n      width: 900,\n      height: 60,\n      dropAnimation: {\n        duration: 200,\n        easing: 'swing'\n      }\n    }); // cấu hình Selection\n\n    var selection = new joint.ui.Selection({\n      theme: 'material',\n      paper: paper,\n      useModelGeometry: true,\n      allowTranslate: true\n    }); //hàm viết hoa chữ đầu\n\n    function jsUcfirst(string) {\n      return string.charAt(0).toUpperCase() + string.slice(1);\n    } //hàm render stencil\n\n\n    function stencilRenderHandler(positionX, positionY, arr, elNoInPorts = \"\", spaceBetweenElToX = 0, spaceBetweenElToY = 0) {\n      arr.forEach(element => {\n        //chuyển thành hoa chữ đầu cho đúng định dạng file ảnh lưu\n        let elementName = jsUcfirst(element);\n\n        if (elementName === jsUcfirst(elNoInPorts)) {\n          element = new customElNoInPorts();\n        } else {\n          element = new customEl();\n        }\n\n        element.prop('attrs/image/xlinkHref', `./assets/${elementName}.svg`);\n        stencilShapes.push(element.position(positionX, positionY));\n\n        if (spaceBetweenElToX > 0) {\n          positionX += element.attributes.size.width + spaceBetweenElToX;\n        }\n\n        if (spaceBetweenElToY > 0) {\n          positionY += element.attributes.size.height + spaceBetweenElToY;\n        }\n      });\n    } // const filter=new customEl();\n    // const formula =new customEl();\n    // const join =new customEl();\n    // const load =new customElNoInPorts();\n    // const pivot =new customEl();\n    // const sample =new customEl();\n    // const script =new customEl();\n    // const select =new customEl();\n    // const sort =new customEl();\n    // const summarize =new customEl();\n    // const transposeTable =new customEl();\n    // const union =new customEl();\n    // const weightAvg =new customEl();\n    // filter.prop('attrs/image/xlinkHref', './assets/Filter.svg');\n    // formula.prop('attrs/image/xlinkHref', './assets/Formula.svg');\n    // join.prop('attrs/image/xlinkHref', './assets/Join.svg');\n    // load.prop('attrs/image/xlinkHref', './assets/Load.svg');\n    // pivot.prop('attrs/image/xlinkHref', './assets/Pivot.svg');\n    // sample.prop('attrs/image/xlinkHref', './assets/Sample.svg');\n    // script.prop('attrs/image/xlinkHref', './assets/Script.svg');\n    // select.prop('attrs/image/xlinkHref', './assets/Select.svg');\n    // sort.prop('attrs/image/xlinkHref', './assets/Sort.svg');\n    // summarize.prop('attrs/image/xlinkHref', './assets/Summarize.svg');\n    // transposeTable.prop('attrs/image/xlinkHref', './assets/TransposeTable.svg');\n    // union.prop('attrs/image/xlinkHref', './assets/Union.svg');\n    // weightAvg.prop('attrs/image/xlinkHref', './assets/WeightAvg.svg');\n    //mảng tên của các stencil Shape\n\n\n    var arr = ['filter', 'formula', 'join', 'load', 'pivot', 'sample', 'script', 'select', 'sort', 'summarize', 'transposeTable', 'union', 'weightAvg']; //mảng chứa các vị trí của stencil Shape để sau đó render\n\n    var stencilShapes = [// filter.position(20, 20),\n      // formula.position(77, 20),\n      // join.position(132, 20),\n      // load.position(197, 20),\n      // pivot.position(252, 20),\n      // sample.position(307, 20),\n      // script.position(362, 20),\n      // select.position(417, 20),\n      // sort.position(472, 20),\n      // summarize.position(527, 20),\n      // transposeTable.position(582, 20),\n      // union.position(637, 20),\n      // weightAvg.position(692, 20),\n      // rectangle.position(812, 20)\n    ]; //gọi hàm render stencil \n\n    stencilRenderHandler(20, 20, arr, \"load\", 16); //cấu hình các cell dc chọn\n\n    paper.svg.prepend(V.createSVGStyle(`\n            .joint-element .selection {\n                stroke: ${color};\n            }\n            .joint-link .selection {\n                stroke: ${color}; \n                'fill': ${color},\n            }\n            \n        `)); //lấy tất cả link ở trc node\n\n    function getElementPredecessorLinks(el) {\n      return graph.getSubgraph([el, ...graph.getPredecessors(el)]).filter(cell => cell.isLink());\n    } //đổi màu cell\n\n\n    function highlightCell(cell) {\n      if (cell) {\n        highlighters.addClass.add(cell.findView(paper), cell.isElement() ? \"body\" : \"line\", \"selection\", {\n          className: \"selection\"\n        });\n      } else {\n        return;\n      }\n    } //chuyển màu cell lại như cũ\n\n\n    function unhighlightCell(cell) {\n      if (cell) {\n        highlighters.addClass.remove(cell.findView(paper), \"selection\");\n      } else {\n        return;\n      }\n    } //function xử lý hành dộng chọn el\n\n\n    function selectElement(el) {\n      if (selectionNode === el) return;\n\n      if (selectionNode) {\n        unhighlightCell(selectionNode);\n        graph.getLinks().forEach(link => unhighlightCell(link));\n      }\n\n      if (el) {\n        highlightCell(el);\n        getElementPredecessorLinks(el).forEach(link => {\n          highlightCell(link);\n          link.toFront();\n        });\n        selectionNode = el;\n      } else {\n        selectionNode = null;\n      }\n    } //halo cấu hình\n\n\n    paper.on('cell:pointerup', function (cellView) {\n      var halo = new joint.ui.Halo({\n        cellView: cellView,\n        type: 'toolbar',\n        boxContent: false // bang phia duoi cell cho biet tọa độ height width và angle\n\n      });\n      halo.removeHandle('resize');\n      halo.removeHandle('rotate');\n      halo.removeHandle('direction');\n      halo.render(); //cho cell đang chọn lên trc và gán cho selectedEl để chạy những chức năng tiếp theo\n\n      selectedElement = cellView.model;\n      selectedElement.toFront(); // console.log(graph.getLinks())\n    }); //xử lý khi các sự kiện với paper\n\n    paper.on({\n      //xử lý khi các sự kiện \n      \"cell:mouseenter\": cellView => {\n        cellView.model.toFront();\n      },\n      \"cell:mouseleave\": cellView => {\n        cellView.model.toBack();\n\n        if (selectionNode) {\n          getElementPredecessorLinks(selectionNode).forEach(link => {\n            link.toFront();\n          });\n        }\n      },\n      \"element:pointerclick\": cellView => {\n        //chỉ đổi màu khi ko bấm ctrl\n        if (ctrlDown === false) {\n          selectElement(cellView.model);\n        }\n      },\n      \"link:pointerclick\": cellView => {\n        selectElement(cellView.model); //chon vao link thi mo cho phep doi node\n        // cellView.addTools(toolsView);\n      },\n      //chuyển lại màu cũ khi bấm ra ngoài\n      \"blank:pointerclick\": () => {\n        selectElement(null);\n        paper.removeTools();\n      },\n      'element:pointerup': function (cellView, evt) {\n        if (evt.ctrlKey || evt.metaKey) {\n          selection.collection.add(cellView.model); //loop to all the element in selection and set it to front\n\n          selection.collection.models.forEach(element => {\n            element.toFront();\n          });\n        }\n      },\n      //chuyển màu khi bấm vào link và cho nó lên trc\n      'link:pointerup': function (cellView) {\n        selectedLink = cellView.model;\n        selectedLink.toFront();\n      },\n      // lắng nghe sự kiện bấm ở ngoài khoange trống check shift để active select\n      'blank:pointerdown': function (evt, x, y) {\n        if (shiftDown === true) {\n          selectElement(null);\n          paperScroller.setCursor('crosshair');\n          selection.startSelecting(evt);\n          console.log(selection);\n        } else {\n          selection.collection.reset([]);\n          paperScroller.startPanning(evt, x, y);\n          paper.removeTools();\n          paperScroller.setCursor('grab');\n        }\n      }\n    }); //xóa el nếu chọn lại lần 2 khi bấm ctrl\n\n    selection.on('selection-box:pointerdown', function (cellView, evt) {\n      if (evt.ctrlKey || evt.metaKey) {\n        selection.collection.remove(cellView.model);\n      }\n    }); //xóa bằng nút delete\n\n    document.addEventListener('keyup', function (evt) {\n      if (!selectedElement && !selection) return;\n\n      if (evt.code === 'Backspace' || evt.code === 'Delete') {\n        //xóa 1 el\n        if (selectedElement) {\n          selectedElement.remove();\n          selectedElement = null;\n          selectionNode = null;\n        } //xóa toàn bộ  el đã chọn\n\n\n        if (selection) {\n          // chuyeent selection.collection thành mảng hảm remove cell nhận vào 1 mảng và xóa khỏi graph\n          evt.preventDefault();\n          graph.removeCells(selection.collection.toArray());\n          selectionNode = null;\n        }\n      }\n    }); //nếu bấm thì =true\n\n    document.addEventListener('keydown', function (evt) {\n      if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\n        ctrlDown = true;\n      }\n\n      if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\n        shiftDown = true;\n      }\n    }); //nếu thả nút thì =false\n\n    document.addEventListener('keyup', function (evt) {\n      if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\n        shiftDown = false;\n      }\n\n      if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\n        ctrlDown = false;\n      }\n    }); //kết hợp bấm ctrl để check các tổ hợp phím ctrl + C,V,Z,Y,A...\n\n    document.addEventListener('keydown', function (evt) {\n      var clipboard = new joint.ui.Clipboard();\n\n      if (evt.code === \"NumpadAdd\" && shiftDown === true) {\n        console.log(evt.code);\n        paperScroller.zoom(0.2, {\n          max: 4\n        });\n      }\n\n      if (evt.code === \"NumpadSubtract\" && shiftDown === true) {\n        paperScroller.zoom(-0.2, {\n          min: 0.2\n        });\n        console.log(evt.code);\n      } //check+ A\n\n\n      if (evt.code === \"KeyA\" && ctrlDown === true) {\n        selection.collection.reset(graph.getElements());\n        evt.preventDefault();\n      } //check ctrl + Z\n\n\n      if (evt.code === \"KeyZ\" && ctrlDown === true) {\n        commandManager.undo();\n        console.log(selectionNode);\n        console.log(selectedElement);\n        console.log(selectionNode); // unhighlightCell(selectionNode);\n        // graph.getLinks().forEach((link) => unhighlightCell(link));\n        // console.log(selectionNode)\n        // selectionNode=null\n      } //check ctrl + Y\n\n\n      if (evt.code === \"KeyY\" && ctrlDown === true) {\n        commandManager.redo();\n        selectElement(null);\n      } //check ctrl + V ,ctrl + C, ctrl+X\n\n\n      if (evt.code === \"KeyX\" && ctrlDown === true) {\n        clipboard.cutElements(selection.collection, paper.model);\n      }\n\n      if (evt.code === \"KeyC\" && ctrlDown === true) {\n        clipboard.copyElements(selection.collection, graph);\n      }\n\n      if (evt.code === \"KeyV\" && ctrlDown === true) {\n        var pastedCells = clipboard.pasteCells(graph, {\n          translate: {\n            dx: 40,\n            dy: 40\n          },\n          useLocalStorage: true\n        });\n\n        var elements = _.filter(pastedCells, function (cell) {\n          return cell.isElement();\n        }); // Make sure pasted elements get selected immediately. This makes the UX better as\n        // the user can immediately manipulate the pasted elements.\n\n\n        selection.collection.reset(elements);\n      }\n    }); // nut zoomin zoom out can chuyen ve scroll\n\n    $('#btn-zoomin').on('click', function () {\n      paperScroller.zoom(0.2, {\n        max: 4\n      });\n    });\n    $('#btn-zoomout').on('click', function () {\n      paperScroller.zoom(-0.2, {\n        min: 0.2\n      });\n    });\n    $('#btn-center').on('click', _.bind(paperScroller.center, paperScroller));\n    $('#btn-center-content').on('click', _.bind(paperScroller.centerContent, paperScroller)); //render paper\n\n    document.getElementById('paper').appendChild(paperScroller.render().el); //render paperScroller\n\n    paperScroller.$el.css({\n      width: 900,\n      height: 600\n    }).appendTo('#paper');\n    paperScroller.center(); //render stencil ra màn hình\n\n    document.getElementById('stencil').appendChild(stencil.render().el);\n    stencil.load(stencilShapes);\n    selection.collection.reset(graph.getElements());\n  }\n\n};","map":{"version":3,"mappings":"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","names":["joint","require","window","$","mounted","highlighters","mask","selectionNode","selectedElement","selectedLink","ctrlDown","shiftDown","color","customEl","dia","Element","define","z","size","width","height","removable","attrs","image","x","y","root","magnet","body","fill","stroke","strokeWidth","rx","ry","ports","items","id","group","groups","out","markup","tagName","selector","position","name","portBody","r","in","customElNoInPorts","theme","line","connection","strokeLinejoin","targetMarker","targetArrowheadTool","linkTools","TargetArrowhead","graph","Graph","commandManager","CommandManager","paper","Paper","model","async","sorting","APPROX","gridSize","drawGrid","restrictTranslate","stopDelegation","interactive","vertexAdd","snapLinks","radius","linkPinning","multiLinks","defaultRouter","args","padding","defaultConnector","validateConnection","cellViewS","magnetS","cellViewT","magnetT","end","linkView","getAttribute","get","linkMove","labelMove","arrowheadMove","vertexMove","vertexRemove","useLinkTools","defaultLink","shapes","standard","Link","wrapper","attributes","paperScroller","ui","PaperScroller","autoResizePaper","scrollWhileDragging","cursor","snaplines","Snaplines","startListening","stencil","Stencil","dropAnimation","duration","easing","selection","Selection","useModelGeometry","allowTranslate","jsUcfirst","string","charAt","toUpperCase","slice","stencilRenderHandler","positionX","positionY","arr","elNoInPorts","spaceBetweenElToX","spaceBetweenElToY","forEach","element","elementName","prop","stencilShapes","push","svg","prepend","V","createSVGStyle","getElementPredecessorLinks","el","getSubgraph","getPredecessors","filter","cell","isLink","highlightCell","addClass","add","findView","isElement","className","unhighlightCell","remove","selectElement","getLinks","link","toFront","on","cellView","halo","Halo","type","boxContent","removeHandle","render","toBack","removeTools","evt","ctrlKey","metaKey","collection","models","setCursor","startSelecting","console","log","reset","startPanning","document","addEventListener","code","preventDefault","removeCells","toArray","clipboard","Clipboard","zoom","max","min","getElements","undo","redo","cutElements","copyElements","pastedCells","pasteCells","translate","dx","dy","useLocalStorage","elements","_","bind","center","centerContent","getElementById","appendChild","$el","css","appendTo","load"],"sourceRoot":"","sources":["C:\\Users\\Admin\\dataflow-test\\src\\App.vue"],"sourcesContent":["\n<template>\n<h1>Home</h1>\n  <div class=\"canvas\" ref=\"canvas\"></div>\n  \n  <div id=\"app\">\n    <div class=\"btn_contain\">\n        <button id=\"btn-zoomout\" class=\"btn\">zoom out</button>\n        <button id=\"btn-zoomin\" class=\"btn\">zoom in</button>\n        <button id=\"btn-center\" class=\"btn\">center</button>\n        <button id=\"btn-center-content\" class=\"btn\">center content</button>\n    </div>\n    <div id=\"stencil\"></div>\n    \n    <div id=\"paper\"></div>\n    <div id=\"navigator\"></div>\n    \n    \n        </div>\n</template>\n\n<script>\n\n\nconst joint = require('jointjs');\nwindow.$ = require('jquery');\n\n// import { Options, Vue } from 'vue-class-component';\nexport default {\n  mounted() {\n    var highlighters=joint.highlighters;\n    var mask = joint.highlighters.mask;\n    let selectionNode = null;\n    let selectedElement = null;\n    let selectedLink = null\n    //check ctrl shift\n    var ctrlDown = false;\n    var shiftDown = false;\n    const color = \"rgb(255 136 0)\";\n    var customEl = joint.dia.Element.define('standard.Rectangle', {\n        z: 1,\n        size: {\n            width: 44,\n            height: 35\n        },\n        removable: false,\n        attrs: {\n            image: {\n                x: 5,\n                y: 5,\n                width: 'calc(w-10)',\n                height: 'calc(h-10 )'\n            },\n            root: {\n                magnet: false\n            },\n            body: {\n                fill: '#FFFFFF',\n                stroke: '#A0A0A0',\n                width: 'calc(w)',\n                height: 'calc(h)',\n                strokeWidth: 2,\n                rx: 5,\n                ry: 5,\n\n            }\n        },\n        ports: {\n            items: [{\n                id: 'out-port',\n                group: 'out',\n\n            },\n            {\n                id: 'in-port',\n                group: 'in'\n            }\n            ],\n            groups: {\n                out: {\n                    markup: [{\n                        tagName: 'circle',\n                        selector: 'portBody'\n                    }],\n                    position: {\n                        name: 'right'\n                    },\n                    attrs: {\n                        portBody: {\n                            r: 5,\n                            magnet: 'active',\n                            fill: '#187BD3',\n                            stroke: '#187BD3'\n\n                        }\n                    }\n                },\n                in: {\n                    markup: [{\n                        tagName: 'circle',\n                        selector: 'portBody'\n                    }],\n                    position: {\n                        name: 'left'\n                    },\n                    attrs: {\n                        portBody: {\n                            r: 5,\n                            magnet: 'passive',\n                            fill: '#FFFFFF',\n                            stroke: '#187BD3',\n\n                        }\n                    }\n                }\n            }\n        },\n        markup: [\n            {\n                tagName: 'rect',\n                selector: 'body',\n            },\n            {\n                tagName: 'image',\n                selector: 'image'\n            }, {\n                tagName: 'ports',\n                selector: 'ports'\n            }]\n    })\n    var customElNoInPorts = joint.dia.Element.define('standard.Rectangle', {\n        z: 1,\n        theme: 'material',\n        size: {\n            width: 44,\n            height: 35\n        },\n        removable: false,\n        attrs: {\n            image: {\n                x: 5,\n                y: 5,\n                width: 'calc(w-10)',\n                height: 'calc(h-10 )'\n            },\n            root: {\n                magnet: false\n            },\n            body: {\n                fill: '#FFFFFF',\n                stroke: '#A0A0A0',\n                width: 'calc(w)',\n                height: 'calc(h)',\n                strokeWidth: 2,\n            },\n            line: {\n                connection: true,\n                stroke: '#333333',\n                strokeWidth: 2,\n                strokeLinejoin: 'round',\n                targetMarker: {\n                    'type': 'path',\n                    'd': 'M 10 -5 0 0 10 5 z'\n                }\n            },\n        },\n        ports: {\n            items: [\n                {\n                    id: 'out-port',\n                    group: 'out'\n                }\n            ],\n            groups: {\n                out: {\n                    markup: [{\n                        tagName: 'circle',\n                        selector: 'portBody'\n                    }],\n                    position: {\n                        name: 'right'\n                    },\n                    attrs: {\n                        portBody: {\n                            r: 5,\n                            magnet: 'active',\n                            fill: '#187BD3',\n                            stroke: '#187BD3'\n                        }\n                    }\n                },\n\n            }\n        },\n        markup: [\n            {\n                tagName: 'rect',\n                selector: 'body',\n            }, {\n                tagName: 'image',\n                selector: 'image'\n            }, {\n                tagName: 'ports',\n                selector: 'ports'\n            }]\n    })\n    //create link tool\n//     var verticesTool = new joint.linkTools.Vertices();\n// var segmentsTool = new joint.linkTools.Segments();\n// var sourceArrowheadTool = new joint.linkTools.SourceArrowhead();\nvar targetArrowheadTool = new joint.linkTools.TargetArrowhead();\n// var sourceAnchorTool = new joint.linkTools.SourceAnchor();\n// var targetAnchorTool = new joint.linkTools.TargetAnchor();\n// var boundaryTool = new joint.linkTools.Boundary();\n// var removeButton = new joint.linkTools.Remove();\n\n// var toolsView = new joint.dia.ToolsView({\n//     tools: [\n//         // verticesTool, segmentsTool,\n//         // sourceArrowheadTool, \n//         targetArrowheadTool,\n//         // sourceAnchorTool, targetAnchorTool,\n//         // boundaryTool, removeButton\n//     ]\n// });\n    // 2) creating a tools view\n    \n    // var linkView = link.findView(paper);\n    // linkView.addTools(toolsView);\n    //custom link \n    // \n    // Paper & Graph\n    var graph = new joint.dia.Graph;\n    //ctrl+z\n    var commandManager = new joint.dia.CommandManager({ graph: graph });\n    \n    //cấu hình paper\n    var paper = new joint.dia.Paper({  \n        width: 800,\n        height: 600,\n        model: graph,\n        async: true,\n        sorting: joint.dia.Paper.sorting.APPROX,\n        gridSize: 10,\n        drawGrid: true,\n        restrictTranslate: true,\n        stopDelegation: false,\n        \n        interactive: { vertexAdd: false } ,\n        // background: { color: '#F3F7F6' },\n        // defaultConnectionPoint: { name: 'boundary' },\n        // defaultConnector: {\n        //     name: \"rounded\"\n        //   },\n        //   defaultRouter: {\n        //     name: \"manhattan\",\n        //     args: {\n        //       step: 10,\n        //       endDirections: [\"bottom\"],\n        //       startDirections: [\"top\"],\n        //       padding: { bottom: 20 }\n        //     }\n        //   },\n        snapLinks: {\n            radius: 75\n        },\n        linkPinning: false,\n        multiLinks: false,\n        defaultRouter: { name: 'manhattan', args: { padding: 10 }},\n        defaultConnector: { name: 'rounded' },\n        validateConnection: function(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\n            // Prevent linking from input ports.\n            if (magnetS && magnetS.getAttribute('port-group') === 'in') return false;\n            // Prevent linking from output ports to input ports within one element.\n            if (cellViewS === cellViewT) return false;\n            // Prevent linking to input ports.\n            return (magnetT && magnetT.getAttribute('port-group') === 'in') || (cellViewS.model.get('type') === 'qad.Question' && cellViewT.model.get('type') === 'qad.Answer');\n        },\n        // validateConnection: function (view1, _magnet1, view2, _magnet2) {\n        //     // Do not allow loop links (Element to Link, Element A to Element B is valid).\n        //     return view1 !== view2;\n        // },\n        interactive: {\n            linkMove: true,\n            labelMove: true,\n            arrowheadMove: true,\n            vertexMove: false,\n            vertexAdd: false,\n            vertexRemove: false,\n            useLinkTools: false,\n        },\n        defaultLink: function () {\n            return new joint.shapes.standard.Link({\n                attrs: {\n                    line: {\n                        connection: true,\n                        stroke: '#707070',\n                        strokeLinejoin: 'round',\n                    },\n                    wrapper: {\n                        connection: true,\n                        strokeWidth: 10,\n                        strokeLinejoin: 'round'\n                    },\n                    \n                },\n                \n                markup: [{\n                    tagName: 'path',\n                    selector: 'wrapper',\n                    attributes: {\n                        'fill': 'none',\n                        \n                        'stroke': 'transparent'\n                    }\n                }, {\n                    tagName: 'path',\n                    selector: 'line',\n                    attributes: {\n                        'fill': 'none',\n                        \n                    }\n                }]\n            });\n        }\n    });\n    //paperScroller\n    var paperScroller = new joint.ui.PaperScroller({\n        paper: paper,\n        autoResizePaper: true,\n        scrollWhileDragging: true,\n        cursor: 'grab'\n        \n    });\n    // cấu hình snaplines\n    var snaplines = new joint.ui.Snaplines({ paper: paper })\n    snaplines.startListening()\n    // cấu hình Stencil \n    var stencil = new joint.ui.Stencil({\n        paper: paperScroller,\n        width: 900,\n        height: 60,\n        dropAnimation: { duration: 200, easing: 'swing' },\n        \n    });\n    // cấu hình Selection\n    var selection = new joint.ui.Selection({\n        theme: 'material',\n        paper: paper,\n        useModelGeometry: true,\n        allowTranslate: true,\n    });\n    //hàm viết hoa chữ đầu\n    function jsUcfirst(string) {\n        return string.charAt(0).toUpperCase() + string.slice(1);\n    }\n    //hàm render stencil\n    function stencilRenderHandler(positionX,positionY,arr,elNoInPorts =\"\",spaceBetweenElToX=0,spaceBetweenElToY=0){\n        arr.forEach(element => {\n            //chuyển thành hoa chữ đầu cho đúng định dạng file ảnh lưu\n            let elementName = jsUcfirst(element)\n            if (elementName === jsUcfirst(elNoInPorts)) {\n                element = new customElNoInPorts();\n            }\n            else {\n                element = new customEl();\n            }\n            element.prop('attrs/image/xlinkHref', `./assets/${elementName}.svg`)\n            stencilShapes.push(element.position(positionX, positionY))\n            if(spaceBetweenElToX>0){\n                positionX += element.attributes.size.width+spaceBetweenElToX;\n            }\n            if(spaceBetweenElToY>0){\n                positionY += element.attributes.size.height+spaceBetweenElToY;\n            }\n        });\n    }\n    \n    // const filter=new customEl();\n    // const formula =new customEl();\n    // const join =new customEl();\n    // const load =new customElNoInPorts();\n    // const pivot =new customEl();\n    // const sample =new customEl();\n    // const script =new customEl();\n    // const select =new customEl();\n    // const sort =new customEl();\n    // const summarize =new customEl();\n    // const transposeTable =new customEl();\n    // const union =new customEl();\n    // const weightAvg =new customEl();\n\n    // filter.prop('attrs/image/xlinkHref', './assets/Filter.svg');\n    // formula.prop('attrs/image/xlinkHref', './assets/Formula.svg');\n    // join.prop('attrs/image/xlinkHref', './assets/Join.svg');\n    // load.prop('attrs/image/xlinkHref', './assets/Load.svg');\n    // pivot.prop('attrs/image/xlinkHref', './assets/Pivot.svg');\n    // sample.prop('attrs/image/xlinkHref', './assets/Sample.svg');\n    // script.prop('attrs/image/xlinkHref', './assets/Script.svg');\n    // select.prop('attrs/image/xlinkHref', './assets/Select.svg');\n    // sort.prop('attrs/image/xlinkHref', './assets/Sort.svg');\n    // summarize.prop('attrs/image/xlinkHref', './assets/Summarize.svg');\n    // transposeTable.prop('attrs/image/xlinkHref', './assets/TransposeTable.svg');\n    // union.prop('attrs/image/xlinkHref', './assets/Union.svg');\n    // weightAvg.prop('attrs/image/xlinkHref', './assets/WeightAvg.svg');\n    //mảng tên của các stencil Shape\n    var arr = ['filter', 'formula', 'join', 'load', 'pivot', 'sample', 'script', 'select', 'sort', 'summarize', 'transposeTable', 'union', 'weightAvg'];\n    //mảng chứa các vị trí của stencil Shape để sau đó render\n    var stencilShapes = [\n        // filter.position(20, 20),\n        // formula.position(77, 20),\n        // join.position(132, 20),\n        // load.position(197, 20),\n        // pivot.position(252, 20),\n        // sample.position(307, 20),\n        // script.position(362, 20),\n        // select.position(417, 20),\n        // sort.position(472, 20),\n        // summarize.position(527, 20),\n        // transposeTable.position(582, 20),\n        // union.position(637, 20),\n        // weightAvg.position(692, 20),\n        // rectangle.position(812, 20)\n];\n    //gọi hàm render stencil \n    stencilRenderHandler(20,20,arr,\"load\",16)\n    //cấu hình các cell dc chọn\n    paper.svg.prepend(\n    V.createSVGStyle(`\n            .joint-element .selection {\n                stroke: ${color};\n            }\n            .joint-link .selection {\n                stroke: ${color}; \n                'fill': ${color},\n            }\n            \n        `)\n    );\n    \n    //lấy tất cả link ở trc node\n    function getElementPredecessorLinks(el) {\n        return graph\n          .getSubgraph([el, ...graph.getPredecessors(el)])\n          .filter((cell) => cell.isLink());\n      }\n      //đổi màu cell\n      function highlightCell(cell) {\n        if(cell){\n        highlighters.addClass.add(\n          cell.findView(paper),\n          cell.isElement() ? \"body\" : \"line\",\n          \"selection\",\n          { className: \"selection\" }\n        );\n        }else{return}\n      }\n      //chuyển màu cell lại như cũ\n      function unhighlightCell(cell) {\n        if(cell){\n        highlighters.addClass.remove(cell.findView(paper), \"selection\");\n        }\n        else{return}\n      }\n      //function xử lý hành dộng chọn el\n      function selectElement(el) {     \n        if (selectionNode === el) return;\n        if (selectionNode) {\n            \n          unhighlightCell(selectionNode);\n          graph.getLinks().forEach((link) => unhighlightCell(link));\n        }\n        if (el) {\n            \n          highlightCell(el);\n          getElementPredecessorLinks(el).forEach((link) => {\n              highlightCell(link)\n              link.toFront()\n            });\n          selectionNode = el;\n        } else {\n            selectionNode = null;\n        }\n      }\n      //halo cấu hình\n       paper.on('cell:pointerup',function (cellView) {\n        var halo = new joint.ui.Halo({\n            cellView: cellView,\n            type: 'toolbar',\n            boxContent:false // bang phia duoi cell cho biet tọa độ height width và angle\n        });\n        halo.removeHandle('resize');\n        halo.removeHandle('rotate');\n        halo.removeHandle('direction');\n        halo.render();\n        //cho cell đang chọn lên trc và gán cho selectedEl để chạy những chức năng tiếp theo\n        selectedElement = cellView.model;\n        selectedElement.toFront()\n        // console.log(graph.getLinks())\n    })\n   \n      //xử lý khi các sự kiện với paper\n      paper.on({\n          //xử lý khi các sự kiện \n        \"cell:mouseenter\":(cellView)=>{\n                cellView.model.toFront()\n        },\n        \"cell:mouseleave\":(cellView)=>{\n            cellView.model.toBack()\n            if(selectionNode){\n                getElementPredecessorLinks(selectionNode).forEach((link) => {\n                   \n                    link.toFront()\n                  });\n            }\n        },\n    \n        \"element:pointerclick\":(cellView) =>{\n            //chỉ đổi màu khi ko bấm ctrl\n            if(ctrlDown ===false )\n                { \n                    selectElement(cellView.model)\n                }\n            },\n            \"link:pointerclick\":(cellView) =>\n                {selectElement(cellView.model)\n                    //chon vao link thi mo cho phep doi node\n                    // cellView.addTools(toolsView);\n                \n                },\n                \n                //chuyển lại màu cũ khi bấm ra ngoài\n            \"blank:pointerclick\":() => {selectElement(null)\n                paper.removeTools();\n                },\n            \n            'element:pointerup': function (cellView, evt) {\n                \n                if (evt.ctrlKey || evt.metaKey) {\n                    selection.collection.add(cellView.model);\n                    //loop to all the element in selection and set it to front\n                    selection.collection.models.forEach(element => {\n                        element.toFront()\n                    })               \n                }\n            },\n            //chuyển màu khi bấm vào link và cho nó lên trc\n            'link:pointerup': function (cellView) {\n                selectedLink = cellView.model;\n                selectedLink.toFront()\n            },\n            \n            // lắng nghe sự kiện bấm ở ngoài khoange trống check shift để active select\n            'blank:pointerdown':function(evt, x, y) {\n                if (shiftDown===true) {\n                    selectElement(null)\n                    paperScroller.setCursor('crosshair')\n                    selection.startSelecting(evt);\n                    console.log(selection)\n                } else {\n                    selection.collection.reset([]);\n                    paperScroller.startPanning(evt, x, y);\n                    paper.removeTools();\n                    paperScroller.setCursor('grab');\n                }\n        \n            },\n      })\n      //xóa el nếu chọn lại lần 2 khi bấm ctrl\n      selection.on('selection-box:pointerdown', function (cellView, evt) {\n        if (evt.ctrlKey || evt.metaKey) {\n            selection.collection.remove(cellView.model);\n        }\n    });\n    //xóa bằng nút delete\n    document.addEventListener('keyup', function (evt) {\n        \n        if (!selectedElement && !selection) return;\n        if (evt.code === 'Backspace' || evt.code === 'Delete') {\n            //xóa 1 el\n            if (selectedElement) {\n                selectedElement.remove();\n                selectedElement = null;\n                selectionNode=null;\n            }\n            //xóa toàn bộ  el đã chọn\n            if (selection) {\n                // chuyeent selection.collection thành mảng hảm remove cell nhận vào 1 mảng và xóa khỏi graph\n                evt.preventDefault();\n                graph.removeCells(selection.collection.toArray())\n                selectionNode=null;\n            }\n        }\n    }\n    );\n    //nếu bấm thì =true\n    document.addEventListener('keydown', function (evt) {\n        if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\n            ctrlDown = true;\n        }\n        if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\n            shiftDown = true;\n        }\n    })\n    //nếu thả nút thì =false\n    document.addEventListener('keyup', function (evt) {\n        if (evt.code === \"ShiftLeft\" || evt.code === \"ShiftRight\") {\n            shiftDown = false;\n\n        }\n        if (evt.code === \"ControlLeft\" || evt.code === \"ControlRight\") {\n            ctrlDown = false;\n        }\n    })\n    //kết hợp bấm ctrl để check các tổ hợp phím ctrl + C,V,Z,Y,A...\n    document.addEventListener('keydown', function (evt) {\n        var clipboard = new joint.ui.Clipboard();\n        \n        \n        if (evt.code === \"NumpadAdd\" && shiftDown === true) {\n            console.log(evt.code)\n            paperScroller.zoom(0.2, { max: 4 });\n        }\n        if (evt.code === \"NumpadSubtract\" && shiftDown === true) {\n            paperScroller.zoom(-0.2, { min: 0.2 });\n            console.log(evt.code)\n        }\n        //check+ A\n        if (evt.code === \"KeyA\" && ctrlDown === true) {\n            selection.collection.reset(graph.getElements())\n            evt.preventDefault();\n        }//check ctrl + Z\n        if (evt.code === \"KeyZ\" && ctrlDown === true) {\n            commandManager.undo();\n            console.log(selectionNode)\n            console.log(selectedElement)\n            console.log(selectionNode)\n            // unhighlightCell(selectionNode);\n            // graph.getLinks().forEach((link) => unhighlightCell(link));\n            // console.log(selectionNode)\n            // selectionNode=null\n        }\n        //check ctrl + Y\n        if (evt.code === \"KeyY\" && ctrlDown === true) {\n            commandManager.redo();\n            selectElement(null)\n        }\n        //check ctrl + V ,ctrl + C, ctrl+X\n        if (evt.code === \"KeyX\" && ctrlDown === true) {\n\n            clipboard.cutElements(selection.collection, paper.model)\n        }\n        if (evt.code === \"KeyC\" && ctrlDown === true) {\n            clipboard.copyElements(selection.collection, graph);\n        }\n        if (evt.code === \"KeyV\" && ctrlDown === true) {\n            var pastedCells = clipboard.pasteCells(graph, {\n                translate: { dx: 40, dy: 40 },\n                useLocalStorage: true\n            });\n\n            var elements = _.filter(pastedCells, function (cell) {\n                return cell.isElement();\n            });\n            // Make sure pasted elements get selected immediately. This makes the UX better as\n            // the user can immediately manipulate the pasted elements.\n            selection.collection.reset(elements);\n\n        }\n    })\n   \n    // nut zoomin zoom out can chuyen ve scroll\n    $('#btn-zoomin').on('click', function() {\n        paperScroller.zoom(0.2, { max: 4 });\n    });\n    $('#btn-zoomout').on('click', function() {\n        paperScroller.zoom(-0.2, { min: 0.2 });\n    });\n    $('#btn-center').on('click', _.bind(paperScroller.center, paperScroller));\n    $('#btn-center-content').on('click', _.bind(paperScroller.centerContent, paperScroller));\n\n    //render paper\n    document.getElementById('paper').appendChild(paperScroller.render().el);\n    //render paperScroller\n    paperScroller.$el.css({ width: 900, height: 600 }).appendTo('#paper');\n    paperScroller.center();\n     //render stencil ra màn hình\n     document.getElementById('stencil').appendChild(stencil.render().el);\n     stencil.load(stencilShapes);\n     selection.collection.reset(graph.getElements());\n        }\n  }\n\n  \n\n</script>\n\n<style >\n@import \"@/../public/vendor/jointJS/build/package/rappid.css\";\n@import \"@/css/data_flow.css\";\n@import \"@/css/lib/rappid.min.css\";\n#app {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  margin-top: 60px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}